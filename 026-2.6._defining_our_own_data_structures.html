<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>2.6. Defining Our Own Data Structures</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="025-2.5._dealing_with_types.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="027-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos576488" class="calibre29"><span class="bold">2.6. Defining Our Own Data Structures</span></h3><div class="calibre12">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">At the most basic level, a data structure is a way to group together related data elements and a strategy for using those data. As one example, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> class groups an <small class="calibre48">ISBN</small>, a count of how many copies of that book had been sold, and the revenue associated with those sales. It also provides a set of operations such as the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;&lt;</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">+</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">+=</span></tt></code> operators.</p><div class="calibre15">&#160;</div>
<p class="calibre25">In C++ we define our own data types by defining a class. The library types <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> are all defined as classes, as is the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> type we used in <a href="010-chapter_1._getting_started.html#filepos113276">Chapter 1</a>. C++ support for classes is extensive&#8212;in fact, <a href="119-part_iii_tools_for_class_authors.html#filepos3192626">Parts III</a> and <a href="161-part_iv_advanced_topics.html#filepos4558192">IV</a> are largely devoted to describing class-related features. Even though the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> class is pretty simple, we won&#8217;t be able to fully define that class until we learn how to write our own operators in <a href="129-chapter_14._overloaded_operations_and_conversions.html#filepos3544393">Chapter 14</a>.</p><div class="calibre22">&#160;</div>
<h4 id="filepos578460" class="calibre37"><span class="calibre5">2.6.1. Defining the <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Type</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Although we can&#8217;t yet write our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> class, we can write a more concrete class that groups the same data elements. Our strategy for using this class is that users will be able to access the data elements directly and must implement needed operations for themselves.</p><div class="calibre15">&#160;</div>
<p class="calibre14">Because our data structure does not support any operations, we&#8217;ll name our version <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> to distinguish it from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code>. We&#8217;ll define our class as follows:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"><a id="filepos579560"/></span></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">struct Sales_data {<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string bookNo;<br class="calibre6"/>&#160;&#160;&#160;&#160;unsigned units_sold = 0;<br class="calibre6"/>&#160;&#160;&#160;&#160;double revenue = 0.0;<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Our class begins with the keyword <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos580149" href="028-defined_terms.html#filepos627257">struct</a></span></span></tt></span></span></tt></code>, followed by the name of the class and a (possibly empty) class body. The class body is surrounded by curly braces and forms a new scope (&#167; <a href="022-2.2._variables.html#filepos382972">2.2.4</a>, p. <a href="022-2.2._variables.html#filepos382972">48</a>). The names defined inside the class must be unique within the class but can reuse names defined outside the class.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The close curly that ends the class body must be followed by a semicolon. The semicolon is needed because we can define variables after the class body:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">struct Sales_data { /* ... */ } accum, trans, *salesptr;<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">equivalent, but better way to define these objects</span></span></span><br class="calibre6"/>struct Sales_data { /* ... */ };<br class="calibre6"/>Sales_data accum, trans, *salesptr;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The semicolon marks the end of the (usually empty) list of declarators. Ordinarily, it is a bad idea to define an object as part of a class definition. Doing so obscures the code by combining the definitions of two different entities&#8212;the class and a variable&#8212;in a single statement.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">It is a common mistake among new programmers to forget the semicolon at the end of a class definition.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Class Data Members</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The class body defines the <strong class="calibre5"><a id="filepos582304" href="028-defined_terms.html#filepos621915">members</a></strong> of the class. Our class has only <strong class="calibre5"><a id="filepos582406" href="028-defined_terms.html#filepos616257">data members</a></strong>. The data members of a class define the contents of the objects of that class type. Each object has its own copy of the class data members. Modifying the data members of one object does not change the data in any other <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We define data members the same way that we define normal variables: We specify a base type followed by a list of one or more declarators. Our class has three data members: a member of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> named <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code>, an <code class="calibre23"><tt class="calibre23"><span class="calibre24">unsigned</span></tt></code> member named <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code>, and a member of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">double</span></tt></code> named <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code>. Each <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object will have these three data members.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Under the new standard, we can supply an <strong class="calibre5"><a id="filepos583741" href="028-defined_terms.html#filepos619442">in-class initializer</a></strong> for a data member. When we create objects, the in-class initializers will be used to initialize the data members. Members without an initializer are default initialized (&#167; <a href="022-2.2._variables.html#filepos350704">2.2.1</a>, p. <a href="022-2.2._variables.html#filepos350704">43</a>). Thus, when we define <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> objects, <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> will be initialized to 0, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> will be initialized to the empty string.</p><div class="calibre22">&#160;</div>
<div class="calibre28"><a id="filepos584501"/><img alt="Image" src="images/00008.jpg" class="calibre9"/></div>
<p class="calibre25">In-class initializers are restricted as to the form (&#167; <a href="022-2.2._variables.html#filepos350704">2.2.1</a>, p. <a href="022-2.2._variables.html#filepos350704">43</a>) we can use: They must either be enclosed inside curly braces or follow an <code class="calibre23"><tt class="calibre23"><span class="calibre24">=</span></tt></code> sign. We may not specify an in-class initializer inside parentheses.</p><div class="calibre22">&#160;</div>
<p class="calibre25">In &#167; <a href="074-7.2._access_control_and_encapsulation.html#filepos1833387">7.2</a> (p. <a href="074-7.2._access_control_and_encapsulation.html#filepos1833387">268</a>), we&#8217;ll see that C++ has a second keyword, <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code>, that can be used to define our own data structures. We&#8217;ll explain in that section why we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> here. Until we cover additional class-related features in <a href="072-chapter_7._classes.html#filepos1741323">Chapter 7</a>, you should use <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> to define your own data structures.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><a id="filepos585630"/><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 2.6.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 2.39:</strong> Compile the following program to see what happens when you forget the semicolon after a class definition. Remember the message for future reference.</p></blockquote><div class="calibre10">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">struct Foo { /* <span><span class="calibre45"><span class="calibre16">empty</span></span></span>&#160;&#160;&#160;*/ } // <span><span class="calibre45"><span class="calibre16">Note: no semicolon</span></span></span><br class="calibre6"/>int main()<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;return 0;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 2.40:</strong> Write your own version of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos586875" class="calibre37"><span class="calibre5">2.6.2. Using the <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Class</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Unlike the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> class, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class does not provide any operations. Users of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> have to write whatever operations they need. As an example, we&#8217;ll write a version of the program from &#167; <a href="015-1.5._introducing_classes.html#filepos237516">1.5.2</a> (p. <a href="015-1.5._introducing_classes.html#filepos237516">23</a>) that printed the sum of two transactions. The input to our program will be transactions such as</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">0-201-78345-X 3 20.00</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">0-201-78345-X 2 25.00</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Each transaction holds an <small class="calibre48">ISBN</small>, the count of how many books were sold, and the price at which each book was sold.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Adding Two <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Objects</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> provides no operations, we will have to write our own code to do the input, output, and addition operations. We&#8217;ll assume that our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class is defined inside <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code>. We&#8217;ll see how to define this header in &#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos600691">2.6.3</a> (p. <a href="026-2.6._defining_our_own_data_structures.html#filepos600691">76</a>).</p><div class="calibre15">&#160;</div>
<p class="calibre25">Because this program will be longer than any we&#8217;ve written so far, we&#8217;ll explain it in separate parts. Overall, our program will have the following structure:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">#include &lt;iostream&gt;<br class="calibre6"/>#include &lt;string&gt;<br class="calibre6"/>#include "Sales_data.h"<br class="calibre6"/>int main()<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data data1, data2;<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">code to read into</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">data1</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">data2</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">code to check whether</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">data1</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">data2</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">have the same</span></span></span>
<span><span class="calibre50">ISBN</span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;//&#160;&#160;&#160;&#160;<span><span class="calibre45"><span class="calibre16">and if so print the sum of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">data1</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">data2</span></span></tt></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">As in our original program, we begin by including the headers we&#8217;ll need and define variables to hold the input. Note that unlike the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> version, our new program includes the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> header. We need that header because our code will have to manage the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> member, which has type <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a/>Reading Data into a <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Object</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Although we won&#8217;t describe the library <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> type in detail until <a href="029-chapter_3._strings_vectors_and_arrays.html#filepos633734">Chapters 3</a> and <a href="097-chapter_10._generic_algorithms.html#filepos2454824">10</a>, we need to know only a little bit about <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s in order to define and use our <small class="calibre48">ISBN</small> member. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> type holds a sequence of characters. Its operations include the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;, &lt;&lt;</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> operators to read, write, and compare <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s, respectively. With this knowledge we can write the code to read the first transaction:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">double price = 0;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">price per book, used to calculate total revenue</span></span></span><br class="calibre6"/>//&#160;<span><span class="calibre45"><span class="calibre16">read the first transactions:</span></span></span>
<span><span class="calibre50">ISBN</span></span>, <span><span class="calibre45"><span class="calibre16">number of books sold, price per book</span></span></span><br class="calibre6"/>std::cin &gt;&gt; data1.bookNo &gt;&gt; data1.units_sold &gt;&gt; price;<br class="calibre6"/>//&#160;<span><span class="calibre45"><span class="calibre16">calculate total revenue from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">price</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">units_sold</span></span></tt></span><br class="calibre6"/>data1.revenue = data1.units_sold * price;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Our transactions contain the price at which each book was sold but our data structure stores the total revenue. We&#8217;ll read the transaction data into a <code class="calibre23"><tt class="calibre23"><span class="calibre24">double</span></tt></code> named <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code>, from which we&#8217;ll calculate the <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> member. The input statement</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">std::cin &gt;&gt; data1.bookNo &gt;&gt; data1.units_sold &gt;&gt; price;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">uses the dot operator (&#167; <a href="015-1.5._introducing_classes.html#filepos237516">1.5.2</a>, p. <a href="015-1.5._introducing_classes.html#filepos237516">23</a>) to read into the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> members of the object named <code class="calibre23"><tt class="calibre23"><span class="calibre24">data1</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The last statement assigns the product of <code class="calibre23"><tt class="calibre23"><span class="calibre24">data1.units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> into the <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> member of <code class="calibre23"><tt class="calibre23"><span class="calibre24">data1</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Our program will next repeat the same code to read data into <code class="calibre23"><tt class="calibre23"><span class="calibre24">data2</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">read the second transaction</span></span></span><br class="calibre6"/>std::cin &gt;&gt; data2.bookNo &gt;&gt; data2.units_sold &gt;&gt; price;<br class="calibre6"/>data2.revenue = data2.units_sold * price;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Printing the Sum of Two <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Objects</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Our other task is to check that the transactions are for the same <small class="calibre48">ISBN</small>. If so, we&#8217;ll print their sum, otherwise, we&#8217;ll print an error message:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">if (data1.bookNo == data2.bookNo) {<br class="calibre6"/>&#160;&#160;&#160;&#160;unsigned totalCnt = data1.units_sold + data2.units_sold;<br class="calibre6"/>&#160;&#160;&#160;&#160;double totalRevenue = data1.revenue + data2.revenue;<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print:</span></span></span>
<span><span class="calibre50">ISBN</span></span>, <span><span class="calibre45"><span class="calibre16">total sold, total revenue, average price per book</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::cout &lt;&lt; data1.bookNo &lt;&lt; " " &lt;&lt; totalCnt<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; " " &lt;&lt; totalRevenue &lt;&lt; " ";<br class="calibre6"/>&#160;&#160;&#160;&#160;if (totalCnt != 0)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::cout &lt;&lt; totalRevenue/totalCnt &lt;&lt; std::endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;else<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::cout &lt;&lt; "(no sales)" &lt;&lt; std::endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;return 0; // <span><span class="calibre45"><span class="calibre16">indicate success</span></span></span><br class="calibre6"/>} else {&#160;&#160;// <span><span class="calibre45"><span class="calibre16">transactions weren't for the same</span></span></span>
<span><span class="calibre50">ISBN</span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::cerr &lt;&lt; "Data must refer to the same ISBN"<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; std::endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;return -1; // <span><span class="calibre45"><span class="calibre16">indicate failure</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14"><a id="filepos598683"/>In the first <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> we compare the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">data1</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">data2</span></tt></code>. If those members are the same <small class="calibre48">ISBN</small>, we execute the code inside the curly braces. That code adds the components of our two variables. Because we&#8217;ll need to print the average price, we start by computing the total of <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> and store those in <code class="calibre23"><tt class="calibre23"><span class="calibre24">totalCnt</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">totalRevenue</span></tt></code>, respectively. We print those values. Next we check that there were books sold and, if so, print the computed average price per book. If there were no sales, we print a message noting that fact.</p><div class="calibre15">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 2.6.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 2.41:</strong> Use your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class to rewrite the exercises in &#167; <a href="015-1.5._introducing_classes.html#filepos222335">1.5.1</a> (p. <a href="015-1.5._introducing_classes.html#filepos222335">22</a>), &#167; <a href="015-1.5._introducing_classes.html#filepos237516">1.5.2</a> (p. <a href="015-1.5._introducing_classes.html#filepos237516">24</a>), and &#167; <a href="016-1.6._the_bookstore_program.html#filepos244566">1.6</a> (p. <a href="016-1.6._the_bookstore_program.html#filepos244566">25</a>). For now, you should define your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class in the same file as your <code class="calibre23"><tt class="calibre23"><span class="calibre24">main</span></tt></code> function.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos600691" class="calibre37"><span class="calibre5">2.6.3. Writing Our Own Header Files</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Although as we&#8217;ll see in &#167; <a href="183-19.7._local_classes.html#filepos5346574">19.7</a> (p. <a href="183-19.7._local_classes.html#filepos5346574">852</a>), we can define a class inside a function, such classes have limited functionality. As a result, classes ordinarily are not defined inside functions. When we define a class outside of a function, there may be only one definition of that class in any given source file. In addition, if we use a class in several different files, the class&#8217; definition must be the same in each file.</p><div class="calibre15">&#160;</div>
<p class="calibre25">In order to ensure that the class definition is the same in each file, classes are usually defined in header files. Typically, classes are stored in headers whose name derives from the name of the class. For example, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> library type is defined in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> header. Similarly, as we&#8217;ve already seen, we will define our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class in a header file named <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Headers (usually) contain entities (such as class definitions and <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">constexpr</span></tt></code> variables (&#167; <a href="024-2.4._const_qualifier.html#filepos462256">2.4</a>, p. <a href="024-2.4._const_qualifier.html#filepos462256">60</a>)) that can be defined only once in any given file. However, headers often need to use facilities from other headers. For example, because our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class has a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> member, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code> must <code class="calibre23"><tt class="calibre23"><span class="calibre24">#include</span></tt></code> the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> header. As we&#8217;ve seen, programs that use <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> also need to include the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> header in order to use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> member. As a result, programs that use <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> will include the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> header twice: once directly and once as a side effect of including <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code>. Because a header might be included more than once, we need to write our headers in a way that is safe even if the header is included multiple times.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Whenever a header is updated, the source files that use that header must be recompiled to get the new or changed declarations.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">A Brief Introduction to the Preprocessor</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The most common technique for making it safe to include a header multiple times relies on the <strong class="calibre5"><a id="filepos604512" href="028-defined_terms.html#filepos624035">preprocessor</a></strong>. The preprocessor&#8212;which C++ inherits from C&#8212;is a <a id="filepos604639"/>program that runs before the compiler and changes the source text of our programs. Our programs already rely on one preprocessor facility, <code class="calibre23"><tt class="calibre23"><span class="calibre24">#include</span></tt></code>. When the preprocessor sees a <code class="calibre23"><tt class="calibre23"><span class="calibre24">#include</span></tt></code>, it replaces the <code class="calibre23"><tt class="calibre23"><span class="calibre24">#include</span></tt></code> with the contents of the specified header.</p><div class="calibre15">&#160;</div>
<p class="calibre25">C++ programs also use the preprocessor to define <strong class="calibre5"><a id="filepos605213" href="028-defined_terms.html#filepos618920">header guards</a></strong>. Header guards rely on preprocessor variables (&#167; <a href="023-2.3._compound_types.html#filepos409391">2.3.2</a>, p. <a href="023-2.3._compound_types.html#filepos409391">53</a>). Preprocessor variables have one of two possible states: defined or not defined. The <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">#define</span></span></tt></span></span></tt></code> directive takes a name and defines that name as a preprocessor variable. There are two other directives that test whether a given preprocessor variable has or has not been defined: <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">#ifdef</span></span></tt></span></span></tt></code> is true if the variable has been defined, and <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">#ifndef</span></span></tt></span></span></tt></code> is true if the variable has <em class="calibre16">not</em> been defined. If the test is true, then everything following the <code class="calibre23"><tt class="calibre23"><span class="calibre24">#ifdef</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">#ifndef</span></tt></code> is processed up to the matching <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">#endif</span></span></tt></span></span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We can use these facilities to guard against multiple inclusion as follows:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">#ifndef SALES_DATA_H<br class="calibre6"/>#define SALES_DATA_H<br class="calibre6"/>#include &lt;string&gt;<br class="calibre6"/>struct Sales_data {<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string bookNo;<br class="calibre6"/>&#160;&#160;&#160;&#160;unsigned units_sold = 0;<br class="calibre6"/>&#160;&#160;&#160;&#160;double revenue = 0.0;<br class="calibre6"/>};<br class="calibre6"/>#endif</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The first time <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code> is included, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">#ifndef</span></tt></code> test will succeed. The preprocessor will process the lines following <code class="calibre23"><tt class="calibre23"><span class="calibre24">#ifndef</span></tt></code> up to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">#endif</span></tt></code>. As a result, the preprocessor variable <code class="calibre23"><tt class="calibre23"><span class="calibre24">SALES_DATA_H</span></tt></code> will be defined and the contents of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code> will be copied into our program. If we include <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code> later on in the same file, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">#ifndef</span></tt></code> directive will be false. The lines between it and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">#endif</span></tt></code> directive will be ignored.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Preprocessor variable names do not respect C++ scoping rules.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25">Preprocessor variables, including names of header guards, must be unique throughout the program. Typically we ensure uniqueness by basing the guard&#8217;s name on the name of a class in the header. To avoid name clashes with other entities in our programs, preprocessor variables usually are written in all uppercase.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Headers should have guards, even if they aren&#8217;t (yet) included by another header. Header guards are trivial to write, and by habitually defining them you don&#8217;t need to decide whether they are needed.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 2.6.3</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 2.42:</strong> Write your own version of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data.h</span></tt></code> header and use it to rewrite the exercise from &#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos586875">2.6.2</a> (p. <a href="026-2.6._defining_our_own_data_structures.html#filepos586875">76</a>).</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="025-2.5._dealing_with_types.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="027-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
