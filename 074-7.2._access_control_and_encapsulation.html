<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>7.2. Access Control and Encapsulation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="073-7.1._defining_abstract_data_types.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="075-7.3._additional_class_features.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos1833387" class="calibre29"><span class="bold"><a id="filepos1833420" class="calibre2"/>7.2. Access Control and Encapsulation</span></h3><div class="calibre12">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">At this point, we have defined an interface for our class; but nothing forces users to use that interface. Our class is not yet encapsulated&#8212;users can reach inside a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object and meddle with its implementation. In C++ we use <strong class="calibre5"><a id="filepos1833906" href="080-defined_terms.html#filepos2054821">access specifiers</a></strong> to enforce encapsulation:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Members defined after a <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">public</span></span></tt></span></span></tt></code> specifier are accessible to all parts of the program. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> members define the interface to the class.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Members defined after a <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">private</span></span></tt></span></span></tt></code> specifier are accessible to the member functions of the class but are not accessible to code that uses the class. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> sections encapsulate (i.e., hide) the implementation.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">Redefining <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> once again, we now have</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Sales_data {<br class="calibre6"/>public:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">access specifier added</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data() = default;<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(const std::string &amp;s, unsigned n, double p):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bookNo(s), units_sold(n), revenue(p*n) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(const std::string &amp;s): bookNo(s) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(std::istream&amp;);<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string isbn() const { return bookNo; }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data &amp;combine(const Sales_data&amp;);<br class="calibre6"/>private:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">access specifier added</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;double avg_price() const<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{ return units_sold ? revenue/units_sold : 0; }<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string bookNo;<br class="calibre6"/>&#160;&#160;&#160;&#160;unsigned units_sold = 0;<br class="calibre6"/>&#160;&#160;&#160;&#160;double revenue = 0.0;<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The constructors and member functions that are part of the interface (e.g., <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code>) follow the <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> specifier; the data members and the functions that are part of the implementation follow the <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> specifier.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A class may contain zero or more access specifiers, and there are no restrictions on how often an access specifier may appear. Each access specifier specifies the access level of the succeeding members. The specified access level remains in effect until the next access specifier or the end of the class body.</p><div class="calibre22">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Using the <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">class</span></span></tt></span></span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">struct</span></span></tt></span></span></tt></code> Keyword</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">We also made another, more subtle, change: We used the <a id="filepos1838019" href="080-defined_terms.html#filepos2056547"><code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">class</span></span></tt></span></span></tt></code>
<strong class="calibre5">keyword</strong></a> rather than <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">struct</span></span></tt></span></span></tt></code> to open the class definition. This change is strictly stylistic; we can define a class type using either keyword. The only difference between <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code> is the default access level.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A class may define members before the first access specifier. Access to such members depends on how the class is defined. If we use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> keyword, the members defined before the first access specifier are <code class="calibre23"><tt class="calibre23"><span class="calibre24">public;</span></tt></code> if we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code>, then the members are <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25"><a id="filepos1839330"/>As a matter of programming style, when we define a class intending for all of its members to be <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>, we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code>. If we intend to have <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> members, then we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code>.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The <em class="calibre16">only</em> difference between using <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code> and using <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> to define a class is the default access level.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 7.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.16:</strong> What, if any, are the constraints on where and how often an access specifier may appear inside a class definition? What kinds of members should be defined after a <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> specifier? What kinds should be <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.17:</strong> What, if any, are the differences between using <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code>?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.18:</strong> What is encapsulation? Why is it useful?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.19:</strong> Indicate which members of your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Person</span></tt></code> class you would declare as <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> and which you would declare as <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>. Explain your choice.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos1841962" class="calibre37"><span class="calibre5">7.2.1. Friends</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Now that the data members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> are <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">read, print</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code> functions will no longer compile. The problem is that although these functions are part of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> interface, they are not members of the class.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A class can allow another class or function to access its non<code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> members by making that class or function a <strong class="calibre5"><a id="filepos1842929" href="080-defined_terms.html#filepos2061369">friend</a></strong>. A class makes a function its friend by including a declaration for that function preceded by the keyword <code class="calibre23"><tt class="calibre23"><span class="calibre24">friend</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Sales_data {<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">friend declarations for nonmember</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sales_data</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">operations added</span></span></span><br class="calibre6"/>friend Sales_data add(const Sales_data&amp;, const Sales_data&amp;);<br class="calibre6"/>friend std::istream &amp;read(std::istream&amp;, Sales_data&amp;);<br class="calibre6"/>friend std::ostream &amp;print(std::ostream&amp;, const Sales_data&amp;);<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">other members and access specifiers as before</span></span></span><br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data() = default;<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(const std::string &amp;s, unsigned n, double p):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bookNo(s), units_sold(n), revenue(p*n) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(const std::string &amp;s): bookNo(s) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(std::istream&amp;);<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string isbn() const { return bookNo; }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data &amp;combine(const Sales_data&amp;);<br class="calibre6"/>private:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string bookNo;<br class="calibre6"/>&#160;&#160;&#160;&#160;unsigned units_sold = 0;<br class="calibre6"/>&#160;&#160;&#160;&#160;double revenue = 0.0;<br class="calibre6"/>};<br class="calibre6"/><a id="filepos1844799"/>// <span><span class="calibre45"><span class="calibre16">declarations for nonmember parts of the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sales_data</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">interface</span></span></span><br class="calibre6"/>Sales_data add(const Sales_data&amp;, const Sales_data&amp;);<br class="calibre6"/>std::istream &amp;read(std::istream&amp;, Sales_data&amp;);<br class="calibre6"/>std::ostream &amp;print(std::ostream&amp;, const Sales_data&amp;);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Friend declarations may appear only inside a class definition; they may appear anywhere in the class. Friends are not members of the class and are not affected by the access control of the section in which they are declared. We&#8217;ll have more to say about friendship in &#167; <a href="075-7.3._additional_class_features.html#filepos1906774">7.3.4</a> (p. <a href="075-7.3._additional_class_features.html#filepos1906774">279</a>).</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00018.jpg" class="calibre9"/> Tip</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Ordinarily it is a good idea to group friend declarations together at the beginning or end of the class definition.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre35"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/>Key Concept: Benefits of Encapsulation</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Encapsulation provides two important advantages:</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; User code cannot inadvertently corrupt the state of an encapsulated object.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; The implementation of an encapsulated class can change over time without requiring changes in user-level code.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">By defining data members as <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>, the class author is free to make changes in the data. If the implementation changes, only the class code needs to be examined to see what effect the change may have. User code needs to change only when the interface changes. If the data are <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>, then any code that used the old data members might be broken. It would be necessary to locate and rewrite any code that relied on the old representation before the program could be used again.</p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">Another advantage of making data members <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> is that the data are protected from mistakes that users might introduce. If there is a bug that corrupts an object&#8217;s state, the places to look for the bug are localized: Only code that is part of the implementation could be responsible for the error. The search for the mistake is limited, greatly easing the problems of maintenance and program correctness.</p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Although user code need not change when a class definition changes, the source files that use a class must be recompiled any time the class changes.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Declarations for Friends</span></h5><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre14">A friend declaration only specifies access. It is not a general declaration of the function. If we want users of the class to be able to call a friend function, then we must also declare the function separately from the friend declaration.</p><div class="calibre15">&#160;</div>
<p class="calibre25">To make a friend visible to users of the class, we usually declare each friend (outside the class) in the same header as the class itself. Thus, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> header should provide separate declarations (aside from the friend declarations inside the class body) for <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code>.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Many compilers do not enforce the rule that friend functions must be declared <em class="calibre16">outside</em> the class before they can be used.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25"><a id="filepos1850253"/>Some compilers allow calls to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">friend</span></tt></code> function when there is no ordinary declaration for that function. Even if your compiler allows such calls, it is a good idea to provide separate declarations for <code class="calibre23"><tt class="calibre23"><span class="calibre24">friend</span></tt></code>s. That way you won&#8217;t have to change your code if you use a compiler that enforces this rule.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 7.2.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.20:</strong> When are friends useful? Discuss the pros and cons of using friends.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.21:</strong> Update your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class to hide its implementation. The programs you&#8217;ve written to use <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> operations should still continue to work. Recompile those programs with your new class definition to verify that they still work.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.22:</strong> Update your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Person</span></tt></code> class to hide its implementation.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="073-7.1._defining_abstract_data_types.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="075-7.3._additional_class_features.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
