<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>8.3. string Streams</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="084-8.2._file_input_and_output.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="086-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos2143868" class="calibre29"><span class="bold"><a id="filepos2143901" class="calibre2"/>8.3. <code class="calibre54"><tt class="calibre54"><span class="calibre55"><span class="calibre2"><tt class="calibre54"><span class="calibre56"><span class="bold">string</span></span></tt></span></span></tt></code> Streams</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">sstream</span></tt></code> header defines three types to support in-memory IO; these types read from or write to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> as if the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> were an IO stream.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos2144614" href="087-defined_terms.html#filepos2168970">istringstream</a></span></span></tt></span></span></tt></code> type reads a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos2144885" href="087-defined_terms.html#filepos2169640">ostringstream</a></span></span></tt></span></span></tt></code> writes a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos2145156" href="087-defined_terms.html#filepos2170815">stringstream</a></span></span></tt></span></span></tt></code> reads and writes the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>. Like the <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> types, the types defined in <code class="calibre23"><tt class="calibre23"><span class="calibre24">sstream</span></tt></code> inherit from the types we have used from the <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code> header. In addition to the operations they inherit, the types defined in <code class="calibre23"><tt class="calibre23"><span class="calibre24">sstream</span></tt></code> add members to manage the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> associated with the stream. These operations are listed in <a href="085-8.3._string_streams.html#filepos2146187">Table 8.5</a>. They may be called on <code class="calibre23"><tt class="calibre23"><span class="calibre24">stringstream</span></tt></code> objects but not on the other IO types.</p><div class="calibre22">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos2146187"/>Table 8.5. <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">stringstream</span></span></tt></span></span></tt></code>-Specific Operations</span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00045.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<p class="calibre25">Note that although <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">sstream</span></tt></code> share the interface to <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code>, they have no other interrelationship. In particular, we cannot use <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">close</span></tt></code> on a <code class="calibre23"><tt class="calibre23"><span class="calibre24">stringstream</span></tt></code>, nor can we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">str</span></tt></code> on an <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code>.</p><div class="calibre22">&#160;</div>
<h4 id="filepos2147258" class="calibre37"><span class="calibre5">8.3.1. Using an <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">istringstream</span></span></tt></span></span></tt></code></span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">An <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> is often used when we have some work to do on an entire line, and other work to do with individual words within a line.</p><div class="calibre15">&#160;</div>
<p class="calibre25">As one example, assume we have a file that lists people and their associated phone numbers. Some people have only one number, but others have several&#8212;a home phone, work phone, cell number, and so on. Our input file might look like the following:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">morgan 2015552368 8625550123</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">drew 9735550130</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">lee 6095550132 2015550175 8005550000</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Each record in this file starts with a name, which is followed by one or more phone numbers. We&#8217;ll start by defining a simple class to represent our input data:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">members are</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">public</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">by default; see &#167; 7.2 (p. 268)</span></span></span><br class="calibre6"/>struct PersonInfo {<br class="calibre6"/>&#160;&#160;&#160;&#160;string name;<br class="calibre6"/>&#160;&#160;&#160;&#160;vector&lt;string&gt; phones;<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Objects of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">PersonInfo</span></tt></code> will have one member that represents the person&#8217;s name and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> holding a varying number of associated phone numbers.</p><div class="calibre15">&#160;</div>
<p class="calibre25"><a/>Our program will read the data file and build up a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of <code class="calibre23"><tt class="calibre23"><span class="calibre24">PersonInfo</span></tt></code>. Each element in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> will correspond to one record in the file. We&#8217;ll process the input in a loop that reads a record and then extracts the name and phone numbers for each person:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">string line, word;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">will hold a line and word from input, respectively</span></span></span><br class="calibre6"/>vector&lt;PersonInfo&gt; people; // <span><span class="calibre45"><span class="calibre16">will hold all the records from the input</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">read the input a line at a time until</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cin</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">hits end-of-file (or another error)</span></span></span><br class="calibre6"/>while (getline(cin, line)) {<br class="calibre6"/>&#160;&#160;&#160;&#160;PersonInfo info;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">create an object to hold this record's data</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;istringstream record(line); // <span><span class="calibre45"><span class="calibre16">bind</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">record</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">to the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">line</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">we just read</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;record &gt;&gt; info.name;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">read the name</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;while (record &gt;&gt; word)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">read the phone numbers</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;info.phones.push_back(word);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">and store them</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;people.push_back(info); // <span><span class="calibre45"><span class="calibre16">append this record to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">people</span></span></tt></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Here we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> to read an entire record from the standard input. If the call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> succeeds, then <code class="calibre23"><tt class="calibre23"><span class="calibre24">line</span></tt></code> holds a record from the input file. Inside the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> we define a local <code class="calibre23"><tt class="calibre23"><span class="calibre24">PersonInfo</span></tt></code> object to hold data from the current record.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Next we bind an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> to the line that we just read. We can now use the input operator on that <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> to read each element in the current record. We first read the name followed by a <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> loop that will read the phone numbers for that person.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The inner <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> ends when we&#8217;ve read all the data in <code class="calibre23"><tt class="calibre23"><span class="calibre24">line</span></tt></code>. This loop works analogously to others we&#8217;ve written to read <code class="calibre23"><tt class="calibre23"><span class="calibre24">cin</span></tt></code>. The difference is that this loop reads data from a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> rather than from the standard input. When the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> has been completely read, &#8220;end-of-file&#8221; is signaled and the next input operation on <code class="calibre23"><tt class="calibre23"><span class="calibre24">record</span></tt></code> will fail.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We end the outer <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> loop by appending the <code class="calibre23"><tt class="calibre23"><span class="calibre24">PersonInfo</span></tt></code> we just processed to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>. The outer <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> continues until we hit end-of-file on <code class="calibre23"><tt class="calibre23"><span class="calibre24">cin</span></tt></code>.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 8.3.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.9:</strong> Use the function you wrote for the first exercise in &#167; <a href="083-8.1._the_io_classes.html#filepos2085669">8.1.2</a> (p. <a href="083-8.1._the_io_classes.html#filepos2085669">314</a>) to print the contents of an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> object.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.10:</strong> Write a program to store each line from a file in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector&lt;string&gt;</span></tt></code>. Now use an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> to read each element from the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> a word at a time.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.11:</strong> The program in this section defined its <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> object inside the outer <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> loop. What changes would you need to make if <code class="calibre23"><tt class="calibre23"><span class="calibre24">record</span></tt></code> were defined outside that loop? Rewrite the program, moving the definition of <code class="calibre23"><tt class="calibre23"><span class="calibre24">record</span></tt></code> outside the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code>, and see whether you thought of all the changes that are needed.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.12:</strong> Why didn&#8217;t we use in-class initializers in <code class="calibre23"><tt class="calibre23"><span class="calibre24">PersonInfo</span></tt></code>?</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos2157138" class="calibre37"><span class="calibre5"><a id="filepos2157171"/>8.3.2. Using <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">ostringstream</span></span></tt></span></span></tt></code>s</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">An <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostringstream</span></tt></code> is useful when we need to build up our output a little at a time but do not want to print the output until later. For example, we might want to validate and reformat the phone numbers we read in the previous example. If all the numbers are valid, we want to print a new file containing the reformatted numbers. If a person has any invalid numbers, we won&#8217;t put them in the new file. Instead, we&#8217;ll write an error message containing the person&#8217;s name and a list of their invalid numbers.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Because we don&#8217;t want to include any data for a person with an invalid number, we can&#8217;t produce the output until we&#8217;ve seen and validated all their numbers. We can, however, &#8220;write&#8221; the output to an in-memory <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostringstream</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">for (const auto &amp;entry : people) {&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">for each entry in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">people</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;ostringstream formatted, badNums; // <span><span class="calibre45"><span class="calibre16">objects created on each loop</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;for (const auto &amp;nums : entry.phones) { // <span><span class="calibre45"><span class="calibre16">for each number</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (!valid(nums)) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;badNums &lt;&lt; " " &lt;&lt; nums;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">string</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">badNums</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} else<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">''writes'' to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">formatted'</span></span></tt></span><span><span class="calibre45"><span class="calibre16">s</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">string</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;formatted &lt;&lt; " " &lt;&lt; format(nums);<br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;if (badNums.str().empty())&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">there were no bad numbers</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;os &lt;&lt; entry.name &lt;&lt; " "&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print the name</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; formatted.str() &lt;&lt; endl; // <span><span class="calibre45"><span class="calibre16">and reformatted numbers</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;else&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">otherwise, print the name and bad numbers</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cerr &lt;&lt; "input error: " &lt;&lt; entry.name<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; " invalid number(s) " &lt;&lt; badNums.str() &lt;&lt; endl;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">In this program, we&#8217;ve assumed two functions, <code class="calibre23"><tt class="calibre23"><span class="calibre24">valid</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">format</span></tt></code>, that validate and reformat phone numbers, respectively. The interesting part of the program is the use of the string streams <code class="calibre23"><tt class="calibre23"><span class="calibre24">formatted</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">badNums</span></tt></code>. We use the normal output operator (<code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;&lt;</span></tt></code>) to write to these objects. But, these &#8220;writes&#8221; are really <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> manipulations. They add characters to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s inside <code class="calibre23"><tt class="calibre23"><span class="calibre24">formatted</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">badNums</span></tt></code>, respectively.</p><div class="calibre15">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 8.3.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.13:</strong> Rewrite the phone number program from this section to read from a named file rather than from <code class="calibre23"><tt class="calibre23"><span class="calibre24">cin</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.14:</strong> Why did we declare <code class="calibre23"><tt class="calibre23"><span class="calibre24">entry</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">nums</span></tt></code> as <code class="calibre23"><tt class="calibre23"><span class="calibre24">const auto &amp;</span></tt></code>?</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="084-8.2._file_input_and_output.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="086-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
