<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>17.1. The tuple Type</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="162-chapter_17._specialized_library_facilities.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="164-17.2._the_bitset_type.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos4566281" class="calibre29"><span class="bold">17.1. The <code class="calibre54"><tt class="calibre54"><span class="calibre55"><span class="calibre2"><tt class="calibre54"><span class="calibre56"><span class="bold">tuple</span></span></tt></span></span></tt></code> Type</span></h3><div class="calibre12">&#160;</div>
<div class="calibre28"><a id="filepos4566514"/><img alt="Image" src="images/00008.jpg" class="calibre9"/></div>
<p class="calibre14">A <strong class="calibre5"><a id="filepos4566611" href="169-defined_terms.html#filepos4851876">tuple</a></strong> is a template that is similar to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> (&#167; <a href="108-11.2._overview_of_the_associative_containers.html#filepos2764131">11.2.3</a>, p. <a href="108-11.2._overview_of_the_associative_containers.html#filepos2764131">426</a>). Each <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> type has different types for its members, but every <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> always has exactly two members. A <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> also has members whose types vary from one <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> type to another, but a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> can have any number of members. Each distinct <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> type has a fixed number of members, but the number of members in one <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> type can differ from the number of members in another.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> is most useful when we want to combine some data into a single object but do not want to bother to define a data structure to represent those data. <a href="163-17.1._the_tuple_type.html#filepos4568379">Table 17.1</a> lists the operations that <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>s support. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> type, along with its companion types and functions, are defined in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> header.</p><div class="calibre22">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos4568379"/>Table 17.1. Operations on <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">tuple</span></span></tt></span></span></tt></code>s</span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00108.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">A <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> can be thought of as a &#8220;quick and dirty&#8221; data structure.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos4569134" class="calibre37"><span class="calibre5">17.1.1. Defining and Initializing <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">tuple</span></span></tt></span></span></tt></code>s</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">When we define a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>, we name the type(s) of each of its members:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">tuple&lt;size_t, size_t, size_t&gt; threeD; // <span><span class="calibre45"><span class="calibre16">all three members set to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">0</span></span></tt></span><br class="calibre6"/>tuple&lt;string, vector&lt;double&gt;, int, list&lt;int&gt;&gt;<br class="calibre6"/>&#160;&#160;&#160;&#160;someVal("constants", {3.14, 2.718}, 42, {0,1,2,3,4,5});</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">When we create a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> object, we can use the default <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> constructor, which value initializes (&#167; <a href="032-3.3._library_vector_type.html#filepos744172">3.3.1</a>, p. <a href="032-3.3._library_vector_type.html#filepos744172">98</a>) each member, or we can supply an initializer for each member as we do in the initialization of <code class="calibre23"><tt class="calibre23"><span class="calibre24">someVal</span></tt></code>. This <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> constructor is <code class="calibre23"><tt class="calibre23"><span class="calibre24">explicit</span></tt></code> (&#167; <a href="077-7.5._constructors_revisited.html#filepos1990205">7.5.4</a>, p. <a href="077-7.5._constructors_revisited.html#filepos1990205">296</a>), so we must use the direct initialization syntax:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">tuple&lt;size_t, size_t, size_t&gt; threeD =&#160;&#160;{1,2,3};&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error</span></span></span><br class="calibre6"/>tuple&lt;size_t, size_t, size_t&gt; threeD{1,2,3};&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">Alternatively, similar to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">make_pair</span></tt></code> function (&#167; <a href="108-11.2._overview_of_the_associative_containers.html#filepos2764131">11.2.3</a>, p. <a href="108-11.2._overview_of_the_associative_containers.html#filepos2764131">428</a>), the library defines a <code class="calibre23"><tt class="calibre23"><span class="calibre24">make_tuple</span></tt></code> function that generates a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> object:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">tuple</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">that represents a bookstore transaction:</span></span></span>
<span><span class="calibre50">ISBN</span></span><span><span class="calibre45"><span class="calibre16">, count, price per book</span></span></span><br class="calibre6"/>auto item = make_tuple("0-999-78345-X", 3, 20.00);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Like <code class="calibre23"><tt class="calibre23"><span class="calibre24">make_pair</span></tt></code>, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">make_tuple</span></tt></code> function uses the types of the supplied initializers to infer the type of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>. In this case, <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code> is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> whose type is <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple&lt;const char*, int</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">double&gt;</span></tt></code>.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos4573476"/>Accessing the Members of a <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">tuple</span></span></tt></span></span></tt></code></span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">A <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> always has two members, which makes it possible for the library to give these members names (i.e., <code class="calibre23"><tt class="calibre23"><span class="calibre24">first</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">second</span></tt></code>). No such naming convention is possible for <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> because there is no limit on the number of members a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> type can have. As a result, the members are unnamed. Instead, we access the members of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> through a library function template named <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos4574548" href="169-defined_terms.html#filepos4844947">get</a></span></span></tt></span></span></tt></code>. To use <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> we must specify an explicit template argument (&#167; <a href="155-16.2._template_argument_deduction.html#filepos4344365">16.2.2</a>, p. <a href="155-16.2._template_argument_deduction.html#filepos4344365">682</a>), which is the position of the member we want to access. We pass a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> object to <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code>, which returns a reference to the specified member:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">auto book = get&lt;0&gt;(item);&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">returns the first member of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">item</span></span></tt></span><br class="calibre6"/>auto cnt = get&lt;1&gt;(item); &#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">returns the second member of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">item</span></span></tt></span><br class="calibre6"/>auto price = get&lt;2&gt;(item)/cnt; // <span><span class="calibre45"><span class="calibre16">returns the last member of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">item</span></span></tt></span><br class="calibre6"/>get&lt;2&gt;(item) *= 0.8;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">apply 20% discount</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The value inside the brackets must be an integral constant expression (&#167; <a href="024-2.4._const_qualifier.html#filepos520427">2.4.4</a>, p. <a href="024-2.4._const_qualifier.html#filepos520427">65</a>). As usual, we count from 0, meaning that <code class="calibre23"><tt class="calibre23"><span class="calibre24">get&lt;0&gt;</span></tt></code> is the first member.</p><div class="calibre15">&#160;</div>
<p class="calibre25">If we have a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> whose precise type details we don&#8217;t know, we can use two auxilliary class templates to find the number and types of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>&#8217;s members:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"><a id="filepos4577026"/></span></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">typedef decltype(item) trans; // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">trans</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is the type of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">item</span></span></tt></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">returns the number of members in object's of type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">trans</span></span></tt></span><br class="calibre6"/>size_t sz = tuple_size&lt;trans&gt;::value; &#160;// <span><span class="calibre45"><span class="calibre16">returns 3</span></span></span><br class="calibre6"/>// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cnt</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has the same type as the second member in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">item</span></span></tt></span><br class="calibre6"/>tuple_element&lt;1, trans&gt;::type cnt = get&lt;1&gt;(item); // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cnt</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is an</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">int</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">To use <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple_size</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple_element</span></tt></code>, we need to know the type of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> object. As usual, the easiest way to determine an object&#8217;s type is to use <code class="calibre23"><tt class="calibre23"><span class="calibre24">decltype</span></tt></code> (&#167; <a href="025-2.5._dealing_with_types.html#filepos562878">2.5.3</a>, p. <a href="025-2.5._dealing_with_types.html#filepos562878">70</a>). Here, we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">decltype</span></tt></code> to define a type alias for the type of <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code>, which we use to instantiate both templates.</p><div class="calibre15">&#160;</div>
<p class="calibre25"><code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple_size</span></tt></code> has a <code class="calibre23"><tt class="calibre23"><span class="calibre24">public static</span></tt></code> data member named <code class="calibre23"><tt class="calibre23"><span class="calibre24">value</span></tt></code> that is the number or members in the specified <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple_element</span></tt></code> template takes an index as well as a tuple type. <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple_element</span></tt></code> has a <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> type member named <code class="calibre23"><tt class="calibre23"><span class="calibre24">type</span></tt></code> that is the type of the specified member of the specified <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> type. Like <code class="calibre23"><tt class="calibre23"><span class="calibre24">get, tuple_element</span></tt></code> uses indices starting at 0.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Relational and Equality Operators</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> relational and equality operators behave similarly to the corresponding operations on containers (&#167; <a href="090-9.2._container_library_overview.html#filepos2255277">9.2.7</a>, p. <a href="090-9.2._container_library_overview.html#filepos2255277">340</a>). These operators execute pairwise on the members of the left-hand and right-hand <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>s. We can compare two <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>s only if they have the same number of members. Moreover, to use the equality or inequality operators, it must be legal to compare each pair of members using the <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> operator; to use the relational operators, it must be legal to use <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code>. For example:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">tuple&lt;string, string&gt; duo("1", "2");<br class="calibre6"/>tuple&lt;size_t, size_t&gt; twoD(1, 2);<br class="calibre6"/>bool b = (duo == twoD); // <span><span class="calibre45"><span class="calibre16">error: can't compare a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">size_t</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">string</span></span></tt></span><br class="calibre6"/>tuple&lt;size_t, size_t, size_t&gt; threeD(1, 2, 3);<br class="calibre6"/>b = (twoD &lt; threeD);&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error: differing number of members</span></span></span><br class="calibre6"/>tuple&lt;size_t, size_t&gt; origin(0, 0);<br class="calibre6"/>b = (origin &lt; twoD);&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">b</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">true</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> defines the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> operators, we can pass sequences of <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>s to the algorithms and can use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> as key type in an ordered container.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 17.1.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.1:</strong> Define a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> that holds three <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> values and initialize the members to <code class="calibre23"><tt class="calibre23"><span class="calibre24">10, 20</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">30</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.2:</strong> Define a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> that holds a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>, a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector&lt;string&gt;</span></tt></code>, and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair&lt;string, int&gt;</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.3:</strong> Rewrite the <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> programs from &#167; <a href="116-12.3._using_the_library_a_textquery_program.html#filepos3140586">12.3</a> (p. <a href="116-12.3._using_the_library_a_textquery_program.html#filepos3140586">484</a>) to use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> instead of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> class. Explain which design you think is better and why.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos4585029" class="calibre37"><span class="calibre5"><a id="filepos4585062"/>17.1.2. Using a <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">tuple</span></span></tt></span></span></tt></code> to Return Multiple Values</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">A common use of <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> is to return multiple values from a function. For example, our bookstore might be one of several stores in a chain. Each store would have a transaction file that holds data on each book that the store recently sold. We might want to look at the sales for a given book in all the stores.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We&#8217;ll assume that we have a file of transactions for each store. Each of these per-store transaction files will contain all the transactions for each book grouped together. We&#8217;ll further assume that some other function reads these transaction files, builds a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector&lt;Sales_data&gt;</span></tt></code> for each store, and puts those <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>s in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>s:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">each element in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">files</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">holds the transactions for a particular store</span></span></span><br class="calibre6"/>vector&lt;vector&lt;Sales_data&gt;&gt; files;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">We&#8217;ll write a function that will search <code class="calibre23"><tt class="calibre23"><span class="calibre24">files</span></tt></code> looking for the stores that sold a given book. For each store that has a matching transaction, we&#8217;ll create a <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> to hold the index of that store and two iterators. The index will be the position of the matching store in <code class="calibre23"><tt class="calibre23"><span class="calibre24">files</span></tt></code>. The iterators will mark the first and one past the last record for the given book in that store&#8217;s <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector&lt;Sales_data&gt;</span></tt></code>.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">A Function That Returns a <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">tuple</span></span></tt></span></span></tt></code></span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">We&#8217;ll start by writing the function to find a given book. This function&#8217;s arguments are the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>s just described, and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> that represents the book&#8217;s <small class="calibre48">ISBN</small>. Our function will return a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>s that will have an entry for each store with at least one sale for the given book:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">matches</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has three members: an index of a store and iterators into that store's</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">vector</span></span></tt></span><br class="calibre6"/>typedef tuple&lt;vector&lt;Sales_data&gt;::size_type,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vector&lt;Sales_data&gt;::const_iterator,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vector&lt;Sales_data&gt;::const_iterator&gt; matches;<br class="calibre6"/>// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">files</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">holds the transactions for every store</span></span></span><br class="calibre6"/>// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">findBook</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">returns a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">vector</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">with an entry for each store that sold the given book</span></span></span><br class="calibre6"/>vector&lt;matches&gt;<br class="calibre6"/>findBook(const vector&lt;vector&lt;Sales_data&gt;&gt; &amp;files,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;const string &amp;book)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;vector&lt;matches&gt; ret; // <span><span class="calibre45"><span class="calibre16">initially empty</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">for each store find the range of matching books, if any</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;for (auto it = files.cbegin(); it != files.cend(); ++it) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">find the range of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sales_data</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">that have the same</span></span></span>
<span><span class="calibre50">ISBN</span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;auto found = equal_range(it-&gt;cbegin(), it-&gt;cend(),<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;book, compareIsbn);<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (found.first != found.second) // <span><span class="calibre45"><span class="calibre16">this store had sales</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">remember the index of this store and the matching range</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ret.push_back(make_tuple(it - files.cbegin(),<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;found.first, found.second));<br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;return ret; // <span><span class="calibre45"><span class="calibre16">empty if no matches found</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14"><a id="filepos4592310"/>The <code class="calibre23"><tt class="calibre23"><span class="calibre24">for</span></tt></code> loop iterates through the elements in <code class="calibre23"><tt class="calibre23"><span class="calibre24">files</span></tt></code>. Those elements are themselves <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>s. Inside the <code class="calibre23"><tt class="calibre23"><span class="calibre24">for</span></tt></code> we call a library algorithm named <code class="calibre23"><tt class="calibre23"><span class="calibre24">equal_range</span></tt></code>, which operates like the associative container member of the same name (&#167; <a href="109-11.3._operations_on_associative_containers.html#filepos2829910">11.3.5</a>, p. <a href="109-11.3._operations_on_associative_containers.html#filepos2829910">439</a>). The first two arguments to <code class="calibre23"><tt class="calibre23"><span class="calibre24">equal_range</span></tt></code> are iterators denoting an input sequence (&#167; <a href="098-10.1._overview.html#filepos2458324">10.1</a>, p. <a href="098-10.1._overview.html#filepos2458324">376</a>). The third argument is a value. By default, <code class="calibre23"><tt class="calibre23"><span class="calibre24">equal_range</span></tt></code> uses the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> operator to compare elements. Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> does not have a <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> operator, we pass a pointer to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">compareIsbn</span></tt></code> function (&#167; <a href="108-11.2._overview_of_the_associative_containers.html#filepos2751456">11.2.2</a>, p. <a href="108-11.2._overview_of_the_associative_containers.html#filepos2751456">425</a>).</p><div class="calibre15">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">equal_range</span></tt></code> algorithm returns a <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> of iterators that denote a range of elements. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">book</span></tt></code> is not found, then the iterators will be equal, indicating that the range is empty. Otherwise, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">first</span></tt></code> member of the returned <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> will denote the first matching transaction and <code class="calibre23"><tt class="calibre23"><span class="calibre24">second</span></tt></code> will be one past the last.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Using a <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">tuple</span></span></tt></span></span></tt></code> Returned by a Function</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Once we have built our <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of stores with matching transactions, we need to process these transactions. In this program, we&#8217;ll report the total sales results for each store that has a matching sale:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">void reportResults(istream &amp;in, ostream &amp;os,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;const vector&lt;vector&lt;Sales_data&gt;&gt; &amp;files)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;string s;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">book to look for</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;while (in &gt;&gt; s) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;auto trans = findBook(files, s); // <span><span class="calibre45"><span class="calibre16">stores that sold this book</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (trans.empty()) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cout &lt;&lt; s &lt;&lt; " not found in any stores" &lt;&lt; endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;continue;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">get the next book to look for</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for (const auto &amp;store : trans)&#160;&#160;// <span><span class="calibre45"><span class="calibre16">for every store with a sale</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">get&lt;n&gt;</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">returns the specified member from the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">tuple</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">store</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;os &lt;&lt; "store " &lt;&lt; get&lt;0&gt;(store) &lt;&lt; " sales: "<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; accumulate(get&lt;1&gt;(store), get&lt;2&gt;(store),<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Sales_data(s))<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> loop repeatedly reads the <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> named <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code> to get the next book to process. We call <code class="calibre23"><tt class="calibre23"><span class="calibre24">findBook</span></tt></code> to see if <code class="calibre23"><tt class="calibre23"><span class="calibre24">s</span></tt></code> is present, and assign the results to <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>. We use <code class="calibre23"><tt class="calibre23"><span class="calibre24">auto</span></tt></code> to simplify writing the type of <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>, which is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code>s.</p><div class="calibre15">&#160;</div>
<p class="calibre25">If <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> is empty, there were no sales for <code class="calibre23"><tt class="calibre23"><span class="calibre24">s</span></tt></code>. In this case, we print a message and return to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> to get the next book to look for.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">for</span></tt></code> loop binds <code class="calibre23"><tt class="calibre23"><span class="calibre24">store</span></tt></code> to each element in <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>. Because we don&#8217;t intend to change the elements in <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>, we declare <code class="calibre23"><tt class="calibre23"><span class="calibre24">store</span></tt></code> as a reference to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>. We use <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> to print the relevant data: <code class="calibre23"><tt class="calibre23"><span class="calibre24">get&lt;0&gt;</span></tt></code> is the index of the corresponding store, <code class="calibre23"><tt class="calibre23"><span class="calibre24">get&lt;1&gt;</span></tt></code> is the iterator denoting the first transaction, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">get&lt;2&gt;</span></tt></code> is the iterator one past the last.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> defines the addition operator (&#167; <a href="132-14.3._arithmetic_and_relational_operators.html#filepos3595833">14.3</a>, p. <a href="132-14.3._arithmetic_and_relational_operators.html#filepos3595833">560</a>), we can use the library <code class="calibre23"><tt class="calibre23"><span class="calibre24">accumulate</span></tt></code> algorithm (&#167; <a href="099-10.2._a_first_look_at_the_algorithms.html#filepos2473899">10.2.1</a>, p. <a href="099-10.2._a_first_look_at_the_algorithms.html#filepos2473899">379</a>) to sum the transactions. We <a id="filepos4600575"/>pass a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object initialized by the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> constructor that takes a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> (&#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1802479">7.1.4</a>, p. <a href="073-7.1._defining_abstract_data_types.html#filepos1802479">264</a>) as the starting point for the summation. That constructor initializes the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> member from the given <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> members to zero.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 17.1.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.4:</strong> Write and test your own version of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">findBook</span></tt></code> function.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.5:</strong> Rewrite <code class="calibre23"><tt class="calibre23"><span class="calibre24">findBook</span></tt></code> to return a <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> that holds an index and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code> of iterators.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.6:</strong> Rewrite <code class="calibre23"><tt class="calibre23"><span class="calibre24">findBook</span></tt></code> so that it does not use <code class="calibre23"><tt class="calibre23"><span class="calibre24">tuple</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">pair</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.7:</strong> Explain which version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">findBook</span></tt></code> you prefer and why.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.8:</strong> What would happen if we passed <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data()</span></tt></code> as the third parameter to <code class="calibre23"><tt class="calibre23"><span class="calibre24">accumulate</span></tt></code> in the last code example in this section?</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="162-chapter_17._specialized_library_facilities.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="164-17.2._the_bitset_type.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
