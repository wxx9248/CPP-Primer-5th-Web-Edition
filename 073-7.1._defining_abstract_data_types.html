<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>7.1. Defining Abstract Data Types</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="072-chapter_7._classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="074-7.2._access_control_and_encapsulation.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos1745423" class="calibre29"><span class="bold">7.1. Defining Abstract Data Types</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> class that we used in <a href="010-chapter_1._getting_started.html#filepos113276">Chapter 1</a> is an abstract data type. We use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> object by using its interface (i.e., the operations described in &#167; <a href="015-1.5._introducing_classes.html#filepos222335">1.5.1</a> (p. <a href="015-1.5._introducing_classes.html#filepos222335">20</a>)). We have no access to the data members stored in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> object. Indeed, we don&#8217;t even know what data members that class has.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class (&#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">2.6.1</a>, p. <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">72</a>) is not an abstract data type. It lets users of the class access its data members and forces users to write their own operations. To make <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> an abstract type, we need to define operations for users of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> to use. Once <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> defines its own operations, we can encapsulate (that is, hide) its data members.</p><div class="calibre22">&#160;</div>
<h4 id="filepos1746914" class="calibre37"><span class="calibre5">7.1.1. Designing the <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Class</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Ultimately, we want <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> to support the same set of operations as the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> class. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> class had one <strong class="calibre5"><a id="filepos1747562" href="080-defined_terms.html#filepos2062846">member function</a></strong> (&#167; <a href="015-1.5._introducing_classes.html#filepos237516">1.5.2</a>, p. <a href="015-1.5._introducing_classes.html#filepos237516">23</a>), named <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code>, and supported the <code class="calibre23"><tt class="calibre23"><span class="calibre24">+</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">=</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">+=, &lt;&lt;</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;</span></tt></code> operators.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We&#8217;ll learn how to define our own operators in <a href="129-chapter_14._overloaded_operations_and_conversions.html#filepos3544393">Chapter 14</a>. For now, we&#8217;ll define ordinary (named) functions for these operations. For reasons that we will explain in &#167; <a href="130-14.1._basic_concepts.html#filepos3549336">14.1</a> (p. <a href="130-14.1._basic_concepts.html#filepos3549336">555</a>), the functions that do addition and IO will not be members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>. Instead, we&#8217;ll define those functions as ordinary functions. The function that handles compound assignment will be a member, and for reasons we&#8217;ll explain in &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1827343">7.1.5</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1827343">267</a>), our class doesn&#8217;t need to define assignment.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Thus, the interface to <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> consists of the following operations:</p><div class="calibre22">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; An <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> member function to return the object&#8217;s <small class="calibre48">ISBN</small></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> member function to add one <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object into another</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A function named <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code> to add two <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> objects</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> function to read data from an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> into a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> function to print the value of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object on an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code></p></blockquote><div class="calibre15">&#160;</div>
<div class="calibre35"><blockquote class="calibre26"><a id="filepos1750685"/><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre14"><span class="calibre5"><a/>Key Concept: Different Kinds of Programming Roles</span></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Programmers tend to think about the people who will run their applications as <em class="calibre16">users.</em> Similarly a class designer designs and implements a class for <em class="calibre16">users</em> of that class. In this case, the user is a programmer, not the ultimate user of the application.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">When we refer to a <em class="calibre16">user,</em> the context makes it clear which kind of user is meant. If we speak of <em class="calibre16">user code</em> or the <em class="calibre16">user</em> of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class, we mean a programmer who is using a class. If we speak of the <em class="calibre16">user</em> of the bookstore application, we mean the manager of the store who is running the application.</p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">C++ programmers tend to speak of <em class="calibre16">users</em> interchangeably as users of the application or users of a class.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">In simple applications, the user of a class and the designer of the class might be one and the same person. Even in such cases, it is useful to keep the roles distinct. When we design the interface of a class, we should think about how easy it will be to use the class. When we use the class, we shouldn&#8217;t think about how the class works.</p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">Authors of successful applications do a good job of understanding and implementing the needs of the application&#8217;s users. Similarly, good class designers pay close attention to the needs of the programmers who will use the class. A well-designed class has an interface that is intuitive and easy to use and has an implementation that is efficient enough for its intended use.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Using the Revised <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Class</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Before we think about how to implement our class, let&#8217;s look at how we can use our interface functions. As one example, we can use these functions to write a version of the bookstore program from &#167; <a href="016-1.6._the_bookstore_program.html#filepos244566">1.6</a> (p. <a href="016-1.6._the_bookstore_program.html#filepos244566">24</a>) that works with <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> objects rather than <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code>s:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data total;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">variable to hold the running sum</span></span></span><br class="calibre6"/>if (read(cin, total))&#160;&#160;{&#160;&#160;// <span><span class="calibre45"><span class="calibre16">read the first transaction</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data trans;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">variable to hold data for the next transaction</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;while(read(cin, trans)) {&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">read the remaining transactions</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (total.isbn() == trans.isbn())&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">check the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">isbn</span></span></tt></span><span><span class="calibre45"><span class="calibre16">s</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;total.combine(trans);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">update the running</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">total</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print(cout, total) &lt;&lt; endl;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print the results</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;total = trans;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">process the next book</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;print(cout, total) &lt;&lt; endl;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print the last transaction</span></span></span><br class="calibre6"/>} else {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">there was no input</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;cerr &lt;&lt; "No data?!" &lt;&lt; endl;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">notify the user</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">We start by defining a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object to hold the running total. Inside the <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> condition, we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> to read the first transaction into <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>. This condition works like other loops we&#8217;ve written that used the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;</span></tt></code> operator. Like the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;</span></tt></code> operator, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> function will return its stream parameter, which the condition <a id="filepos1757625"/>checks (&#167; <a href="049-4.11._type_conversions.html#filepos1178431">4.11.2</a>, p. <a href="049-4.11._type_conversions.html#filepos1178431">162</a>). If the <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> fails, we fall through to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">else</span></tt></code> to print an error message.</p><div class="calibre15">&#160;</div>
<p class="calibre25">If there are data to read, we define <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>, which we&#8217;ll use to hold each transaction. The condition in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> also checks the stream returned by <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code>. So long as the input operations in <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> succeed, the condition succeeds and we have another transaction to process.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Inside the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code>, we call the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> to fetch their respective <small class="calibre48">ISBN</small>s. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> refer to the same book, we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> to add the components of <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> into the running total in <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> represents a new book, we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> to print the total for the previous book. Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> returns a reference to its stream parameter, we can use the result of <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> as the left-hand operand of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;&lt;</span></tt></code>. We do so to print a newline following the output generated by <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code>. We next assign <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>, thus setting up to process the records for the next book in the file.</p><div class="calibre22">&#160;</div>
<p class="calibre25">After we have exhausted the input, we have to remember to print the data for the last transaction, which we do in the call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> following the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> loop.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 7.1.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.1:</strong> Write a version of the transaction-processing program from &#167; <a href="016-1.6._the_bookstore_program.html#filepos244566">1.6</a> (p. <a href="016-1.6._the_bookstore_program.html#filepos244566">24</a>) using the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class you defined for the exercises in &#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">2.6.1</a> (p. <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">72</a>).</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos1761316" class="calibre37"><span class="calibre5">7.1.2. Defining the Revised <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Class</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Our revised class will have the same data members as the version we defined in &#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">2.6.1</a> (p. <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">72</a>): <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code>, a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> representing the <small class="calibre48">ISBN</small>; <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code>, an <code class="calibre23"><tt class="calibre23"><span class="calibre24">unsigned</span></tt></code> that says how many copies of the book were sold; and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code>, a <code class="calibre23"><tt class="calibre23"><span class="calibre24">double</span></tt></code> representing the total revenue for those sales.</p><div class="calibre15">&#160;</div>
<p class="calibre25">As we&#8217;ve seen, our class will also have two member functions, <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code>. In addition, we&#8217;ll give <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> another member function to return the average price at which the books were sold. This function, which we&#8217;ll name <code class="calibre23"><tt class="calibre23"><span class="calibre24">avg_price</span></tt></code>, isn&#8217;t intended for general use. It will be part of the implementation, not part of the interface.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We define (&#167; <a href="063-6.1._function_basics.html#filepos1415571">6.1</a>, p. <a href="063-6.1._function_basics.html#filepos1415571">202</a>) and declare (&#167; <a href="063-6.1._function_basics.html#filepos1441405">6.1.2</a>, p. <a href="063-6.1._function_basics.html#filepos1441405">206</a>) member functions similarly to ordinary functions. Member functions <em class="calibre16">must</em> be declared inside the class. Member functions <em class="calibre16">may</em> be defined inside the class itself or outside the class body. Nonmember functions that are part of the interface, such as <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code>, are declared and defined outside the class.</p><div class="calibre22">&#160;</div>
<p class="calibre25">With this knowledge, we&#8217;re ready to write our revised version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">struct Sales_data {<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">new members: operations on</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sales_data</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">objects</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::string isbn() const { return bookNo; }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data&amp; combine(const Sales_data&amp;);<br class="calibre6"/>&#160;&#160;&#160;&#160;double avg_price() const;<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">data members are unchanged from</span></span></span>
<span><span class="calibre45"><span class="calibre16">&#167; 2.6.1 (p. 72)</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::string bookNo;<br class="calibre6"/>&#160;&#160;&#160;&#160;unsigned units_sold = 0;<br class="calibre6"/>&#160;&#160;&#160;&#160;double revenue = 0.0;<br class="calibre6"/>};<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">nonmember</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sales_data</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">interface functions</span></span></span><br class="calibre6"/>Sales_data add(const Sales_data&amp;, const Sales_data&amp;);<br class="calibre6"/>std::ostream &amp;print(std::ostream&amp;, const Sales_data&amp;);<br class="calibre6"/>std::istream &amp;read(std::istream&amp;, Sales_data&amp;);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Functions defined in the class are implicitly <code class="calibre23"><tt class="calibre23"><span class="calibre24">inline</span></tt></code> (&#167; <a href="067-6.5._features_for_specialized_uses.html#filepos1645920">6.5.2</a>, p. <a href="067-6.5._features_for_specialized_uses.html#filepos1645920">238</a>).</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos1766208"/>Defining Member Functions</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Although every member must be declared inside its class, we can define a member function&#8217;s body either inside or outside of the class body. In <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data, isbn</span></tt></code> is defined inside the class; <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">avg_price</span></tt></code> will be defined elsewhere.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We&#8217;ll start by explaining the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function, which returns a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> and has an empty parameter list:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">std::string isbn() const { return bookNo; }</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">As with any function, the body of a member function is a block. In this case, the block contains a single <code class="calibre23"><tt class="calibre23"><span class="calibre24">return</span></tt></code> statement that returns the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> data member of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object. The interesting thing about this function is how it gets the object from which to fetch the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> member.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Introducing <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">this</span></span></tt></span></span></tt></code></span></h5><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre14">Let&#8217;s look again at a call to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> member function:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">total.isbn()</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Here we use the dot operator (&#167; <a href="044-4.6._the_member_access_operators.html#filepos1101794">4.6</a>, p. <a href="044-4.6._the_member_access_operators.html#filepos1101794">150</a>) to fetch the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> member of the object named <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>, which we then call.</p><div class="calibre15">&#160;</div>
<p class="calibre25">With one exception that we&#8217;ll cover in &#167; <a href="078-7.6._static_class_members.html#filepos2028441">7.6</a> (p. <a href="078-7.6._static_class_members.html#filepos2028441">300</a>), when we call a member function we do so on behalf of an object. When <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> refers to members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> (e.g., <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code>), it is referring implicitly to the members of the object on which the function was called. In this call, when <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> returns <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code>, it is implicitly returning <code class="calibre23"><tt class="calibre23"><span class="calibre24">total.bookNo</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Member functions access the object on which they were called through an extra, implicit parameter named <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos1770061" href="080-defined_terms.html#filepos2066098">this</a></span></span></tt></span></span></tt></code>. When we call a member function, <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is initialized with the address of the object on which the function was invoked. For example, when we call</p><div class="calibre22">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">total.isbn()</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">the compiler passes the address of <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> to the implicit <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> parameter in <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code>. It is as if the compiler rewrites this call as</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"><a id="filepos1770956"/></span></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">pseudo-code illustration of how a call to a member function is translated</span></span></span><br class="calibre6"/>Sales_data::isbn(&amp;total)</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">which calls the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> member of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> passing the address of <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Inside a member function, we can refer directly to the members of the object on which the function was called. We do not have to use a member access operator to use the members of the object to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> points. Any direct use of a member of the class is assumed to be an implicit reference through <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code>. That is, when <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> uses <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code>, it is implicitly using the member to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> points. It is as if we had written <code class="calibre23"><tt class="calibre23"><span class="calibre24">this-&gt;bookNo</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> parameter is defined for us implicitly. Indeed, it is illegal for us to define a parameter or variable named <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code>. Inside the body of a member function, we can use <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code>. It would be legal, although unnecessary, to define <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> as</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">std::string isbn() const { return this-&gt;bookNo; }</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is intended to always refer to &#8220;this&#8221; object, <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> pointer (&#167; <a href="024-2.4._const_qualifier.html#filepos491891">2.4.2</a>, p. <a href="024-2.4._const_qualifier.html#filepos491891">62</a>). We cannot change the address that <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> holds.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Introducing <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">const</span></span></tt></span></span></tt></code> Member Functions</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The other important part about the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function is the keyword <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> that follows the parameter list. The purpose of that <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> is to modify the type of the implicit <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> pointer.</p><div class="calibre15">&#160;</div>
<p class="calibre25">By default, the type of <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> pointer to the non<code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> version of the class type. For example, by default, the type of <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> member function is <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data *const</span></tt></code>. Although <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is implicit, it follows the normal initialization rules, which means that (by default) we cannot bind <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> object (&#167; <a href="024-2.4._const_qualifier.html#filepos491891">2.4.2</a>, p. <a href="024-2.4._const_qualifier.html#filepos491891">62</a>). This fact, in turn, means that we cannot call an ordinary member function on a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> object.</p><div class="calibre22">&#160;</div>
<p class="calibre25">If <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> were an ordinary function and if <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> were an ordinary pointer parameter, we would declare <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> as <code class="calibre23"><tt class="calibre23"><span class="calibre24">const Sales_data *const</span></tt></code>. After all, the body of <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> doesn&#8217;t change the object to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> points, so our function would be more flexible if <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> were a pointer to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> (&#167; <a href="064-6.2._argument_passing.html#filepos1479382">6.2.3</a>, p. <a href="064-6.2._argument_passing.html#filepos1479382">213</a>).</p><div class="calibre22">&#160;</div>
<p class="calibre25">However, <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is implicit and does not appear in the parameter list. There is no place to indicate that <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> should be a pointer to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>. The language resolves this problem by letting us put <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> after the parameter list of a member function. A <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> following the parameter list indicates that <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is a pointer to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>. Member functions that use <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> in this way are <a id="filepos1777780" href="080-defined_terms.html#filepos2057171"><code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">const</span></span></tt></span></span></tt></code>
<strong class="calibre5">member functions</strong></a>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We can think of the body of <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> as if it were written as</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">pseudo-code illustration of how the implicit</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">this</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">pointer is used</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">this code is illegal: we may not explicitly define the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">this</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">pointer ourselves</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">note that</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">this</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is a pointer to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">const</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">because</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">isbn</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">const</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">member</span></span></span><br class="calibre6"/>std::string Sales_data::isbn(const Sales_data *const this)<br class="calibre6"/>{ return this-&gt;isbn; }</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The fact that <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> is a pointer to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> means that <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> member functions cannot change the object on which they are called. Thus, <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> may read but not write to the data members of the objects on which it is called.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><a id="filepos1780381"/><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Objects that are <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>, and references or pointers to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> objects, may call only <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> member functions.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Class Scope and Member Functions</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Recall that a class is itself a scope (&#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">2.6.1</a>, p. <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">72</a>). The definitions of the member functions of a class are nested inside the scope of the class itself. Hence, <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code>&#8217;s use of the name <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> is resolved as the data member defined inside <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">It is worth noting that <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> can use <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> even though <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> is defined <em class="calibre16">after</em>
<code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code>. As we&#8217;ll see in &#167; <a href="076-7.4._class_scope.html#filepos1931587">7.4.1</a> (p. <a href="076-7.4._class_scope.html#filepos1931587">283</a>), the compiler processes classes in two steps&#8212;the member declarations are compiled first, after which the member function bodies, if any, are processed. Thus, member function bodies may use other members of their class regardless of where in the class those members appear.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Defining a Member Function outside the Class</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">As with any other function, when we define a member function outside the class body, the member&#8217;s definition must match its declaration. That is, the return type, parameter list, and name must match the declaration in the class body. If the member was declared as a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> member function, then the definition must also specify <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> after the parameter list. The name of a member defined outside the class must include the name of the class of which it is a member:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">double Sales_data::avg_price() const {<br class="calibre6"/>&#160;&#160;&#160;&#160;if (units_sold)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return revenue/units_sold;<br class="calibre6"/>&#160;&#160;&#160;&#160;else<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The function name, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data::avg_price</span></tt></code>, uses the scope operator (&#167; <a href="012-1.2._a_first_look_at_inputoutput.html#filepos136281">1.2</a>, p. <a href="012-1.2._a_first_look_at_inputoutput.html#filepos136281">8</a>) to say that we are defining the function named <code class="calibre23"><tt class="calibre23"><span class="calibre24">avg_price</span></tt></code> that is declared in the scope of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class. Once the compiler sees the function name, the rest of the code is interpreted as being inside the scope of the class. Thus, when <code class="calibre23"><tt class="calibre23"><span class="calibre24">avg_price</span></tt></code> refers to <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code>, it is implicitly referring to the members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Defining a Function to Return &#8220;This&#8221; Object</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> function is intended to act like the compound assignment operator, <code class="calibre23"><tt class="calibre23"><span class="calibre24">+=</span></tt></code>. The object on which this function is called represents the left-hand operand of the assignment. The right-hand operand is passed as an explicit argument:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data&amp; Sales_data::combine(const Sales_data &amp;rhs)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;units_sold += rhs.units_sold; // <span><span class="calibre45"><span class="calibre16">add the members of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">rhs</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">into</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;revenue += rhs.revenue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">the members of ''this'' object</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return *this; // <span><span class="calibre45"><span class="calibre16">return the object on which the function was called</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14"><a id="filepos1786297"/>When our transaction-processing program calls</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">total.combine(trans); // <span><span class="calibre45"><span class="calibre16">update the running</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">total</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">the address of <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> is bound to the implicit <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> parameter and <code class="calibre23"><tt class="calibre23"><span class="calibre24">rhs</span></tt></code> is bound to <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>. Thus, when <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> executes</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">units_sold += rhs.units_sold; // <span><span class="calibre45"><span class="calibre16">add the members of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">rhs</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">into</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">the effect is to add <code class="calibre23"><tt class="calibre23"><span class="calibre24">total.units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans.units_sold</span></tt></code>, storing the result back into <code class="calibre23"><tt class="calibre23"><span class="calibre24">total.units_sold</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The interesting part about this function is its return type and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">return</span></tt></code> statement. Ordinarily, when we define a function that operates like a built-in operator, our function should mimic the behavior of that operator. The built-in assignment operators return their left-hand operand as an lvalue (&#167; <a href="042-4.4._assignment_operators.html#filepos1066463">4.4</a>, p. <a href="042-4.4._assignment_operators.html#filepos1066463">144</a>). To return an lvalue, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> function must return a reference (&#167; <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">6.3.2</a>, p. <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">226</a>). Because the left-hand operand is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object, the return type is <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data&amp;</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">As we&#8217;ve seen, we do not need to use the implicit <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> pointer to access the members of the object on which a member function is executing. However, we do need to use <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> to access the object as a whole:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">return *this; // <span><span class="calibre45"><span class="calibre16">return the object on which the function was called</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Here the <code class="calibre23"><tt class="calibre23"><span class="calibre24">return</span></tt></code> statement dereferences <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> to obtain the object on which the function is executing. That is, for the call above, we return a reference to <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>.</p><div class="calibre15">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 7.1.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.2:</strong> Add the <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> members to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class you wrote for the exercises in &#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos586875">2.6.2</a> (p. <a href="026-2.6._defining_our_own_data_structures.html#filepos586875">76</a>).</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.3:</strong> Revise your transaction-processing program from &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1746914">7.1.1</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1746914">256</a>) to use these members.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.4:</strong> Write a class named <code class="calibre23"><tt class="calibre23"><span class="calibre24">Person</span></tt></code> that represents the name and address of a person. Use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> to hold each of these elements. Subsequent exercises will incrementally add features to this class.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.5:</strong> Provide operations in your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Person</span></tt></code> class to return the name and address. Should these functions be <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>? Explain your choice.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos1792181" class="calibre37"><span class="calibre5">7.1.3. Defining Nonmember Class-Related Functions</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Class authors often define auxiliary functions, such as our <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> functions. Although such functions define operations that are conceptually part of the interface of the class, they are not part of the class itself.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We define nonmember functions as we would any other function. As with any other function, we normally separate the declaration of the function from its <a id="filepos1793028"/>definition (&#167; <a href="063-6.1._function_basics.html#filepos1441405">6.1.2</a>, p. <a href="063-6.1._function_basics.html#filepos1441405">206</a>). Functions that are conceptually part of a class, but not defined inside the class, are typically declared (but not defined) in the same header as the class itself. That way users need to include only one file to use any part of the interface.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Ordinarily, nonmember functions that are part of the interface of a class should be declared in the same header as the class itself.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Defining the <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">read</span></span></tt></span></span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">print</span></span></tt></span></span></tt></code> Functions</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> functions do the same job as the code in &#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos586875">2.6.2</a> (p. <a href="026-2.6._defining_our_own_data_structures.html#filepos586875">75</a>) and not surprisingly, the bodies of our functions look a lot like the code presented there:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">input transactions contain</span></span></span>
<span><span class="calibre50">ISBN</span></span><span><span class="calibre45"><span class="calibre16">, number of copies sold, and sales price</span></span></span><br class="calibre6"/>istream &amp;read(istream &amp;is, Sales_data &amp;item)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;double price = 0;<br class="calibre6"/>&#160;&#160;&#160;&#160;is &gt;&gt; item.bookNo &gt;&gt; item.units_sold &gt;&gt; price;<br class="calibre6"/>&#160;&#160;&#160;&#160;item.revenue = price * item.units_sold;<br class="calibre6"/>&#160;&#160;&#160;&#160;return is;<br class="calibre6"/>}<br class="calibre6"/>ostream &amp;print(ostream &amp;os, const Sales_data &amp;item)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;os &lt;&lt; item.isbn() &lt;&lt; " " &lt;&lt; item.units_sold &lt;&lt; " "<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; item.revenue &lt;&lt; " " &lt;&lt; item.avg_price();<br class="calibre6"/>&#160;&#160;&#160;&#160;return os;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> function reads data from the given stream into the given object. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> function prints the contents of the given object on the given stream.</p><div class="calibre15">&#160;</div>
<p class="calibre25">However, there are two points worth noting about these functions. First, both <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">write</span></tt></code> take a reference to their respective IO class types. The IO classes are types that cannot be copied, so we may only pass them by reference (&#167; <a href="064-6.2._argument_passing.html#filepos1462468">6.2.2</a>, p. <a href="064-6.2._argument_passing.html#filepos1462468">210</a>). Moreover, reading or writing to a stream changes that stream, so both functions take ordinary references, not references to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The second thing to note is that <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> does not print a newline. Ordinarily, functions that do output should do minimal formatting. That way user code can decide whether the newline is needed.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Defining the <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">add</span></span></tt></span></span></tt></code> Function</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code> function takes two <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> objects and returns a new <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> representing their sum:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data add(const Sales_data &amp;lhs, const Sales_data &amp;rhs)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data sum = lhs;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">copy data members from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">lhs</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">into</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">sum</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;sum.combine(rhs);&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">add data members from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">rhs</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">into</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">sum</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return sum;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14"><a id="filepos1798940"/>In the body of the function we define a new <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object named <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code> to hold the sum of our two transactions. We initialize <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code> as a copy of <code class="calibre23"><tt class="calibre23"><span class="calibre24">lhs</span></tt></code>. By default, copying a class object copies that object&#8217;s members. After the copy, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo, units_sold</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code> will have the same values as those in <code class="calibre23"><tt class="calibre23"><span class="calibre24">lhs</span></tt></code>. Next we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">combine</span></tt></code> to add the <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">rhs</span></tt></code> into <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code>. When we&#8217;re done, we return a copy of <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code>.</p><div class="calibre15">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 7.1.3</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.6:</strong> Define your own versions of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> functions.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.7:</strong> Rewrite the transaction-processing program you wrote for the exercises in &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">7.1.2</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">260</a>) to use these new functions.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.8:</strong> Why does <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> define its <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> parameter as a plain reference and <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> define its parameter as a reference to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.9:</strong> Add operations to read and print <code class="calibre23"><tt class="calibre23"><span class="calibre24">Person</span></tt></code> objects to the code you wrote for the exercises in &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">7.1.2</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">260</a>).</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.10:</strong> What does the condition in the following <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> statement do?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">if (read(read(cin, data1), data2))</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos1802479" class="calibre37"><span class="calibre5">7.1.4. Constructors</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Each class defines how objects of its type can be initialized. Classes control object initialization by defining one or more special member functions known as <strong class="calibre5"><a id="filepos1802827" href="080-defined_terms.html#filepos2057980">constructors</a></strong>. The job of a constructor is to initialize the data members of a class object. A constructor is run whenever an object of a class type is created.</p><div class="calibre15">&#160;</div>
<p class="calibre25">In this section, we&#8217;ll introduce the basics of how to define a constructor. Constructors are a surprisingly complex topic. Indeed, we&#8217;ll have more to say about constructors in &#167; <a href="077-7.5._constructors_revisited.html#filepos1952599">7.5</a> (p. <a href="077-7.5._constructors_revisited.html#filepos1952599">288</a>), &#167; <a href="148-15.7._constructors_and_copy_control.html#filepos3973987">15.7</a> (p. <a href="148-15.7._constructors_and_copy_control.html#filepos3973987">622</a>), and &#167; <a href="171-18.1._exception_handling.html#filepos4887288">18.1.3</a> (p. <a href="171-18.1._exception_handling.html#filepos4887288">777</a>), and in <a href="120-chapter_13._copy_control.html#filepos3197881">Chapter 13</a>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Constructors have the same name as the class. Unlike other functions, constructors have no return type. Like other functions, constructors have a (possibly empty) parameter list and a (possibly empty) function body. A class can have multiple constructors. Like any other overloaded function (&#167; <a href="066-6.4._overloaded_functions.html#filepos1597234">6.4</a>, p. <a href="066-6.4._overloaded_functions.html#filepos1597234">230</a>), the constructors must differ from each other in the number or types of their parameters.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Unlike other member functions, constructors may not be declared as <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> (&#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">7.1.2</a>, p. <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">258</a>). When we create a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> object of a class type, the object does not assume its &#8220;<code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>ness&#8221; until after the constructor completes the object&#8217;s initialization. Thus, constructors can write to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> objects during their construction.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">The Synthesized Default Constructor</span></h5><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre14">Our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class does not define any constructors, yet the programs we&#8217;ve written that use <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> objects compile and run correctly. As an example, the program on page <a href="073-7.1._defining_abstract_data_types.html#filepos1750685">255</a> defined two objects:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"><a id="filepos1805469"/></span></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data total;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">variable to hold the running sum</span></span></span><br class="calibre6"/>Sales_data trans;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">variable to hold data for the next transaction</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The question naturally arises: How are <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> initialized?</p><div class="calibre15">&#160;</div>
<p class="calibre25">We did not supply an initializer for these objects, so we know that they are default initialized (&#167; <a href="022-2.2._variables.html#filepos350704">2.2.1</a>, p. <a href="022-2.2._variables.html#filepos350704">43</a>). Classes control default initialization by defining a special constructor, known as the <strong class="calibre5"><a id="filepos1806598" href="080-defined_terms.html#filepos2059620">default constructor</a></strong>. The default constructor is one that takes no arguments.</p><div class="calibre22">&#160;</div>
<p class="calibre25">As we&#8217;ll, see the default constructor is special in various ways, one of which is that if our class does not <em class="calibre16">explicitly</em> define any constructors, the compiler will <em class="calibre16">implicitly</em> define the default constructor for us</p><div class="calibre22">&#160;</div>
<p class="calibre25">The compiler-generated constructor is known as the <strong class="calibre5"><a id="filepos1807151" href="080-defined_terms.html#filepos2065640">synthesized default constructor</a></strong>. For most classes, this synthesized constructor initializes each data member of the class as follows:</p><div class="calibre22">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; If there is an in-class initializer (&#167; <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">2.6.1</a>, p. <a href="026-2.6._defining_our_own_data_structures.html#filepos578460">73</a>), use it to initialize the member.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Otherwise, default-initialize (&#167; <a href="022-2.2._variables.html#filepos350704">2.2.1</a>, p. <a href="022-2.2._variables.html#filepos350704">43</a>) the member.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> provides initializers for <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code>, the synthesized default constructor uses those values to initialize those members. It default initializes <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> to the empty string.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Some Classes Cannot Rely on the Synthesized Default Constructor</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Only fairly simple classes&#8212;such as the current definition of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>&#8212;can rely on the synthesized default constructor. The most common reason that a class must define its own default constructor is that the compiler generates the default for us <em class="calibre16">only if we do not define any other constructors for the class.</em> If we define any constructors, the class will not have a default constructor unless we define that constructor ourselves. The basis for this rule is that if a class requires control to initialize an object in one case, then the class is likely to require control in all cases.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The compiler generates a default constructor automatically only if a class declares <em class="calibre16">no</em> constructors.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25">A second reason to define the default constructor is that for some classes, the synthesized default constructor does the wrong thing. Remember that objects of built-in or compound type (such as arrays and pointers) that are defined inside a block have undefined value when they are default initialized (&#167; <a href="022-2.2._variables.html#filepos350704">2.2.1</a>, p. <a href="022-2.2._variables.html#filepos350704">43</a>). The same rule applies to members of built-in type that are default initialized. Therefore, classes that have members of built-in or compound type should ordinarily either initialize those members inside the class or define their own version of the default constructor. Otherwise, users could create objects with members that have undefined value.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Classes that have members of built-in or compound type usually should rely on the synthesized default constructor <em class="calibre16">only</em> if all such members have in-class initializers.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25"><a id="filepos1810987"/>A third reason that some classes must define their own default constructor is that sometimes the compiler is unable to synthesize one. For example, if a class has a member that has a class type, and that class doesn&#8217;t have a default constructor, then the compiler can&#8217;t initialize that member. For such classes, we must define our own version of the default constructor. Otherwise, the class will not have a usable default constructor. We&#8217;ll see in &#167; <a href="121-13.1._copy_assign_and_destroy.html#filepos3263004">13.1.6</a> (p. <a href="121-13.1._copy_assign_and_destroy.html#filepos3263004">508</a>) additional circumstances that prevent the compiler from generating an appropriate default constructor.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Defining the <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Constructors</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">For our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class we&#8217;ll define four constructors with the following parameters:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; An <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream&amp;</span></tt></code> from which to read a transaction.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A <code class="calibre23"><tt class="calibre23"><span class="calibre24">const string&amp;</span></tt></code> representing an <small class="calibre48">ISBN</small>, an <code class="calibre23"><tt class="calibre23"><span class="calibre24">unsigned</span></tt></code> representing the count of how many books were sold, and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">double</span></tt></code> representing the price at which the books sold.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A <code class="calibre23"><tt class="calibre23"><span class="calibre24">const string&amp;</span></tt></code> representing an <small class="calibre48">ISBN</small>. This constructor will use default values for the other members.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; An empty parameter list (i.e., the default constructor) which as we&#8217;ve just seen we must define because we have defined other constructors.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">Adding these members to our class, we now have</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">struct Sales_data {<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">constructors added</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data() = default;<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(const std::string &amp;s): bookNo(s) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(const std::string &amp;s, unsigned n, double p):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bookNo(s), units_sold(n), revenue(p*n) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data(std::istream &amp;);<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">other members as before</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::string isbn() const { return bookNo; }<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data&amp; combine(const Sales_data&amp;);<br class="calibre6"/>&#160;&#160;&#160;&#160;double avg_price() const;<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string bookNo;<br class="calibre6"/>&#160;&#160;&#160;&#160;unsigned units_sold = 0;<br class="calibre6"/>&#160;&#160;&#160;&#160;double revenue = 0.0;<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">What <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">= default</span></span></tt></span></span></tt></code> Means</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">We&#8217;ll start by explaining the default constructor:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data() = default;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">First, note that this constructor defines the default constructor because it takes no arguments. We are defining this constructor <em class="calibre16">only</em> because we want to provide other constructors as well as the default constructor. We want this constructor to do exactly the same work as the synthesized version we had been using.</p><div class="calibre15">&#160;</div>
<p class="calibre25"><a id="filepos1815669"/>Under the new standard, if we want the default behavior, we can ask the compiler to generate the constructor for us by writing <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos1815891" href="080-defined_terms.html#filepos2066549">= default</a></span></span></tt></span></span></tt></code> after the parameter list. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">= default</span></tt></code> can appear with the declaration inside the class body or on the definition outside the class body. Like any other function, if the <code class="calibre23"><tt class="calibre23"><span class="calibre24">= default</span></tt></code> appears inside the class body, the default constructor will be inlined; if it appears on the definition outside the class, the member will not be inlined by default.</p><div class="calibre22">&#160;</div>
<div class="calibre28"><a id="filepos1816504"/><img alt="Image" src="images/00008.jpg" class="calibre9"/></div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The default constructor works for <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> only because we provide initializers for the data members with built-in type. If your compiler does not support in-class initializers, your default constructor should use the constructor initializer list (described immediately following) to initialize every member of the class.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Constructor Initializer List</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Next we&#8217;ll look at the other two constructors that were defined inside the class:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data(const std::string &amp;s): bookNo(s) { }<br class="calibre6"/>Sales_data(const std::string &amp;s, unsigned n, double p):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bookNo(s), units_sold(n), revenue(p*n) { }</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The new parts in these definitions are the colon and the code between it and the curly braces that define the (empty) function bodies. This new part is a <strong class="calibre5"><a id="filepos1818233" href="080-defined_terms.html#filepos2058283">constructor initializer list</a></strong>, which specifies initial values for one or more data members of the object being created. The constructor initializer is a list of member names, each of which is followed by that member&#8217;s initial value in parentheses (or inside curly braces). Multiple member initializations are separated by commas.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The constructor that has three parameters uses its first two parameters to initialize the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> members. The initializer for <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> is calculated by multiplying the number of books sold by the price per book.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The constructor that has a single <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> parameter uses that <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> to initialize <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> but does not explicitly initialize the <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> members. When a member is omitted from the constructor initializer list, it is implicitly initialized using the same process as is used by the synthesized default constructor. In this case, those members are initialized by the in-class initializers. Thus, the constructor that takes a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> is equivalent to</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">has the same behavior as the original constructor defined above</span></span></span><br class="calibre6"/>Sales_data(const std::string &amp;s):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bookNo(s), units_sold(0), revenue(0){ }</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">It is usually best for a constructor to use an in-class initializer if one exists and gives the member the correct value. On the other hand, if your compiler does not yet support in-class initializers, then every constructor should explicitly initialize every member of built-in type.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Constructors should not override in-class initializers except to use a different initial value. If you can&#8217;t use in-class initializers, each constructor should explicitly initialize every member of built-in type.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25"><a id="filepos1821542"/>It is worth noting that both constructors have empty function bodies. The only work these constructors need to do is give the data members their values. If there is no further work, then the function body is empty.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Defining a Constructor outside the Class Body</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Unlike our other constructors, the constructor that takes an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> does have work to do. Inside its function body, this constructor calls <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> to give the data members new values:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data::Sales_data(std::istream &amp;is)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;read(is, *this); // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">read</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">will read a transaction from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">is</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">into this object</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Constructors have no return type, so this definition starts with the name of the function we are defining. As with any other member function, when we define a constructor outside of the class body, we must specify the class of which the constructor is a member. Thus, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data::Sales_data</span></tt></code> says that we&#8217;re defining the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> member named <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>. This member is a constructor because it has the same name as its class.</p><div class="calibre15">&#160;</div>
<p class="calibre25">In this constructor there is no constructor initializer list, although technically speaking, it would be more correct to say that the constructor initializer list is empty. Even though the constructor initializer list is empty, the members of this object are still initialized before the constructor body is executed.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Members that do not appear in the constructor initializer list are initialized by the corresponding in-class initializer (if there is one) or are default initialized. For <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> that means that when the function body starts executing, <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> will be the empty <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> will both be <code class="calibre23"><tt class="calibre23"><span class="calibre24">0</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">To understand the call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code>, remember that <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code>&#8217;s second parameter is a reference to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object. In &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">7.1.2</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">259</a>), we noted that we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">this</span></tt></code> to access the object as a whole, rather than a member of the object. In this case, we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">*this</span></tt></code> to pass &#8220;this&#8221; object as an argument to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> function.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 7.1.4</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.11:</strong> Add constructors to your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class and write a program to use each of the constructors.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.12:</strong> Move the definition of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> constructor that takes an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> into the body of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.13:</strong> Rewrite the program from page <a href="073-7.1._defining_abstract_data_types.html#filepos1750685">255</a> to use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> constructor.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.14:</strong> Write a version of the default constructor that explicitly initializes the members to the values we have provided as in-class initializers.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 7.15:</strong> Add appropriate constructors to your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Person</span></tt></code> class.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos1827343" class="calibre37"><span class="calibre5"><a id="filepos1827376"/>7.1.5. Copy, Assignment, and Destruction</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">In addition to defining how objects of the class type are initialized, classes also control what happens when we copy, assign, or destroy objects of the class type. Objects are copied in several contexts, such as when we initialize a variable or when we pass or return an object by value (&#167; <a href="064-6.2._argument_passing.html#filepos1453096">6.2.1</a>, p. <a href="064-6.2._argument_passing.html#filepos1453096">209</a>, and &#167; <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">6.3.2</a>, p. <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">224</a>). Objects are assigned when we use the assignment operator (&#167; <a href="042-4.4._assignment_operators.html#filepos1066463">4.4</a>, p. <a href="042-4.4._assignment_operators.html#filepos1066463">144</a>). Objects are destroyed when they cease to exist, such as when a local object is destroyed on exit from the block in which it was created (&#167; <a href="063-6.1._function_basics.html#filepos1431793">6.1.1</a>, p. <a href="063-6.1._function_basics.html#filepos1431793">204</a>). Objects stored in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> (or an array) are destroyed when that <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> (or array) is destroyed.</p><div class="calibre15">&#160;</div>
<p class="calibre25">If we do not define these operations, the compiler will synthesize them for us. Ordinarily, the versions that the compiler generates for us execute by copying, assigning, or destroying each member of the object. For example, in our bookstore program in &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1746914">7.1.1</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1746914">255</a>), when the compiler executes this assignment</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">total = trans;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">process the next book</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">it executes as if we had written</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">default assignment for</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sales_data</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is equivalent to:</span></span></span><br class="calibre6"/>total.bookNo = trans.bookNo;<br class="calibre6"/>total.units_sold = trans.units_sold;<br class="calibre6"/>total.revenue = trans.revenue;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">We&#8217;ll show how we can define our own versions of these operations in <a href="120-chapter_13._copy_control.html#filepos3197881">Chapter 13</a>.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Some Classes Cannot Rely on the Synthesized Versions</span></h5><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre14">Although the compiler will synthesize the copy, assignment, and destruction operations for us, it is important to understand that for some classes the default versions do not behave appropriately. In particular, the synthesized versions are unlikely to work correctly for classes that allocate resources that reside outside the class objects themselves. As one example, in <a href="113-chapter_12._dynamic_memory.html#filepos2900383">Chapter 12</a> we&#8217;ll see how C++ programs allocate and manage dynamic memory. As we&#8217;ll see in &#167; <a href="121-13.1._copy_assign_and_destroy.html#filepos3244603">13.1.4</a> (p. <a href="121-13.1._copy_assign_and_destroy.html#filepos3244603">504</a>), classes that manage dynamic memory, generally cannot rely on the synthesized versions of these operations.</p><div class="calibre15">&#160;</div>
<p class="calibre25">However, it is worth noting that many classes that need dynamic memory can (and generally should) use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> or a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> to manage the necessary storage. Classes that use <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>s and <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s avoid the complexities involved in allocating and deallocating memory.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Moreover, the synthesized versions for copy, assignment, and destruction work correctly for classes that have <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> members. When we copy or assign an object that has a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> member, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> class takes care of copying or assigning the elements in that member. When the object is destroyed, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> member is destroyed, which in turn destroys the elements in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>. Similarly for <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Until you know how to define the operations covered in <a href="120-chapter_13._copy_control.html#filepos3197881">Chapter 13</a>, the resources your classes allocate should be stored directly as data members of the class.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="072-chapter_7._classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="074-7.2._access_control_and_encapsulation.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
