<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>15.2. Defining Base and Derived Classes</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="142-15.1._oop_an_overview.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="144-15.3._virtual_functions.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos3795765" class="calibre29"><span class="bold">15.2. Defining Base and Derived Classes</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">In many, but not all, ways base and derived classes are defined like other classes we have already seen. In this section, we&#8217;ll cover the basic features used to define classes related by inheritance.</p><div class="calibre15">&#160;</div>
<h4 id="filepos3796139" class="calibre37"><span class="calibre5">15.2.1. Defining a Base Class</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">We&#8217;ll start by completing the definition of our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> class:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Quote {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;Quote() = default;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">= default</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">see &#167; 7.1.4 (p. 264)</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;Quote(const std::string &amp;book, double sales_price):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bookNo(book), price(sales_price) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string isbn() const { return bookNo; }<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">returns the total sales price for the specified number of items</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">derived classes will override and apply different discount algorithms</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;virtual double net_price(std::size_t n) const<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{ return n * price; }<br class="calibre6"/>&#160;&#160;&#160;&#160;virtual ~Quote() = default; // <span><span class="calibre45"><span class="calibre16">dynamic binding for the destructor</span></span></span><br class="calibre6"/>private:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string bookNo; // <span><span class="calibre50">ISBN</span></span>
<span><span class="calibre45"><span class="calibre16">number of this item</span></span></span><br class="calibre6"/>protected:<br class="calibre6"/>&#160;&#160;&#160;&#160;double price = 0.0; // <span><span class="calibre45"><span class="calibre16">normal, undiscounted price</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The new parts in this class are the use of <code class="calibre23"><tt class="calibre23"><span class="calibre24">virtual</span></tt></code> on the <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> function and the destructor, and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> access specifier. We&#8217;ll explain virtual destructors in &#167;<a href="148-15.7._constructors_and_copy_control.html#filepos3974566">15.7.1</a> (p. <a href="148-15.7._constructors_and_copy_control.html#filepos3974566">622</a>), but for now it is worth noting that classes used as the root of an inheritance hierarchy almost always define a virtual destructor.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Base classes ordinarily should define a virtual destructor. Virtual destructors are needed even if they do no work.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Member Functions and Inheritance</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Derived classes inherit the members of their base class. However, a derived class needs to be able to provide its own definition for operations, such as <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>, <a id="filepos3799829"/>that are type dependent. In such cases, the derived class needs to <strong class="calibre5">override</strong> the definition it inherits from the base class, by providing its own definition.</p><div class="calibre15">&#160;</div>
<p class="calibre25">In C++, a base class must distinguish the functions it expects its derived classes to override from those that it expects its derived classes to inherit without change. The base class defines as <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">virtual</span></span></tt></span></span></tt></code> those functions it expects its derived classes to override. When we call a virtual function <em class="calibre16">through a pointer or reference</em>, the call will be dynamically bound. Depending on the type of the object to which the reference or pointer is bound, the version in the base class or in one of its derived classes will be executed.</p><div class="calibre22">&#160;</div>
<p class="calibre25">A base class specifies that a member function should be dynamically bound by preceding its declaration with the keyword <code class="calibre23"><tt class="calibre23"><span class="calibre24">virtual</span></tt></code>. Any non<code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> member function (&#167;<a href="078-7.6._static_class_members.html#filepos2028441">7.6</a>, p. <a href="078-7.6._static_class_members.html#filepos2028441">300</a>), other than a constructor, may be virtual. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">virtual</span></tt></code> keyword appears only on the declaration inside the class and may not be used on a function definition that appears outside the class body. A function that is declared as <code class="calibre23"><tt class="calibre23"><span class="calibre24">virtual</span></tt></code> in the base class is implicitly <code class="calibre23"><tt class="calibre23"><span class="calibre24">virtual</span></tt></code> in the derived classes as well. We&#8217;ll have more to say about virtual functions in &#167;<a href="144-15.3._virtual_functions.html#filepos3853256">15.3</a> (p. <a href="144-15.3._virtual_functions.html#filepos3853256">603</a>).</p><div class="calibre22">&#160;</div>
<p class="calibre25">Member functions that are not declared as <code class="calibre23"><tt class="calibre23"><span class="calibre24">virtual</span></tt></code> are resolved at compile time, not run time. For the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> member, this is exactly the behavior we want. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function does not depend on the details of a derived type. It behaves identically when run on a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object. There will be only one version of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function in our inheritance hierarchy. Thus, there is no question as to which function to run when we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn()</span></tt></code>.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Access Control and Inheritance</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">A derived class inherits the members defined in its base class. However, the member functions in a derived class may not necessarily access the members that are inherited from the base class. Like any other code that uses the base class, a derived class may access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> members of its base class but may not access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> members. However, sometimes a base class has members that it wants to let its derived classes use while still prohibiting access to those same members by other users. We specify such members after a <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">protected</span></span></tt></span></span></tt></code> access specifier.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> class expects its derived classes to define their own <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> function. To do so, those classes need access to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> member. As a result, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> defines that member as <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code>. Derived classes are expected to access <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> in the same way as ordinary users&#8212;by calling the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function. Hence, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> member is <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> and is inaccessible to classes that inherit from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code>. We&#8217;ll have more to say about <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members in &#167;<a href="146-15.5._access_control_and_inheritance.html#filepos3901534">15.5</a> (p. <a href="146-15.5._access_control_and_inheritance.html#filepos3901534">611</a>).</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 15.2.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.1:</strong> What is a virtual member?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.2:</strong> How does the <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> access specifier differ from <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.3:</strong> Define your own versions of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> class and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">print_total</span></tt></code> function.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos3806030" class="calibre37"><span class="calibre5"><a id="filepos3806063"/>15.2.2. Defining a Derived Class</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">A derived class must specify from which class(es) it inherits. It does so in its <strong class="calibre5">class derivation list</strong>, which is a colon followed by a comma-separated list of names of previously defined classes. Each base class name may be preceded by an optional access specifier, which is one of <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code>, or <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A derived class must declare each inherited member function it intends to override. Therefore, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> class must include a <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> member:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Bulk_quote : public Quote { // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Bulk_quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">inherits from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Quote</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;Bulk_quote() = default;<br class="calibre6"/>&#160;&#160;&#160;&#160;Bulk_quote(const std::string&amp;, double, std::size_t, double);<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">overrides the base version in order to implement the bulk purchase discount policy</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;double net_price(std::size_t) const override;<br class="calibre6"/>private:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::size_t min_qty = 0; // <span><span class="calibre45"><span class="calibre16">minimum purchase for the discount to apply</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;double discount = 0.0;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">fractional discount to apply</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> class inherits the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> data members of its <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> base class. It defines its own version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> and has two additional data members, <code class="calibre23"><tt class="calibre23"><span class="calibre24">min_qty</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">discount</span></tt></code>. These members specify the minimum quantity and the discount to apply once that number of copies are purchased.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We&#8217;ll have more to say about the access specifier used in a derivation list in &#167;<a href="146-15.5._access_control_and_inheritance.html#filepos3901534">15.5</a> (p. <a href="146-15.5._access_control_and_inheritance.html#filepos3901534">612</a>). For now, what&#8217;s useful to know is that the access specifier determines whether users of a derived class are allowed to know that the derived class inherits from its base class.</p><div class="calibre22">&#160;</div>
<p class="calibre25">When the derivation is <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> members of the base class become part of the interface of the derived class as well. In addition, we can bind an object of a publicly derived type to a pointer or reference to the base type. Because we used <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> in the derivation list, the interface to <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> implicitly contains the <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code> function, and we may use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object where a pointer or reference to <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> is expected.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Most classes inherit directly from only one base class. This form of inheritance, known as &#8220;single inheritance,&#8221; forms the topic of this chapter. &#167;<a href="173-18.3._multiple_and_virtual_inheritance.html#filepos5026780">18.3</a> (p. <a href="173-18.3._multiple_and_virtual_inheritance.html#filepos5026780">802</a>) will cover classes that have derivation lists with more than one base class.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Virtual Functions in the Derived Class</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Derived classes frequently, but not always, override the virtual functions that they inherit. If a derived class does not override a virtual from its base, then, like any other member, the derived class inherits the version defined in its base class.</p><div class="calibre15">&#160;</div>
<div class="calibre28"><a id="filepos3811456"/><img alt="Image" src="images/00008.jpg" class="calibre9"/></div>
<p class="calibre25">A derived class may include the <code class="calibre23"><tt class="calibre23"><span class="calibre24">virtual</span></tt></code> keyword on the functions it overrides, but it is not required to do so. For reasons we&#8217;ll explain in &#167;<a href="144-15.3._virtual_functions.html#filepos3853256">15.3</a> (p. <a href="144-15.3._virtual_functions.html#filepos3853256">606</a>), the new standard lets a derived class explicitly note that it intends a member function to override a virtual that it inherits. It does so by specifying <code class="calibre23"><tt class="calibre23"><span class="calibre24">override</span></tt></code> after the parameter list, or after the <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> or reference qualifier(s) if the member is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> (&#167;<a href="073-7.1._defining_abstract_data_types.html#filepos1761316">7.1.2</a>, p. <a href="073-7.1._defining_abstract_data_types.html#filepos1761316">258</a>) or reference (&#167;<a href="126-13.6._moving_objects.html#filepos3505762">13.6.3</a>, p. <a href="126-13.6._moving_objects.html#filepos3505762">546</a>) function.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Derived-Class Objects and the Derived-to-Base Conversion</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14"><a id="filepos3812642"/>A derived object contains multiple parts: a subobject containing the (non<code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code>) members defined in the derived class itself, plus subobjects corresponding to each base class from which the derived class inherits. Thus, a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object will contain four data elements: the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> data members that it inherits from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code>, and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">min_qty</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">discount</span></tt></code> members, which are defined by <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Although the standard does not specify how derived objects are laid out in memory, we can think of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object as consisting of two parts as represented in <a href="143-15.2._defining_base_and_derived_classes.html#filepos3813939">Figure 15.1</a>.</p><div class="calibre22">&#160;</div>
<div class="calibre52"><a id="filepos3813939"/><img alt="Image" src="images/00102.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<p class="calibre51"><span class="calibre5">Figure 15.1. Conceptual Structure of a <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Bulk_quote</span></span></tt></span></span></tt></code> Object</span></p><div class="calibre12">&#160;</div>
<p class="calibre60"><strong class="calibre5">The base and derived parts of an object are not guaranteed to be stored contiguously. <a href="143-15.2._defining_base_and_derived_classes.html#filepos3813939">Figure 15.1</a> is a conceptual, not physical, representation of how classes work.</strong></p><div class="calibre15">&#160;</div>
<p class="calibre25">Because a derived object contains subparts corresponding to its base class(es), we can use an object of a derived type <em class="calibre16">as if</em> it were an object of its base type(s). In particular, we can bind a base-class reference or pointer to the base-class part of a derived object.</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Quote item;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">object of base type</span></span></span><br class="calibre6"/>Bulk_quote bulk;&#160;&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">object of derived type</span></span></span><br class="calibre6"/>Quote *p = &amp;item;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">p</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">points to a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">object</span></span></span><br class="calibre6"/>p = &amp;bulk;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">p</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">points to the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">part of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">bulk</span></span></tt></span><br class="calibre6"/>Quote &amp;r = bulk;&#160;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">r</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">bound to the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">part of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">bulk</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This conversion is often referred to as the <strong class="calibre5"><a id="filepos3816769" href="152-defined_terms.html#filepos4142654">derived-to-base</a></strong> conversion. As with any other conversion, the compiler will apply the derived-to-base conversion implicitly (&#167;<a href="049-4.11._type_conversions.html#filepos1157818">4.11</a>, p. <a href="049-4.11._type_conversions.html#filepos1157818">159</a>).</p><div class="calibre15">&#160;</div>
<p class="calibre25">The fact that the derived-to-base conversion is implicit means that we can use an object of derived type or a reference to a derived type when a reference to the base type is required. Similarly, we can use a pointer to a derived type where a pointer to the base type is required.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The fact that a derived object contains subobjects for its base classes is key to how inheritance works.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos3817863"/>Derived-Class Constructors</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Although a derived object contains members that it inherits from its base, it cannot directly initialize those members. Like any other code that creates an object of the base-class type, a derived class must use a base-class constructor to initialize its base-class part.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Each class controls how its members are initialized.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25">The base-class part of an object is initialized, along with the data members of the derived class, during the initialization phase of the constructor (&#167;<a href="077-7.5._constructors_revisited.html#filepos1953073">7.5.1</a>, p. <a href="077-7.5._constructors_revisited.html#filepos1953073">288</a>). Analogously to how we initialize a member, a derived-class constructor uses its constructor initializer list to pass arguments to a base-class constructor. For example, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> constructor with four parameters:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Bulk_quote(const std::string&amp; book, double p,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::size_t qty, double disc) :<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Quote(book, p), min_qty(qty), discount(disc) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">as before</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">passes its first two parameters (representing the <small class="calibre48">ISBN</small> and price) to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> constructor. That <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> constructor initializes the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code>&#8217;s base-class part (i.e., the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> members). When the (empty) <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> constructor body completes, the base-class part of the object being constructed will have been initialized. Next the direct members, <code class="calibre23"><tt class="calibre23"><span class="calibre24">min_qty</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">discount</span></tt></code>, are initialized. Finally, the (empty) function body of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> constructor is run.</p><div class="calibre15">&#160;</div>
<p class="calibre25">As with a data member, unless we say otherwise, the base part of a derived object is default initialized. To use a different base-class constructor, we provide a constructor initializer using the name of the base class, followed (as usual) by a parenthesized list of arguments. Those arguments are used to select which base-class constructor to use to initialize the base-class part of the derived object.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The base class is initialized first, and then the members of the derived class are initialized in the order in which they are declared in the class.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Using Members of the Base Class from the Derived Class</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">A derived class may access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members of its base class:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">if the specified number of items are purchased, use the discounted price</span></span></span><br class="calibre6"/>double Bulk_quote::net_price(size_t cnt) const<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;if (cnt &gt;= min_qty)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return cnt * (1 - discount) * price;<br class="calibre6"/>&#160;&#160;&#160;&#160;else<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return cnt * price;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14"><a id="filepos3823114"/>This function generates a discounted price: If the given quantity is more than <code class="calibre23"><tt class="calibre23"><span class="calibre24">min_qty</span></tt></code>, we apply the <code class="calibre23"><tt class="calibre23"><span class="calibre24">discount</span></tt></code> (which was stored as a fraction) to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We&#8217;ll have more to say about scope in &#167;<a href="147-15.6._class_scope_under_inheritance.html#filepos3941072">15.6</a> (p. <a href="147-15.6._class_scope_under_inheritance.html#filepos3941072">617</a>), but for now it&#8217;s worth knowing that the scope of a derived class is nested inside the scope of its base class. As a result, there is no distinction between how a member of the derived class uses members defined in its own class (e.g., <code class="calibre23"><tt class="calibre23"><span class="calibre24">min_qty</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">discount</span></tt></code>) and how it uses members defined in its base (e.g., <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code>).</p><div class="calibre22">&#160;</div>
<div class="calibre35"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre14"><span class="calibre5"><a/>Key Concept: Respecting the Base-Class Interface</span></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">It is essential to understand that each class defines its own interface. Interactions with an object of a class-type should use the interface of that class, even if that object is the base-class part of a derived object.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">As a result, derived-class constructors may not directly initialize the members of its base class. The constructor body of a derived constructor can assign values to its <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> base-class members. Although it <em class="calibre16">can</em> assign to those members, it generally <em class="calibre16">should not</em> do so. Like any other user of the base class, a derived class should respect the interface of its base class by using a constructor to initialize its inherited members.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Inheritance and <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">static</span></span></tt></span></span></tt></code> Members</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">If a base class defines a <code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> member (&#167;<a href="078-7.6._static_class_members.html#filepos2028441">7.6</a>, p. <a href="078-7.6._static_class_members.html#filepos2028441">300</a>), there is only one such member defined for the entire hierarchy. Regardless of the number of classes derived from a base class, there exists a single instance of each <code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> member.</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Base {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;static void statmem();<br class="calibre6"/>};<br class="calibre6"/>class Derived : public Base {<br class="calibre6"/>&#160;&#160;&#160;&#160;void f(const Derived&amp;);<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14"><code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> members obey normal access control. If the member is <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> in the base class, then derived classes have no access to it. Assuming the member is accessible, we can use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> member through either the base or derived:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">void Derived::f(const Derived &amp;derived_obj)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;Base::statmem();&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">defines</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">statmem</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;Derived::statmem(); // <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Derived</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">inherits</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">statmem</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: derived objects can be used to access</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">static</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">from base</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;derived_obj.statmem(); // <span><span class="calibre45"><span class="calibre16">accessed through a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Derived</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">object</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;statmem();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">accessed through this object</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos3828987"/>Declarations of Derived Classes</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">A derived class is declared like any other class (&#167;<a href="075-7.3._additional_class_features.html#filepos1897012">7.3.3</a>, p. <a href="075-7.3._additional_class_features.html#filepos1897012">278</a>). The declaration contains the class name but does not include its derivation list:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Bulk_quote : public Quote; // <span><span class="calibre45"><span class="calibre16">error: derivation list can't appear here</span></span></span><br class="calibre6"/>class Bulk_quote;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: right way to declare a derived class</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The purpose of a declaration is to make known that a name exists and what kind of entity it denotes, for example, a class, function, or variable. The derivation list, and all other details of the definition, must appear together in the class body.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Classes Used as a Base Class</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">A class must be defined, not just declared, before we can use it as a base class:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Quote;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">declared but not defined</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">must be defined</span></span></span><br class="calibre6"/>class Bulk_quote : public Quote { ... };</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The reason for this restriction should be easy to see: Each derived class contains, and may use, the members it inherits from its base class. To use those members, the derived class must know what they are. One implication of this rule is that it is impossible to derive a class from itself.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A base class can itself be a derived class:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Base { /* <span><span class="calibre45"><span class="calibre16">...</span></span></span> */ } ;<br class="calibre6"/>class D1: public Base { /* <span><span class="calibre45"><span class="calibre16">...</span></span></span> */ };<br class="calibre6"/>class D2: public D1 { /* <span><span class="calibre45"><span class="calibre16">...</span></span></span> */ };</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">In this hierarchy, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code> is a <strong class="calibre5"><a id="filepos3832397" href="152-defined_terms.html#filepos4142981">direct base</a></strong> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">D1</span></tt></code> and an <strong class="calibre5"><a id="filepos3832546" href="152-defined_terms.html#filepos4144331">indirect base</a></strong> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">D2</span></tt></code>. A direct base class is named in the derivation list. An indirect base is one that a derived class inherits through its direct base class.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Each class inherits all the members of its direct base class. The most derived class inherits the members of its direct base. The members in the direct base include those it inherits from its base class, and so on up the inheritance chain. Effectively, the most derived object contains a subobject for its direct base and for each of its indirect bases.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Preventing Inheritance</span></h5><div class="calibre38">&#160;</div>
<div class="calibre28"><a id="filepos3833370"/><img alt="Image" src="images/00008.jpg" class="calibre9"/></div>
<p class="calibre14">Sometimes we define a class that we don&#8217;t want others to inherit from. Or we might define a class for which we don&#8217;t want to think about whether it is appropriate as a base class. Under the new standard, we can prevent a class from being used as a base by following the class name with <code class="calibre23"><tt class="calibre23"><span class="calibre24">final</span></tt></code>:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class NoDerived final { /*&#160;&#160;*/ }; // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">NoDerived</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">can't be a base class</span></span></span><br class="calibre6"/>class Base { /*&#160;&#160;*/ };<br class="calibre6"/>// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Last</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">final;</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">we cannot inherit from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Last</span></span></tt></span><br class="calibre6"/>class Last final : Base { /*&#160;&#160;*/ }; // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Last</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">can't be a base class</span></span></span><br class="calibre6"/>class Bad : NoDerived { /*&#160;&#160;*/ };&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">NoDerived is final</span></span></tt></span><br class="calibre6"/>class Bad2 : Last { /*&#160;&#160;*/ };&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Last</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">final</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><a id="filepos3835601"/><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 15.2.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.4:</strong> Which of the following declarations, if any, are incorrect? Explain why.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre26"><p class="calibre53"><code class="calibre23"><tt class="calibre23"><span class="calibre24">class Base { ... };</span></tt></code></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre53">(a) <code class="calibre23"><tt class="calibre23"><span class="calibre24">class Derived : public Derived { ... };</span></tt></code></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre53">(b) <code class="calibre23"><tt class="calibre23"><span class="calibre24">class Derived : private Base { ... };</span></tt></code></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre53">(c) <code class="calibre23"><tt class="calibre23"><span class="calibre24">class Derived : public Base;</span></tt></code></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.5:</strong> Define your own version of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> class.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.6:</strong> Test your <code class="calibre23"><tt class="calibre23"><span class="calibre24">print_total</span></tt></code> function from the exercises in &#167; <a href="143-15.2._defining_base_and_derived_classes.html#filepos3796139">15.2.1</a> (p. <a href="143-15.2._defining_base_and_derived_classes.html#filepos3796139">595</a>) by passing both <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> objects o that function.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.7:</strong> Define a class that implements a limited discount strategy, which applies a discount to books purchased up to a given limit. If the number of copies exceeds that limit, the normal price applies to those purchased beyond the limit.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos3837843" class="calibre37"><span class="calibre5">15.2.3. Conversions and Inheritance</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Understanding conversions between base and derived classes is essential to understanding how object-oriented programming works in C++.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre14">Ordinarily, we can bind a reference or a pointer only to an object that has the same type as the corresponding reference or pointer (&#167;<a href="023-2.3._compound_types.html#filepos396246">2.3.1</a>, p. <a href="023-2.3._compound_types.html#filepos396246">51</a>, and &#167;<a href="023-2.3._compound_types.html#filepos409391">2.3.2</a>, p. <a href="023-2.3._compound_types.html#filepos409391">52</a>) or to a type that involves an acceptable <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> conversion (&#167;<a href="049-4.11._type_conversions.html#filepos1178431">4.11.2</a>, p. <a href="049-4.11._type_conversions.html#filepos1178431">162</a>). Classes related by inheritance are an important exception: We can bind a pointer or reference to a base-class type to an object of a type derived from that base class. For example, we can use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote&amp;</span></tt></code> to refer to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object, and we can assign the address of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote*</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The fact that we can bind a reference (or pointer) to a base-class type to a derived object has a crucially important implication: When we use a reference (or pointer) to a base-class type, we don&#8217;t know the actual type of the object to which the pointer or reference is bound. That object can be an object of the base class or it can be an object of a derived class.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Like built-in pointers, the smart pointer classes (&#167;<a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos2904799">12.1</a>, p. <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos2904799">450</a>) support the derived-to-base conversion&#8212;we can store a pointer to a derived object in a smart pointer to the base type.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Static Type and Dynamic Type</span></h5><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre14">When we use types related by inheritance, we often need to distinguish between the <strong class="calibre5"><a id="filepos3840881" href="152-defined_terms.html#filepos4149491">static type</a></strong> of a variable or other expression and the <strong class="calibre5"><a id="filepos3840996" href="152-defined_terms.html#filepos4143767">dynamic type</a></strong> of the object that expression represents. The static type of an expression is always known at compile time&#8212;it is the type with which a variable is declared or that an expression yields. The dynamic type is the type of the object in memory that the variable or expression represents. The dynamic type may not be known until run time.</p><div class="calibre15">&#160;</div>
<p class="calibre25"><a id="filepos3841465"/>For example, when <code class="calibre23"><tt class="calibre23"><span class="calibre24">print_total</span></tt></code> calls <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> (&#167;<a href="142-15.1._oop_an_overview.html#filepos3782427">15.1</a>, p. <a href="142-15.1._oop_an_overview.html#filepos3782427">593</a>):</p><div class="calibre22">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">double ret = item.net_price(n);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">we know that the static type of <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code> is <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote&amp;</span></tt></code>. The dynamic type depends on the type of the argument to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code> is bound. That type cannot be known until a call is executed at run time. If we pass a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object to <code class="calibre23"><tt class="calibre23"><span class="calibre24">print_total</span></tt></code>, then the static type of <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code> will differ from its dynamic type. As we&#8217;ve seen, the static type of <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code> is <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote&amp;</span></tt></code>, but in this case the dynamic type is <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The dynamic type of an expression that is neither a reference nor a pointer is always the same as that expression&#8217;s static type. For example, a variable of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> is always a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> object; there is nothing we can do that will change the type of the object to which that variable corresponds.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">It is crucial to understand that the static type of a pointer or reference to a base class may differ from its dynamic type.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">There Is No Implicit Conversion from Base to Derived ...</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The conversion from derived to base exists because every derived object contains a base-class part to which a pointer or reference of the base-class type can be bound. There is no similar guarantee for base-class objects. A base-class object can exist either as an independent object or as part of a derived object. A base object that is not part of a derived object has only the members defined by the base class; it doesn&#8217;t have the members defined by the derived class.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Because a base object might or might not be part of a derived object, there is no automatic conversion from the base class to its derived class(s):</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Quote base;<br class="calibre6"/>Bulk_quote* bulkP = &amp;base;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error: can't convert base to derived</span></span></span><br class="calibre6"/>Bulk_quote&amp; bulkRef = base; // <span><span class="calibre45"><span class="calibre16">error: can't convert base to derived</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">If these assignments were legal, we might attempt to use <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulkP</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulkRef</span></tt></code> to use members that do not exist in <code class="calibre23"><tt class="calibre23"><span class="calibre24">base</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">What is sometimes a bit surprising is that we cannot convert from base to derived even when a base pointer or reference is bound to a derived object:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Bulk_quote bulk;<br class="calibre6"/>Quote *itemP = &amp;bulk;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: dynamic type is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Bulk_quote</span></span></tt></span><br class="calibre6"/>Bulk_quote *bulkP = itemP;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error: can't convert base to derived</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The compiler has no way to know (at compile time) that a specific conversion will be safe at run time. The compiler looks only at the static types of the pointer or reference to determine whether a conversion is legal. If the base class has one or more virtual functions, we can use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">dynamic_cast</span></tt></code> (which we&#8217;ll cover in &#167;<a href="178-19.2._runtime_type_identification.html#filepos5161190">19.2.1</a> (p. <a href="178-19.2._runtime_type_identification.html#filepos5161190">825</a>)) to request a conversion that is checked at run time. Alternatively, in those cases when we <em class="calibre16">know</em> that the conversion from base to derived is safe, we can use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">static_cast</span></tt></code> (&#167;<a href="049-4.11._type_conversions.html#filepos1189032">4.11.3</a>, p. <a href="049-4.11._type_conversions.html#filepos1189032">162</a>) to override the compiler.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos3847559"/>...and No Conversion between Objects</span></h5><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre14">The automatic derived-to-base conversion applies only for conversions to a reference or pointer type. There is no such conversion from a derived-class type to the base-class type. Nevertheless, it is often possible to convert an object of a derived class to its base-class type. However, such conversions may not behave as we might want.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Remember that when we initialize or assign an object of a class type, we are actually calling a function. When we initialize, we&#8217;re calling a constructor (&#167;<a href="121-13.1._copy_assign_and_destroy.html#filepos3203084">13.1.1</a>, p. <a href="121-13.1._copy_assign_and_destroy.html#filepos3203084">496</a>, and &#167;<a href="126-13.6._moving_objects.html#filepos3443291">13.6.2</a>, p. <a href="126-13.6._moving_objects.html#filepos3443291">534</a>); when we assign, we&#8217;re calling an assignment operator (&#167;<a href="121-13.1._copy_assign_and_destroy.html#filepos3222083">13.1.2</a>, p. <a href="121-13.1._copy_assign_and_destroy.html#filepos3222083">500</a>, and &#167;<a href="126-13.6._moving_objects.html#filepos3443291">13.6.2</a>, p. <a href="126-13.6._moving_objects.html#filepos3443291">536</a>). These members normally have a parameter that is a reference to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> version of the class type.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Because these members take references, the derived-to-base conversion lets us pass a derived object to a base-class copy/move operation. These operations are not virtual. When we pass a derived object to a base-class constructor, the constructor that is run is defined in the base class. That constructor knows <em class="calibre16">only</em> about the members of the base class itself. Similarly, if we assign a derived object to a base object, the assignment operator that is run is the one defined in the base class. That operator also knows <em class="calibre16">only</em> about the members of the base class itself.</p><div class="calibre22">&#160;</div>
<p class="calibre25">For example, our bookstore classes use the synthesized versions of copy and assignment (&#167;<a href="121-13.1._copy_assign_and_destroy.html#filepos3203084">13.1.1</a>, p. <a href="121-13.1._copy_assign_and_destroy.html#filepos3203084">497</a>, and &#167;<a href="121-13.1._copy_assign_and_destroy.html#filepos3222083">13.1.2</a>, p. <a href="121-13.1._copy_assign_and_destroy.html#filepos3222083">500</a>). We&#8217;ll have more to say about copy control and inheritance in &#167;<a href="148-15.7._constructors_and_copy_control.html#filepos3980968">15.7.2</a> (p. <a href="148-15.7._constructors_and_copy_control.html#filepos3980968">623</a>), but for now what&#8217;s useful to know is that the synthesized versions memberwise copy or assign the data members of the class the same way as for any other class:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Bulk_quote bulk;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">object of derived type</span></span></span><br class="calibre6"/>Quote item(bulk);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">uses the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Quote::Quote(const Quote&amp;</span></span></tt></span>) <span><span class="calibre45"><span class="calibre16">constructor</span></span></span><br class="calibre6"/>item = bulk;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">calls</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Quote::operator=(const Quote&amp;</span></span></tt></span>)</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">When <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code> is constructed, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> copy constructor is run. That constructor knows only about the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> members. It copies those members from the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> part of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulk</span></tt></code> and <em class="calibre16">ignores</em> the members that are part of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> portion of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulk</span></tt></code>. Similarly for the assignment of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulk</span></tt></code> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code>; only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> part of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulk</span></tt></code> is assigned to <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Because the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> part is ignored, we say that the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> portion of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulk</span></tt></code> is <strong class="calibre5"><a id="filepos3852622" href="152-defined_terms.html#filepos4149088">sliced down</a></strong>.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">When we initialize or assign an object of a base type from an object of a derived type, only the base-class part of the derived object is copied, moved, or assigned. The derived part of the object is ignored.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="142-15.1._oop_an_overview.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="144-15.3._virtual_functions.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
