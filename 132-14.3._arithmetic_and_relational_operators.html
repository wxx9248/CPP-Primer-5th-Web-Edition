<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>14.3. Arithmetic and Relational Operators</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="131-14.2._input_and_output_operators.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="133-14.4._assignment_operators.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos3595833" class="calibre29"><span class="bold">14.3. Arithmetic and Relational Operators</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">Ordinarily, we define the arithmetic and relational operators as nonmember functions in order to allow conversions for either the left- or right-hand operand (&#167; <a href="130-14.1._basic_concepts.html#filepos3549336">14.1</a>, p. <a href="130-14.1._basic_concepts.html#filepos3549336">555</a>). These operators shouldn&#8217;t need to change the state of either operand, so the parameters are ordinarily references to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">An arithmetic operator usually generates a new value that is the result of a computation on its two operands. That value is distinct from either operand and is calculated in a local variable. The operation returns a copy of this local as its result. Classes that define an arithmetic operator generally define the corresponding compound assignment operator as well. When a class has both operators, it is usually more efficient to define the arithmetic operator to use compound assignment:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">assumes that both objects refer to the same book</span></span></span><br class="calibre6"/>Sales_data<br class="calibre6"/>operator+(const Sales_data &amp;lhs, const Sales_data &amp;rhs)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data sum = lhs;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">copy data members from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">lhs</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">into</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">sum</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;sum += rhs;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">add</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">rhs</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">into</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">sum</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return sum;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">This definition is essentially identical to our original <code class="calibre23"><tt class="calibre23"><span class="calibre24">add</span></tt></code> function (&#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">7.1.3</a>, p. <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">261</a>). We copy <code class="calibre23"><tt class="calibre23"><span class="calibre24">lhs</span></tt></code> into the local variable <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code>. We then use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> compound-assignment operator (which we&#8217;ll define on page <a href="133-14.4._assignment_operators.html#filepos3616357">564</a>) to add the values from <code class="calibre23"><tt class="calibre23"><span class="calibre24">rhs</span></tt></code> into <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code>. We end the function by returning a copy of <code class="calibre23"><tt class="calibre23"><span class="calibre24">sum</span></tt></code>.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><a id="filepos3599248"/><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00018.jpg" class="calibre9"/> Tip</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Classes that define both an arithmetic operator and the related compound assignment ordinarily ought to implement the arithmetic operator by using the compound assignment.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 14.3</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.13:</strong> Which other arithmetic operators (<a href="040-4.2._arithmetic_operators.html#filepos1028961">Table 4.1</a> (p. <a href="040-4.2._arithmetic_operators.html#filepos1028961">139</a>)), if any, do you think <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> ought to support? Define any you think the class should include.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.14:</strong> Why do you think it is more efficient to define <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator+</span></tt></code> to call <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator+=</span></tt></code> rather than the other way around?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.15:</strong> Should the class you chose for <a href="077-7.5._constructors_revisited.html#filepos1972067">exercise 7.40</a> from &#167; <a href="077-7.5._constructors_revisited.html#filepos1953073">7.5.1</a> (p. <a href="077-7.5._constructors_revisited.html#filepos1953073">291</a>) define any of the arithmetic operators? If so, implement them. If not, explain why not.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos3601039" class="calibre37"><span class="calibre5">14.3.1. Equality Operators</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Ordinarily, classes in C++ define the equality operator to test whether two objects are equivalent. That is, they usually compare every data member and treat two objects as equal if and only if all the corresponding members are equal. In line with this design philosophy, our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> equality operator should compare the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> as well as the sales figures:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">bool operator==(const Sales_data &amp;lhs, const Sales_data &amp;rhs)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;return lhs.isbn() == rhs.isbn() &amp;&amp;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lhs.units_sold == rhs.units_sold &amp;&amp;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lhs.revenue == rhs.revenue;<br class="calibre6"/>}<br class="calibre6"/>bool operator!=(const Sales_data &amp;lhs, const Sales_data &amp;rhs)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;return !(lhs == rhs);<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The definition of these functions is trivial. More important are the design principles that these functions embody:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; If a class has an operation to determine whether two objects are equal, it should define that function as <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator==</span></tt></code> rather than as a named function: Users will expect to be able to compare objects using <code class="calibre23"><tt class="calibre23"><span class="calibre24">==;</span></tt></code> providing <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> means they won&#8217;t need to learn and remember a new name for the operation; and it is easier to use the library containers and algorithms with classes that define the <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> operator.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; If a class defines <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator==</span></tt></code>, that operator ordinarily should determine whether the given objects contain equivalent data.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27"><a id="filepos3603798"/>&#8226; Ordinarily, the equality operator should be transitive, meaning that if <code class="calibre23"><tt class="calibre23"><span class="calibre24">a == b</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">b == c</span></tt></code> are both true, then <code class="calibre23"><tt class="calibre23"><span class="calibre24">a == c</span></tt></code> should also be true.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; If a class defines <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator==</span></tt></code>, it should also define <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator!=</span></tt></code>. Users will expect that if they can use <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> then they can also use <code class="calibre23"><tt class="calibre23"><span class="calibre24">!=</span></tt></code>, and vice versa.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; One of the equality or inequality operators should delegate the work to the other. That is, one of these operators should do the real work to compare objects. The other should call the one that does the real work.</p></blockquote><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Classes for which there is a logical meaning for equality normally should define <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator==</span></tt></code>. Classes that define <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> make it easier for users to use the class with the library algorithms.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 14.3.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.16:</strong> Define equality and inequality operators for your <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlob</span></tt></code> (&#167; <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos2907541">12.1.1</a>, p. <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos2907541">456</a>), <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlobPtr</span></tt></code> (&#167; <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos3062321">12.1.6</a>, p. <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos3062321">474</a>), <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrVec</span></tt></code> (&#167; <a href="125-13.5._classes_that_manage_dynamic_memory.html#filepos3380687">13.5</a>, p. <a href="125-13.5._classes_that_manage_dynamic_memory.html#filepos3380687">526</a>), and <code class="calibre23"><tt class="calibre23"><span class="calibre24">String</span></tt></code> (&#167; <a href="125-13.5._classes_that_manage_dynamic_memory.html#filepos3380687">13.5</a>, p. <a href="125-13.5._classes_that_manage_dynamic_memory.html#filepos3380687">531</a>) classes.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.17:</strong> Should the class you chose for <a href="077-7.5._constructors_revisited.html#filepos1972067">exercise 7.40</a> from &#167; <a href="077-7.5._constructors_revisited.html#filepos1953073">7.5.1</a> (p. <a href="077-7.5._constructors_revisited.html#filepos1953073">291</a>) define the equality operators? If so, implement them. If not, explain why not.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos3607012" class="calibre37"><span class="calibre5">14.3.2. Relational Operators</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Classes for which the equality operator is defined also often (but not always) have relational operators. In particular, because the associative containers and some of the algorithms use the less-than operator, it can be useful to define an <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator&lt;</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Ordinarily the relational operators should</p><div class="calibre22">&#160;</div>
<blockquote class="calibre26"><p class="calibre47"><strong class="calibre5">1.</strong> Define an ordering relation that is consistent with the requirements for use as a key to an associative container (&#167; <a href="108-11.2._overview_of_the_associative_containers.html#filepos2751456">11.2.2</a>, p. <a href="108-11.2._overview_of_the_associative_containers.html#filepos2751456">424</a>); and</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre47"><strong class="calibre5">2.</strong> Define a relation that is consistent with <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> if the class has both operators. In particular, if two objects are <code class="calibre23"><tt class="calibre23"><span class="calibre24">!=</span></tt></code>, then one object should be <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> the other.</p></blockquote><div class="calibre15">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre25">Although we might think our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class should support the relational operators, it turns out that it probably should not do so. The reasons are subtle and are worth understanding.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We might think that we&#8217;d define <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> similarly to <code class="calibre23"><tt class="calibre23"><span class="calibre24">compareIsbn</span></tt></code> (&#167; <a href="108-11.2._overview_of_the_associative_containers.html#filepos2751456">11.2.2</a>, p. <a href="108-11.2._overview_of_the_associative_containers.html#filepos2751456">425</a>). That function compared <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> objects by comparing their <small class="calibre48">ISBN</small>s. Although <code class="calibre23"><tt class="calibre23"><span class="calibre24">compareIsbn</span></tt></code> provides an ordering relation that meets requirment 1, that function yields results that are inconsistent with our definition of <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code>. As a result, it does not meet requirement 2.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data ==</span></tt></code> operator treats two transactions with the same <small class="calibre48">ISBN</small> as unequal if they have different <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> members. If we defined <a id="filepos3609993"/>the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> operator to compare only the <small class="calibre48">ISBN</small> member, then two objects with the same <small class="calibre48">ISBN</small> but different <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> would compare as unequal, but neither object would be less than the other. Ordinarily, if we have two objects, neither of which is less than the other, then we expect that those objects are equal.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We might think that we should, therefore, define <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator&lt;</span></tt></code> to compare each data element in turn. We could define <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator&lt;</span></tt></code> to compare objects with equal <code class="calibre23"><tt class="calibre23"><span class="calibre24">isbn</span></tt></code>s by looking next at the <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and then at the <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> members.</p><div class="calibre22">&#160;</div>
<p class="calibre25">However, there is nothing essential about this ordering. Depending on how we plan to use the class, we might want to define the order based first on either <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code>. We might want those objects with fewer <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> to be &#8220;less than&#8221; those with more. Or we might want to consider those with smaller <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> &#8220;less than&#8221; those with more.</p><div class="calibre22">&#160;</div>
<p class="calibre25">For <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>, there is no single logical definition of <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code>. Thus, it is better for this class not to define <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> at all.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">If a single logical definition for <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> exists, classes usually should define the <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> operator. However, if the class also has <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code>, define <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> only if the definitions of <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">==</span></tt></code> yield consistent results.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 14.3.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.18:</strong> Define relational operators for your <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlob</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlobPtr</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrVec</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">String</span></tt></code> classes.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.19:</strong> Should the class you chose for <a href="077-7.5._constructors_revisited.html#filepos1972067">exercise 7.40</a> from &#167; <a href="077-7.5._constructors_revisited.html#filepos1953073">7.5.1</a> (p. <a href="077-7.5._constructors_revisited.html#filepos1953073">291</a>) define the relational operators? If so, implement them. If not, explain why not.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="131-14.2._input_and_output_operators.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="133-14.4._assignment_operators.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
