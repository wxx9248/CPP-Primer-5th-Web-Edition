<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>14.6. Increment and Decrement Operators</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="134-14.5._subscript_operator.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="136-14.7._member_access_operators.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos3630002" class="calibre29"><span class="bold">14.6. Increment and Decrement Operators</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">The increment (<code class="calibre23"><tt class="calibre23"><span class="calibre24">++</span></tt></code>) and decrement (<code class="calibre23"><tt class="calibre23"><span class="calibre24">--</span></tt></code>) operators are most often implemented for iterator classes. These operators let the class move between the elements of a sequence. There is no language requirement that these operators be members of the class. However, because these operators change the state of the object on which they operate, our preference is to make them members.</p><div class="calibre15">&#160;</div>
<p class="calibre25">For the built-in types, there are both prefix and postfix versions of the increment and decrement operators. Not surprisingly, we can define both the prefix and postfix instances of these operators for our own classes as well. We&#8217;ll look at the prefix versions first and then implement the postfix ones.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Classes that define increment or decrement operators should define both the prefix and postfix versions. These operators usually should be defined as members.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Defining Prefix Increment/Decrement Operators</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">To illustrate the increment and decrement operators, we&#8217;ll define these operators for our <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlobPtr</span></tt></code> class (&#167; <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos3062321">12.1.6</a>, p. <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos3062321">474</a>):</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class StrBlobPtr {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">increment and decrement</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;StrBlobPtr&amp; operator++();&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">prefix operators</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;StrBlobPtr&amp; operator--();<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">other members as before</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">To be consistent with the built-in operators, the prefix operators should return a reference to the incremented or decremented object.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25"><a/>The increment and decrement operators work similarly to each other&#8212;they call <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code> to verify that the <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlobPtr</span></tt></code> is still valid. If so, <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code> also verifies that its given index is valid. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code> doesn&#8217;t throw an exception, these operators return a reference to this object.</p><div class="calibre22">&#160;</div>
<p class="calibre25">In the case of increment, we pass the current value of <code class="calibre23"><tt class="calibre23"><span class="calibre24">curr</span></tt></code> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code>. So long as that value is less than the size of the underlying <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code> will return. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">curr</span></tt></code> is already at the end of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code> will throw:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">prefix: return a reference to the incremented/decremented object</span></span></span><br class="calibre6"/>StrBlobPtr&amp; StrBlobPtr::operator++()<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">if</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">curr</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">already points past the end of the container, can't increment it</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;check(curr, "increment past end of StrBlobPtr");<br class="calibre6"/>&#160;&#160;&#160;&#160;++curr;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">advance the current state</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return *this;<br class="calibre6"/>}<br class="calibre6"/><br class="calibre6"/>StrBlobPtr&amp; StrBlobPtr::operator--()<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">if</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">curr</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is zero, decrementing it will yield an invalid subscript</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;--curr;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">move the current state back one element</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;check(-1, "decrement past begin of StrBlobPtr");<br class="calibre6"/>&#160;&#160;&#160;&#160;return *this;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The decrement operator decrements <code class="calibre23"><tt class="calibre23"><span class="calibre24">curr</span></tt></code> before calling <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code>. That way, if <code class="calibre23"><tt class="calibre23"><span class="calibre24">curr</span></tt></code> (which is an <code class="calibre23"><tt class="calibre23"><span class="calibre24">unsigned</span></tt></code> number) is already zero, the value that we pass to <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code> will be a large positive value representing an invalid subscript (&#167; <a href="021-2.1._primitive_builtin_types.html#filepos304094">2.1.2</a>, p. <a href="021-2.1._primitive_builtin_types.html#filepos304094">36</a>).</p><div class="calibre15">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Differentiating Prefix and Postfix Operators</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">There is one problem with defining both the prefix and postfix operators: Normal overloading cannot distinguish between these operators. The prefix and postfix versions use the same symbol, meaning that the overloaded versions of these operators have the same name. They also have the same number and type of operands.</p><div class="calibre15">&#160;</div>
<p class="calibre25">To solve this problem, the postfix versions take an extra (unused) parameter of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code>. When we use a postfix operator, the compiler supplies 0 as the argument for this parameter. Although the postfix function can use this extra parameter, it usually should not. That parameter is not needed for the work normally performed by a postfix operator. Its sole purpose is to distinguish a postfix function from the prefix version.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We can now add the postfix operators to <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlobPtr</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class StrBlobPtr {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">increment and decrement</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;StrBlobPtr operator++(int);&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">postfix operators</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;StrBlobPtr operator--(int);<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">other members as before</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><a id="filepos3639046"/><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">To be consistent with the built-in operators, the postfix operators should return the old (unincremented or undecremented) value. That value is returned as a value, not a reference.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre14">The postfix versions have to remember the current state of the object before incrementing the object:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">postfix: increment/decrement the object but return the unchanged value</span></span></span><br class="calibre6"/>StrBlobPtr StrBlobPtr::operator++(int)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">no check needed here; the call to prefix increment will do the check</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;StrBlobPtr ret = *this;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">save the current value</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;++*this;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">advance one element; prefix</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">++</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">checks the increment</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return ret;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">return the saved state</span></span></span><br class="calibre6"/>}<br class="calibre6"/>StrBlobPtr StrBlobPtr::operator--(int)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">no check needed here; the call to prefix decrement will do the check</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;StrBlobPtr ret = *this;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">save the current value</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;--*this;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">move backward one element; prefix</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">--</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">checks the decrement</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return ret;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">return the saved state</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Each of our operators calls its own prefix version to do the actual work. For example, the postfix increment operator executes</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">++*this</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This expression calls the prefix increment operator. That operator checks that the increment is safe and either throws an exception or increments <code class="calibre23"><tt class="calibre23"><span class="calibre24">curr</span></tt></code>. Assuming <code class="calibre23"><tt class="calibre23"><span class="calibre24">check</span></tt></code> doesn&#8217;t throw an exception, the postfix functions return the stored copy in <code class="calibre23"><tt class="calibre23"><span class="calibre24">ret</span></tt></code>. Thus, after the return, the object itself has been advanced, but the value returned reflects the original, unincremented value.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> parameter is not used, so we do not give it a name.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Calling the Postfix Operators Explicitly</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">As we saw on page <a href="130-14.1._basic_concepts.html#filepos3553930">553</a>, we can explicitly call an overloaded operator as an alternative to using it as an operator in an expression. If we want to call the postfix version using a function call, then we must pass a value for the integer argument:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">StrBlobPtr p(a1); // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">p</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">points to the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">vector</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">inside</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">a1</span></span></tt></span><br class="calibre6"/>p.operator++(0);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">call postfix</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">operator++</span></span></tt></span><br class="calibre6"/>p.operator++();&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">call prefix</span></span></span>&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">operator++</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The value passed usually is ignored but is necessary in order to tell the compiler to use the postfix version.</p><div class="calibre15">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><a id="filepos3644899"/><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 14.6</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.27:</strong> Add increment and decrement operators to your <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlobPtr</span></tt></code> class.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.28:</strong> Define addition and subtraction for <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlobPtr</span></tt></code> so that these operators implement pointer arithmetic (&#167; <a href="034-3.5._arrays.html#filepos881970">3.5.3</a>, p. <a href="034-3.5._arrays.html#filepos881970">119</a>).</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.29:</strong> We did not define a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> version of the increment and decrement operators. Why not?</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="134-14.5._subscript_operator.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="136-14.7._member_access_operators.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
