<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>1.6. The Bookstore Program</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="015-1.5._introducing_classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="017-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos244566" class="calibre29"><span class="bold">1.6. The Bookstore Program</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">We are now ready to solve our original bookstore problem. We need to read a file of sales transactions and produce a report that shows, for each book, the total number of copies sold, the total revenue, and the average sales price. We&#8217;ll assume that all the transactions for each <small class="calibre48">ISBN</small> are grouped together in the input.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Our program will combine the data for each <small class="calibre48">ISBN</small> in a variable named <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>. We&#8217;ll use a second variable named <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> to hold each transaction we read. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> refer to the same <small class="calibre48">ISBN</small>, we&#8217;ll update <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>. Otherwise we&#8217;ll print <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> and reset it using the transaction we just read:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">#include &lt;iostream&gt;<br class="calibre6"/>#include "Sales_item.h"<br class="calibre6"/>int main()<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_item total; // <span><span class="calibre45"><span class="calibre16">variable to hold data for the next transaction</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">read the first transaction and ensure that there are data to process</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;if (std::cin &gt;&gt; total) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Sales_item trans; // <span><span class="calibre45"><span class="calibre16">variable to hold the running sum</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">read and process the remaining transactions</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;while (std::cin &gt;&gt; trans) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">if we're still processing the same book</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (total.isbn() == trans.isbn())<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;total += trans; // <span><span class="calibre45"><span class="calibre16">update the running</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">total</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print results for the previous book</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::cout &lt;&lt; total &lt;&lt; std::endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;total = trans;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">total</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">now refers to the next book</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::cout &lt;&lt; total &lt;&lt; std::endl; // <span><span class="calibre45"><span class="calibre16">print the last transaction</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;} else {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">no input! warn the user</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::cerr &lt;&lt; "No data?!" &lt;&lt; std::endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return -1;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">indicate failure</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;return 0;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25"><a/>This program is the most complicated one we&#8217;ve seen so far, but it uses only facilities that we have already seen.</p><div class="calibre22">&#160;</div>
<p class="calibre25">As usual, we begin by including the headers that we use, <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code> from the library and our own <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item.h</span></tt></code>. Inside <code class="calibre23"><tt class="calibre23"><span class="calibre24">main</span></tt></code> we define an object named <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>, which we&#8217;ll use to sum the data for a given <small class="calibre48">ISBN</small>. We start by reading the first transaction into <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> and testing whether the read was successful. If the read fails, then there are no records and we fall through to the outermost <code class="calibre23"><tt class="calibre23"><span class="calibre24">else</span></tt></code> branch, which tells the user that there was no input.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Assuming we have successfully read a record, we execute the block following the outermost <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code>. That block starts by defining the object named <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>, which will hold our transactions as we read them. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> statement will read all the remaining records. As in our earlier programs, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> condition reads a value from the standard input. In this case, we read a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item</span></tt></code> object into <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code>. As long as the read succeeds, we execute the body of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The body of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> is a single <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> statement. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> checks whether the <small class="calibre48">ISBN</small>s are equal. If so, we use the compound assignment operator to add <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code>. If the <small class="calibre48">ISBN</small>s are not equal, we print the value stored in <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> and reset <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> by assigning <code class="calibre23"><tt class="calibre23"><span class="calibre24">trans</span></tt></code> to it. After executing the <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code>, we return to the condition in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code>, reading the next transaction, and so on until we run out of records.</p><div class="calibre22">&#160;</div>
<p class="calibre25">When the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> terminates, <code class="calibre23"><tt class="calibre23"><span class="calibre24">total</span></tt></code> contains the data for the last <small class="calibre48">ISBN</small> in the file. We write the data for the last <small class="calibre48">ISBN</small> in the last statement of the block that concludes the outermost <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> statement.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 1.6</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 1.25:</strong> Using the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_item.h</span></tt></code> header from the Web site, compile and execute the bookstore program presented in this section.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="015-1.5._introducing_classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="017-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
