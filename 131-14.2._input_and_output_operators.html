<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>14.2. Input and Output Operators</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="130-14.1._basic_concepts.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="132-14.3._arithmetic_and_relational_operators.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos3576045" class="calibre29"><span class="bold">14.2. Input and Output Operators</span></h3><div class="calibre12">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">As we&#8217;ve seen, the IO library uses <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">&lt;&lt;</span></tt></code> for input and output, respectively. The IO library itself defines versions of these operators to read and write the built-in types. Classes that support IO ordinarily define versions of these operators for objects of the class type.</p><div class="calibre15">&#160;</div>
<h4 id="filepos3576688" class="calibre37"><span class="calibre5"><a id="filepos3576721"/>14.2.1. Overloading the Output Operator <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">&lt;&lt;</span></span></tt></span></span></tt></code></span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Ordinarily, the first parameter of an output operator is a reference to a non<code class="calibre23"><tt class="calibre23"><span class="calibre24">const ostream</span></tt></code> object. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> is non<code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> because writing to the stream changes its state. The parameter is a reference because we cannot copy an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> object.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The second parameter ordinarily should be a reference to <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> of the class type we want to print. The parameter is a reference to avoid copying the argument. It can be <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> because (ordinarily) printing an object does not change that object.</p><div class="calibre22">&#160;</div>
<p class="calibre25">To be consistent with other output operators, <code class="calibre23"><tt class="calibre23"><span class="calibre24">operator&lt;&lt;</span></tt></code> normally returns its <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> parameter.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">The <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Output Operator</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">As an example, we&#8217;ll write the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> output operator:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">ostream &amp;operator&lt;&lt;(ostream &amp;os, const Sales_data &amp;item)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;os &lt;&lt; item.isbn() &lt;&lt; " " &lt;&lt; item.units_sold &lt;&lt; " "<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; item.revenue &lt;&lt; " " &lt;&lt; item.avg_price();<br class="calibre6"/>&#160;&#160;&#160;&#160;return os;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Except for its name, this function is identical to our earlier <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> function (&#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">7.1.3</a>, p. <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">261</a>). Printing a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> entails printing its three data elements and the computed average sales price. Each element is separated by a space. After printing the values, the operator returns a reference to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> it just wrote.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Output Operators Usually Do Minimal Formatting</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The output operators for the built-in types do little if any formatting. In particular, they do not print newlines. Users expect class output operators to behave similarly. If the operator does print a newline, then users would be unable to print descriptive text along with the object on the same line. An output operator that does minimal formatting lets users control the details of their output.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Generally, output operators should print the contents of the object, with minimal formatting. They should not print a newline.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">IO Operators Must Be Nonmember Functions</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Input and output operators that conform to the conventions of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code> library must be ordinary nonmember functions. These operators cannot be members of our own class. If they were, then the left-hand operand would have to be an object of our class type:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Sales_data data;<br class="calibre6"/>data &lt;&lt; cout; // <span><span class="calibre45"><span class="calibre16">if</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">operator&lt;&lt;</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is a member of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sales_data</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">If these operators are members of any class, they would have to be members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code>. However, those classes are part of the standard library, and we cannot add members to a class in the library.</p><div class="calibre15">&#160;</div>
<p class="calibre25"><a id="filepos3582567"/>Thus, if we want to define the IO operators for our types, we must define them as nonmember functions. Of course, IO operators usually need to read or write the non<code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> data members. As a consequence, IO operators usually must be declared as friends (&#167; <a href="074-7.2._access_control_and_encapsulation.html#filepos1841962">7.2.1</a>, p. <a href="074-7.2._access_control_and_encapsulation.html#filepos1841962">269</a>).</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 14.2.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.6:</strong> Define an output operator for your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.7:</strong> Define an output operator for you <code class="calibre23"><tt class="calibre23"><span class="calibre24">String</span></tt></code> class you wrote for the exercises in &#167; <a href="125-13.5._classes_that_manage_dynamic_memory.html#filepos3380687">13.5</a> (p. <a href="125-13.5._classes_that_manage_dynamic_memory.html#filepos3380687">531</a>).</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.8:</strong> Define an output operator for the class you chose in <a href="077-7.5._constructors_revisited.html#filepos1972067">exercise 7.40</a> from &#167; <a href="077-7.5._constructors_revisited.html#filepos1953073">7.5.1</a> (p. <a href="077-7.5._constructors_revisited.html#filepos1953073">291</a>).</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos3584098" class="calibre37"><span class="calibre5">14.2.2. Overloading the Input Operator <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">&gt;&gt;</span></span></tt></span></span></tt></code></span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Ordinarily the first parameter of an input operator is a reference to the stream from which it is to read, and the second parameter is a reference to the (non<code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code>) object into which to read. The operator usually returns a reference to its given stream. The second parameter must be non<code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> because the purpose of an input operator is to read data into this object.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">The <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Sales_data</span></span></tt></span></span></tt></code> Input Operator</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">As an example, we&#8217;ll write the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> input operator:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">istream &amp;operator&gt;&gt;(istream &amp;is, Sales_data &amp;item)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;double price;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">no need to initialize; we'll read into</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">price</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">before we use it</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;is &gt;&gt; item.bookNo &gt;&gt; item.units_sold &gt;&gt; price;<br class="calibre6"/>&#160;&#160;&#160;&#160;if (is)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">check that the inputs succeeded</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;item.revenue = item.units_sold * price;<br class="calibre6"/>&#160;&#160;&#160;&#160;else<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;item = Sales_data(); // <span><span class="calibre45"><span class="calibre16">input failed: give the object the default state</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return is;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Except for the <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> statement, this definition is similar to our earlier <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> function (&#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">7.1.3</a>, p. <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">261</a>). The <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> checks whether the reads were successful. If an IO error occurs, the operator resets its given object to the empty <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code>. That way, the object is guaranteed to be in a consistent state.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Input operators must deal with the possibility that the input might fail; output operators generally don&#8217;t bother.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos3587835"/>Errors during Input</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The kinds of errors that might happen in an input operator include the following:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A read operation might fail because the stream contains data of an incorrect type. For example, after reading <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code>, the input operator assumes that the next two items will be numeric data. If nonnumeric data is input, that read and any subsequent use of the stream will fail.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Any of the reads could hit end-of-file or some other error on the input stream.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">Rather than checking each read, we check once after reading all the data and before using those data:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">if (is)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">check that the inputs succeeded</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;item.revenue = item.units_sold * price;<br class="calibre6"/>else<br class="calibre6"/>&#160;&#160;&#160;&#160;item = Sales_data(); // <span><span class="calibre45"><span class="calibre16">input failed: give the object the default state</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">If any of the read operations fails, <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> will have an undefined value. Therefore, before using <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code>, we check that the input stream is still valid. If it is, we do the calculation and store the result in <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code>. If there was an error, we do not worry about which input failed. Instead, we reset the entire object to the empty <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> by assigning a new, default-initialized <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> object to <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code>. After this assignment, <code class="calibre23"><tt class="calibre23"><span class="calibre24">item</span></tt></code> will have an empty <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> for its <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> member, and its <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> members will be zero.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Putting the object into a valid state is especially important if the object might have been partially changed before the error occurred. For example, in this input operator, we might encounter an error after successfully reading a new <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code>. An error after reading <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> would mean that the <code class="calibre23"><tt class="calibre23"><span class="calibre24">units_sold</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">revenue</span></tt></code> members of the old object were unchanged. The effect would be to associate a different <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> with those data.</p><div class="calibre22">&#160;</div>
<p class="calibre25">By leaving the object in a valid state, we (somewhat) protect a user that ignores the possibility of an input error. The object will be in a usable state&#8212;its members are all defined. Similarly, the object won&#8217;t generate misleading results&#8212;its data are internally consistent.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Input operators should decide what, if anything, to do about error recovery.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Indicating Errors</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Some input operators need to do additional data verification. For example, our input operator might check that the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> we read is in an appropriate format. In such cases, the input operator might need to set the stream&#8217;s condition state to indicate failure (&#167; <a href="083-8.1._the_io_classes.html#filepos2085669">8.1.2</a>, p. <a href="083-8.1._the_io_classes.html#filepos2085669">312</a>), even though technically speaking the actual IO was successful. Usually an input operator should set only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">failbit</span></tt></code>. Setting <code class="calibre23"><tt class="calibre23"><span class="calibre24">eofbit</span></tt></code> would imply that the file was exhausted, and setting <code class="calibre23"><tt class="calibre23"><span class="calibre24">badbit</span></tt></code> would indicate that the stream was corrupted. These errors are best left to the IO library itself to indicate.</p><div class="calibre15">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><a id="filepos3593451"/><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 14.2.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.9:</strong> Define an input operator for your <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> class.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.10:</strong> Describe the behavior of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> input operator if given the following input:</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre26"><p class="calibre53"><strong class="calibre5">(a)</strong>
<code class="calibre23"><tt class="calibre23"><span class="calibre24">0-201-99999-9 10 24.95</span></tt></code></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre53"><strong class="calibre5">(b)</strong>
<code class="calibre23"><tt class="calibre23"><span class="calibre24">10 24.95 0-210-99999-9</span></tt></code></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.11:</strong> What, if anything, is wrong with the following <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sales_data</span></tt></code> input operator? What would happen if we gave this operator the data in the previous exercise?</p></blockquote><div class="calibre10">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">istream&amp; operator&gt;&gt;(istream&amp; in, Sales_data&amp; s)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;double price;<br class="calibre6"/>&#160;&#160;&#160;&#160;in &gt;&gt; s.bookNo &gt;&gt; s.units_sold &gt;&gt; price;<br class="calibre6"/>&#160;&#160;&#160;&#160;s.revenue = s.units_sold * price;<br class="calibre6"/>&#160;&#160;&#160;&#160;return in;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 14.12:</strong> Define an input operator for the class you used in <a href="077-7.5._constructors_revisited.html#filepos1972067">exercise 7.40</a> from &#167; <a href="077-7.5._constructors_revisited.html#filepos1953073">7.5.1</a> (p. <a href="077-7.5._constructors_revisited.html#filepos1953073">291</a>). Be sure the operator handles input errors.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="130-14.1._basic_concepts.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="132-14.3._arithmetic_and_relational_operators.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
