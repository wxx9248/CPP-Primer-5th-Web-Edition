<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>15.5. Access Control and Inheritance</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="145-15.4._abstract_base_classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="147-15.6._class_scope_under_inheritance.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos3901534" class="calibre29"><span class="bold">15.5. Access Control and Inheritance</span></h3><div class="calibre12">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Just as each class controls the initialization of its own members (&#167; <a href="143-15.2._defining_base_and_derived_classes.html#filepos3806030">15.2.2</a>, p. <a href="143-15.2._defining_base_and_derived_classes.html#filepos3806030">598</a>), each class also controls whether its members are <strong class="calibre5"><a id="filepos3901937" href="152-defined_terms.html#filepos4140381">accessible</a></strong> to a derived class.</p><div class="calibre15">&#160;</div>
<h4 class="calibre37"><span class="calibre5"><code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">protected</span></span></tt></span></span></tt></code> Members</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">As we&#8217;ve seen, a class uses <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> for those members that it is willing to share with its derived classes but wants to protect from general access. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> specifier can be thought of as a blend of <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Like <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members are inaccessible to users of the class.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Like <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members are accessible to members and friends of classes derived from this class.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">In addition, <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> has another important property:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A derived class member or friend may access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members of the base class <em class="calibre16">only</em> through a derived object. The derived class has no special access to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members of base-class objects.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">To understand this last rule, consider the following example:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"><a id="filepos3904215"/></span></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Base {<br class="calibre6"/>protected:<br class="calibre6"/>&#160;&#160;&#160;&#160;int prot_mem;&#160;&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">protected</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">member</span></span></span><br class="calibre6"/>};<br class="calibre6"/>class Sneaky : public Base&#160;&#160;{<br class="calibre6"/>&#160;&#160;&#160;&#160;friend void clobber(Sneaky&amp;);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">can access</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sneaky::prot_mem</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;friend void clobber(Base&amp;);&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">can't access</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base::prot_mem</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;int j;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">j</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">by</span></span></span>
<span><span class="calibre45"><span class="calibre16">default</span></span></span><br class="calibre6"/>};<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">clobber</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">can access the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">protected</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">members in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sneaky</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">objects</span></span></span><br class="calibre6"/>void clobber(Sneaky &amp;s) { s.j = s.prot_mem = 0; }<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">clobber</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">can't access the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">protected</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">members</span></span></span>
<span><span class="calibre45"><span class="calibre16">in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base</span></span></tt></span><br class="calibre6"/>void clobber(Base &amp;b) { b.prot_mem = 0; }</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">If derived classes (and friends) could access protected members in a base-class object, then our second version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">clobber</span></tt></code> (that takes a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base&amp;)</span></tt></code> would be legal. That function is not a friend of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code>, yet it would be allowed to change an object of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code>; we could circumvent the protection provided by <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> for any class simply by defining a new class along the lines of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Sneaky</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">To prevent such usage, members and friends of a derived class can access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members <em class="calibre16">only</em> in base-class objects that are embedded inside a derived type object; they have no special access to ordinary objects of the base type.</p><div class="calibre22">&#160;</div>
<h4 class="calibre37"><span class="calibre5"><code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">public</span></span></tt></span></span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">private</span></span></tt></span></span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos3908698" href="152-defined_terms.html#filepos4146972">protected</a></span></span></tt></span></span></tt></code> Inheritance</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">Access to a member that a class inherits is controlled by a combination of the access specifier for that member in the base class, and the access specifier in the derivation list of the derived class. As an example, consider the following hierarchy:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Base {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;void pub_mem();&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">public</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">member</span></span></span><br class="calibre6"/>protected:<br class="calibre6"/>&#160;&#160;&#160;&#160;int prot_mem;&#160;&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">protected</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">member</span></span></span><br class="calibre6"/>private:<br class="calibre6"/>&#160;&#160;&#160;&#160;char priv_mem;&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">member</span></span></span><br class="calibre6"/>};<br class="calibre6"/>struct Pub_Derv : public Base {<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: derived classes can access</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">protected</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">members</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;int f() { return prot_mem; }<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">members are inaccessible to derived classes</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;char g() { return priv_mem; }<br class="calibre6"/>};<br class="calibre6"/>struct Priv_Derv : private Base {<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">derivation doesn't affect access in the derived class</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;int f1() const { return prot_mem; }<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The derivation access specifier has no effect on whether members (and friends) of a derived class may access the members of its own direct base class. Access to the <a id="filepos3911394"/>members of a base class is controlled by the access specifiers in the base class itself. Both <code class="calibre23"><tt class="calibre23"><span class="calibre24">Pub_Derv</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">Priv_Derv</span></tt></code> may access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> member <code class="calibre23"><tt class="calibre23"><span class="calibre24">prot_mem</span></tt></code>. Neither may access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> member <code class="calibre23"><tt class="calibre23"><span class="calibre24">priv_mem</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The purpose of the derivation access specifier is to control the access that <em class="calibre16">users</em> of the derived class&#8212;including other classes derived from the derived class&#8212;have to the members inherited from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Pub_Derv d1;&#160;&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">members inherited from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">are</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">public</span></span></tt></span><br class="calibre6"/>Priv_Derv d2;&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">members inherited from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">are</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span><br class="calibre6"/>d1.pub_mem();&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">pub_mem</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">public</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">in the derived class</span></span></span><br class="calibre6"/>d2.pub_mem();&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">pub_mem</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">in the derived class</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Both <code class="calibre23"><tt class="calibre23"><span class="calibre24">Pub_Derv</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">Priv_Derv</span></tt></code> inherit the <code class="calibre23"><tt class="calibre23"><span class="calibre24">pub_mem</span></tt></code> function. When the inheritance is <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>, members retain their access specification. Thus, <code class="calibre23"><tt class="calibre23"><span class="calibre24">d1</span></tt></code> can call <code class="calibre23"><tt class="calibre23"><span class="calibre24">pub_mem</span></tt></code>. In <code class="calibre23"><tt class="calibre23"><span class="calibre24">Priv_Derv</span></tt></code>, the members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code> are <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>; users of that class may not call <code class="calibre23"><tt class="calibre23"><span class="calibre24">pub_mem</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The derivation access specifier used by a derived class also controls access from classes that inherit from that derived class:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">struct Derived_from_Public : public Pub_Derv {<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base::prot_mem</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">remains</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">protected</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Pub_Derv</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;int use_base() { return prot_mem; }<br class="calibre6"/>};<br class="calibre6"/>struct Derived_from_Private : public Priv_Derv {<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base::prot_mem</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Priv_Derv</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;int use_base() { return prot_mem; }<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Classes derived from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Pub_Derv</span></tt></code> may access <code class="calibre23"><tt class="calibre23"><span class="calibre24">prot_mem</span></tt></code> from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code> because that member remains a <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> member in <code class="calibre23"><tt class="calibre23"><span class="calibre24">Pub_Derv</span></tt></code>. In contrast, classes derived from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Priv_Derv</span></tt></code> have no such access. To them, all the members that <code class="calibre23"><tt class="calibre23"><span class="calibre24">Priv_Derv</span></tt></code> inherited from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code> are <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Had we defined another class, say, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Prot_Derv</span></tt></code>, that used <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> inheritance, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code> would be <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members in that class. Users of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Prot_Derv</span></tt></code> would have no access to <code class="calibre23"><tt class="calibre23"><span class="calibre24">pub_mem</span></tt></code>, but the members and friends of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Prot_Derv</span></tt></code> could access that inherited member.</p><div class="calibre22">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Accessibility of Derived-to-Base Conversion</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00011.jpg" class="calibre9"/></div>
<p class="calibre14">Whether the derived-to-base conversion (&#167; <a href="143-15.2._defining_base_and_derived_classes.html#filepos3806030">15.2.2</a>, p. <a href="143-15.2._defining_base_and_derived_classes.html#filepos3806030">597</a>) is accessible depends on which code is trying to use the conversion and may depend on the access specifier used in the derived class&#8217; derivation. Assuming <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> inherits from <code class="calibre23"><tt class="calibre23"><span class="calibre24">B</span></tt></code>:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; User code may use the derived-to-base conversion <em class="calibre16">only</em> if <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> inherits publicly from <code class="calibre23"><tt class="calibre23"><span class="calibre24">B</span></tt></code>. User code may not use the conversion if <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> inherits from <code class="calibre23"><tt class="calibre23"><span class="calibre24">B</span></tt></code> using either <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Member functions and friends of <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> can use the conversion to <code class="calibre23"><tt class="calibre23"><span class="calibre24">B</span></tt></code> regardless of how <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> inherits from <code class="calibre23"><tt class="calibre23"><span class="calibre24">B</span></tt></code>. The derived-to-base conversion to a direct base class is always accessible to members and friends of a derived class.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27"><a id="filepos3920440"/>&#8226; Member functions and friends of classes derived from <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> may use the derived-to-base conversion if <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> inherits from <code class="calibre23"><tt class="calibre23"><span class="calibre24">B</span></tt></code> using either <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code>. Such code may not use the conversion if <code class="calibre23"><tt class="calibre23"><span class="calibre24">D</span></tt></code> inherits privately from <code class="calibre23"><tt class="calibre23"><span class="calibre24">B</span></tt></code>.</p></blockquote><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00018.jpg" class="calibre9"/> Tip</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">For any given point in your code, if a <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> member of the base class would be accessible, then the derived-to-base conversion is also accessible, and not otherwise.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre35"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre14"><span class="calibre5"><a/>Key Concept: Class Design and <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> Members</span></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">In the absence of inheritance, we can think of a class as having two different kinds of users: ordinary users and implementors. Ordinary users write code that uses objects of the class type; such code can access only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> (interface) members of the class. Implementors write the code contained in the members and friends of the class. The members and friends of the class can access both the <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> (implementation) sections.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">Under inheritance, there is a third kind of user, namely, derived classes. A base class makes <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> those parts of its implementation that it is willing to let its derived classes use. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members remain inaccessible to ordinary user code; <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> members remain inaccessible to derived classes and their friends.</p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">Like any other class, a class that is used as a base class makes its interface members <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> . A class that is used as a base class may divide its implementation into those members that are accessible to derived classes and those that remain accessible only to the base class and its friends. An implementation member should be <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> if it provides an operation or data that a derived class will need to use in its own implementation. Otherwise, implementation members should be <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Friendship and Inheritance</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">Just as friendship is not transitive (&#167;<a href="075-7.3._additional_class_features.html#filepos1906774">7.3.4</a>, p. <a href="075-7.3._additional_class_features.html#filepos1906774">279</a>), friendship is also not inherited. Friends of the base have no special access to members of its derived classes, and friends of a derived class have no special access to the base class:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Base {<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">added</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">friend</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">declaration; other members as before</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;friend class Pal; // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Pal</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has no access to classes derived from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base</span></span></tt></span><br class="calibre6"/>};<br class="calibre6"/>class Pal {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;int f(Base b) { return b.prot_mem; } // <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Pal</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is a friend of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;int f2(Sneaky s) { return s.j; } // <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Pal</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">not friend of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Sneaky</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">access to a base class is controlled by the base class, even inside a derived object</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;int f3(Sneaky s) { return s.prot_mem; } // <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Pal</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is a friend</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The fact that <code class="calibre23"><tt class="calibre23"><span class="calibre24">f3</span></tt></code> is legal may seem surprising, but it follows directly from the notion that each class controls access to its own members. <code class="calibre23"><tt class="calibre23"><span class="calibre24">Pal</span></tt></code> is a friend of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code>, so <a id="filepos3927120"/><code class="calibre23"><tt class="calibre23"><span class="calibre24">Pal</span></tt></code> can access the members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code> objects. That access includes access to <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code> objects that are embedded in an object of a type derived from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Base</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">When a class makes another class a friend, it is only that class to which friendship is granted. The base classes of, and classes derived from, the friend have no special access to the befriending class:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">D2</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has no access to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">protected</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">or</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">members in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Base</span></span></tt></span><br class="calibre6"/>class D2 : public Pal {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;int mem(Base b)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;{ return b.prot_mem; } // <span><span class="calibre45"><span class="calibre16">error: friendship doesn't inherit</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Friendship is not inherited; each class controls access to its members.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Exempting Individual Members</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">Sometimes we need to change the access level of a name that a derived class inherits. We can do so by providing a <code class="calibre23"><tt class="calibre23"><span class="calibre24">using</span></tt></code> declaration (&#167;<a href="030-3.1._namespace_using_declarations.html#filepos638596">3.1</a>, p. <a href="030-3.1._namespace_using_declarations.html#filepos638596">82</a>):</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Base {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::size_t size() const { return n; }<br class="calibre6"/>protected:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::size_t n;<br class="calibre6"/>};<br class="calibre6"/>class Derived : private Base {&#160;&#160;&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">note:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">inheritance</span></span></span><br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">maintain access levels for members related to the size of the object</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;using Base::size;<br class="calibre6"/>protected:<br class="calibre6"/>&#160;&#160;&#160;&#160;using Base::n;<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">Derived</span></tt></code> uses <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> inheritance, the inherited members, <code class="calibre23"><tt class="calibre23"><span class="calibre24">size</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">n</span></tt></code>, are (by default) <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Derived</span></tt></code>. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">using</span></tt></code> declarations adjust the accessibility of these members. Users of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Derived</span></tt></code> can access the <code class="calibre23"><tt class="calibre23"><span class="calibre24">size</span></tt></code> member, and classes subsequently derived from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Derived</span></tt></code> can access <code class="calibre23"><tt class="calibre23"><span class="calibre24">n</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A <code class="calibre23"><tt class="calibre23"><span class="calibre24">using</span></tt></code> declaration inside a class can name any accessible (e.g., not <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code>) member of a direct or indirect base class. Access to a name specified in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">using</span></tt></code> declaration depends on the access specifier preceding the <code class="calibre23"><tt class="calibre23"><span class="calibre24">using</span></tt></code> declaration. That is, if a <code class="calibre23"><tt class="calibre23"><span class="calibre24">using</span></tt></code> declaration appears in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> part of the class, that name is accessible to members and friends only. If the declaration is in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> section, the name is available to all users of the class. If the declaration is in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> section, the name is accessible to the members, friends, and derived classes.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">A derived class may provide a <code class="calibre23"><tt class="calibre23"><span class="calibre24">using</span></tt></code> declaration only for names it is permitted to access.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 class="calibre37"><span class="calibre5"><a id="filepos3933437"/>Default Inheritance Protection Levels</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">In &#167;<a href="074-7.2._access_control_and_encapsulation.html#filepos1833387">7.2</a> (p. <a href="074-7.2._access_control_and_encapsulation.html#filepos1833387">268</a>) we saw that classes defined with the <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code> keywords have different default access specifiers. Similarly, the default derivation specifier depends on which keyword is used to define a derived class. By default, a derived class defined with the <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code> keyword has <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> inheritance; a derived class defined with <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> has <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> inheritance:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class Base { /* <span><span class="calibre45"><span class="calibre16">...</span></span></span>&#160;&#160;&#160;*/ };<br class="calibre6"/>struct D1 : Base { /* <span><span class="calibre45"><span class="calibre16">...</span></span></span>&#160;&#160;&#160;*/ };&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">public</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">inheritance by default</span></span></span><br class="calibre6"/>class D2 : Base { /* <span><span class="calibre45"><span class="calibre16">...</span></span></span>&#160;&#160;&#160;*/ };&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">private</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">inheritance by default</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">It is a common misconception to think that there are deeper differences between classes defined using the <code class="calibre23"><tt class="calibre23"><span class="calibre24">struct</span></tt></code> keyword and those defined using <code class="calibre23"><tt class="calibre23"><span class="calibre24">class</span></tt></code>. The only differences are the default access specifier for members and the default derivation access specifier. There are no other distinctions.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">A privately derived class should specify <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> explicitly rather than rely on the default. Being explicit makes it clear that private inheritance is intended and not an oversight.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 15.5</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.18:</strong> Given the classes from page <a href="146-15.5._access_control_and_inheritance.html#filepos3904215">612</a> and page <a href="146-15.5._access_control_and_inheritance.html#filepos3911394">613</a>, and assuming each object has the type specified in the comments, determine which of these assignments are legal. Explain why those that are illegal aren&#8217;t allowed:</p></blockquote><div class="calibre10">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">Base *p = &amp;d1;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">d1</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Pub_Derv</span></span></tt></span><br class="calibre6"/>p = &amp;d2;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">d2</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Priv_Derv</span></span></tt></span><br class="calibre6"/>p = &amp;d3;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">d3</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Prot_Derv</span></span></tt></span><br class="calibre6"/>p = &amp;dd1;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">dd1</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Derived_from_Public</span></span></tt></span><br class="calibre6"/>p = &amp;dd2;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">dd2</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Derived_from_Private</span></span></tt></span><br class="calibre6"/>p = &amp;dd3;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//&#160;&#160;<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">dd3</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Derived_from_Protected</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.19:</strong> Assume that each of the classes from page <a href="146-15.5._access_control_and_inheritance.html#filepos3904215">612</a> and page <a href="146-15.5._access_control_and_inheritance.html#filepos3911394">613</a> has a member function of the form:</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">void memfcn(Base &amp;b) { b = *this; }</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">For each class, determine whether this function would be legal.</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.20:</strong> Write code to test your answers to the previous two exercises.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.21:</strong> Choose one of the following general abstractions containing a family of types (or choose one of your own). Organize the types into an inheritance hierarchy:</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre26"><p class="calibre53"><strong class="calibre5">(a)</strong> Graphical file formats (such as gif, tiff, jpeg, bmp)</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre53"><strong class="calibre5">(b)</strong> Geometric primitives (such as box, circle, sphere, cone)</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre53"><strong class="calibre5">(c)</strong> C++ language types (such as class, function, member function)</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.22:</strong> For the class you chose in the previous exercise, identify some of the likely virtual functions as well as <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">protected</span></tt></code> members.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="145-15.4._abstract_base_classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="147-15.6._class_scope_under_inheritance.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
