<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>8.2. File Input and Output</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="083-8.1._the_io_classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="085-8.3._string_streams.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos2111869" class="calibre29"><span class="bold">8.2. File Input and Output</span></h3><div class="calibre12">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> header defines three types to support file IO: <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos2112267" href="087-defined_terms.html#filepos2167775">ifstream</a></span></span></tt></span></span></tt></code> to read from a given file, <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos2112476" href="087-defined_terms.html#filepos2169249">ofstream</a></span></span></tt></span></span></tt></code> to write to a given file, and <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5"><a id="filepos2112688" href="087-defined_terms.html#filepos2167308">fstream</a></span></span></tt></span></span></tt></code>, which reads and writes a given file. In &#167; <a href="167-17.5._the_io_library_revisited.html#filepos4809250">17.5.3</a> (p. <a href="167-17.5._the_io_library_revisited.html#filepos4809250">763</a>) we&#8217;ll describe how to use the same file for both input and output.</p><div class="calibre15">&#160;</div>
<p class="calibre25">These types provide the same operations as those we have previously used on the objects <code class="calibre23"><tt class="calibre23"><span class="calibre24">cin</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">cout</span></tt></code>. In particular, we can use the IO operators <code class="calibre23"><tt class="calibre23"><span class="calibre24">(&lt;&lt;</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;)</span></tt></code> to read and write files, we can use <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> (&#167; <a href="031-3.2._library_string_type.html#filepos659212">3.2.2</a>, p. <a href="031-3.2._library_string_type.html#filepos659212">87</a>) to read an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code>, and the material covered in &#167; <a href="083-8.1._the_io_classes.html#filepos2076693">8.1</a> (p. <a href="083-8.1._the_io_classes.html#filepos2076693">310</a>) applies to these types.</p><div class="calibre22">&#160;</div>
<p class="calibre25">In addition to the behavior that they inherit from the <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code> types, the types defined in <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> add members to manage the file associated with the stream. These operations, listed in <a href="084-8.2._file_input_and_output.html#filepos2114621">Table 8.3</a>, can be called on objects of <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code>, or <code class="calibre23"><tt class="calibre23"><span class="calibre24">ofstream</span></tt></code> but not on the other IO types.</p><div class="calibre22">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos2114621"/>Table 8.3. <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">fstream</span></span></tt></span></span></tt></code>-Specific Operations</span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00043.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<h4 id="filepos2114912" class="calibre37"><span class="calibre5"><a id="filepos2114945"/>8.2.1. Using File Stream Objects</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">When we want to read or write a file, we define a file stream object and associate that object with the file. Each file stream class defines a member function named <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> that does whatever system-specific operations are required to locate the given file and open it for reading or writing as appropriate.</p><div class="calibre15">&#160;</div>
<p class="calibre25">When we create a file stream, we can (optionally) provide a file name. When we supply a file name, <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> is called automatically:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">ifstream in(ifile); // <span><span class="calibre45"><span class="calibre16">construct an</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">ifstream</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and open the given file</span></span></span><br class="calibre6"/>ofstream out;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">output file stream that is not associated with any file</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This code defines <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code> as an input stream that is initialized to read from the file named by the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> argument <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifile</span></tt></code>. It defines <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> as an output stream that is not yet associated with a file. With the new standard, file names can be either library <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s or C-style character arrays (&#167; <a href="034-3.5._arrays.html#filepos918393">3.5.4</a>, p. <a href="034-3.5._arrays.html#filepos918393">122</a>). Previous versions of the library allowed only C-style character arrays.</p><div class="calibre15">&#160;</div>
<div class="calibre28"><a id="filepos2117328"/><img alt="Image" src="images/00008.jpg" class="calibre9"/></div>
<h5 class="calibre39"><span class="calibre5">Using an <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">fstream</span></span></tt></span></span></tt></code> in Place of an <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">iostream&amp;</span></span></tt></span></span></tt></code></span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">As we noted in &#167; <a href="083-8.1._the_io_classes.html#filepos2076693">8.1</a> (p. <a href="083-8.1._the_io_classes.html#filepos2076693">311</a>), we can use an object of an inherited type in places where an object of the original type is expected. This fact means that functions that are written to take a reference (or pointer) to one of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code> types can be called on behalf of the corresponding <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> (or <code class="calibre23"><tt class="calibre23"><span class="calibre24">sstream</span></tt></code>) type. That is, if we have a function that takes an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream&amp;</span></tt></code>, we can call that function passing it an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ofstream</span></tt></code> object, and similarly for <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream&amp;</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">For example, we can use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> functions from &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">7.1.3</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1792181">261</a>) to read from and write to named files. In this example, we&#8217;ll assume that the names of the input and output files are passed as arguments to <code class="calibre23"><tt class="calibre23"><span class="calibre24">main</span></tt></code> (&#167; <a href="064-6.2._argument_passing.html#filepos1526324">6.2.5</a>, p. <a href="064-6.2._argument_passing.html#filepos1526324">218</a>):</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">ifstream input(argv[1]);&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">open the file of sales transactions</span></span></span><br class="calibre6"/>ofstream output(argv[2]);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">open the output file</span></span></span><br class="calibre6"/>Sales_data total;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">variable to hold the running sum</span></span></span><br class="calibre6"/>if (read(input, total)) {&#160;&#160;// <span><span class="calibre45"><span class="calibre16">read the first transaction</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;Sales_data trans;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">variable to hold data for the next transaction</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;while(read(input, trans)) {&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">read the remaining transactions</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (total.isbn() == trans.isbn()) //&#160;&#160;<span><span class="calibre45"><span class="calibre16">check</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">isbn</span></span></tt></span><span><span class="calibre45"><span class="calibre16">s</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;total.combine(trans);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">update the running</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">total</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print(output, total) &lt;&lt; endl;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">print the results</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;total = trans;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">process the next book</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;print(output, total) &lt;&lt; endl;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print the last transaction</span></span></span><br class="calibre6"/>} else&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">there was no input</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;cerr &lt;&lt; "No data?!" &lt;&lt; endl;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Aside from using named files, this code is nearly identical to the version of the addition program on page <a href="073-7.1._defining_abstract_data_types.html#filepos1750685">255</a>. The important part is the calls to <code class="calibre23"><tt class="calibre23"><span class="calibre24">read</span></tt></code> and to <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code>. We can pass our <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> objects to these functions even though the parameters to those functions are defined as <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream&amp;</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream&amp;</span></tt></code>, respectively.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos2123081"/>The <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">open</span></span></tt></span></span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">close</span></span></tt></span></span></tt></code> Members</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">When we define an empty file stream object, we can subsequently associate that object with a file by calling <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code>:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">ifstream in(ifile); // <span><span class="calibre45"><span class="calibre16">construct an</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">ifstreamand</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">open the given file</span></span></span><br class="calibre6"/>ofstream out;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">output file stream that is not associated with any file</span></span></span><br class="calibre6"/>out.open(ifile + ".copy");&#160;&#160;// <span><span class="calibre45"><span class="calibre16">open the specified file</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">If a call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> fails, <code class="calibre23"><tt class="calibre23"><span class="calibre24">failbit</span></tt></code> is set (&#167; <a href="083-8.1._the_io_classes.html#filepos2085669">8.1.2</a>, p. <a href="083-8.1._the_io_classes.html#filepos2085669">312</a>). Because a call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> might fail, it is usually a good idea to verify that the <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> succeeded:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">if (out)&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">check that the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">open</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">succeeded</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">open</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">succeeded, so we can use the file</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This condition is similar to those we&#8217;ve used on <code class="calibre23"><tt class="calibre23"><span class="calibre24">cin</span></tt></code>. If the <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> fails, this condition will fail and we will not attempt to use <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Once a file stream has been opened, it remains associated with the specified file. Indeed, calling <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> on a file stream that is already open will fail and set <code class="calibre23"><tt class="calibre23"><span class="calibre24">failbit</span></tt></code>. Subsequent attempts to use that file stream will fail. To associate a file stream with a different file, we must first close the existing file. Once the file is closed, we can open a new one:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">in.close();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">close the file</span></span></span><br class="calibre6"/>in.open(ifile + "2");&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">open another file</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">If the <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> succeeds, then <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> sets the stream&#8217;s state so that <code class="calibre23"><tt class="calibre23"><span class="calibre24">good()</span></tt></code> is <code class="calibre23"><tt class="calibre23"><span class="calibre24">true</span></tt></code>.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Automatic Construction and Destruction</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Consider a program whose <code class="calibre23"><tt class="calibre23"><span class="calibre24">main</span></tt></code> function takes a list of files it should process (&#167; <a href="064-6.2._argument_passing.html#filepos1526324">6.2.5</a>, p. <a href="064-6.2._argument_passing.html#filepos1526324">218</a>). Such a program might have a loop like the following:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">for each file passed to the program</span></span></span><br class="calibre6"/>for (auto p = argv + 1; p != argv + argc; ++p) {<br class="calibre6"/>&#160;&#160;&#160;&#160;ifstream input(*p);&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">create</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">input</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and open the file</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;if (input) {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">if the file is ok, ''process'' this file</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;process(input);<br class="calibre6"/>&#160;&#160;&#160;&#160;} else<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cerr &lt;&lt; "couldn't open: " + string(*p);<br class="calibre6"/>} // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">input</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">goes out of scope and is destroyed on each iteration</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Each iteration constructs a new <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code> object named <code class="calibre23"><tt class="calibre23"><span class="calibre24">input</span></tt></code> and opens it to read the given file. As usual, we check that the <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> succeeded. If so, we pass that file to a function that will read and process the input. If not, we print an error message and continue.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">input</span></tt></code> is local to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code>, it is created and destroyed on each iteration (&#167; <a href="057-5.4._iterative_statements.html#filepos1308478">5.4.1</a>, p. <a href="057-5.4._iterative_statements.html#filepos1308478">183</a>). When an <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> object goes out of scope, the file it is bound to is automatically closed. On the next iteration, <code class="calibre23"><tt class="calibre23"><span class="calibre24">input</span></tt></code> is created anew.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">When an <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> object is destroyed, <code class="calibre23"><tt class="calibre23"><span class="calibre24">close</span></tt></code> is called automatically.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><a id="filepos2131282"/><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 8.2.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.4:</strong> Write a function to open a file for input and read its contents into a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s, storing each line as a separate element in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.5:</strong> Rewrite the previous program to store each word in a separate element.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.6:</strong> Rewrite the bookstore program from &#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1746914">7.1.1</a> (p. <a href="073-7.1._defining_abstract_data_types.html#filepos1746914">256</a>) to read its transactions from a file. Pass the name of the file as an argument to <code class="calibre23"><tt class="calibre23"><span class="calibre24">main</span></tt></code> (&#167; <a href="064-6.2._argument_passing.html#filepos1526324">6.2.5</a>, p. <a href="064-6.2._argument_passing.html#filepos1526324">218</a>).</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos2132593" class="calibre37"><span class="calibre5">8.2.2. File Modes</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">Each stream has an associated <strong class="calibre5"><a id="filepos2132810" href="087-defined_terms.html#filepos2165996">file mode</a></strong> that represents how the file may be used. <a href="084-8.2._file_input_and_output.html#filepos2133063">Table 8.4</a> lists the file modes and their meanings.</p><div class="calibre15">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos2133063"/>Table 8.4. File Modes</span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00044.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<p class="calibre25">We can supply a file mode whenever we open a file&#8212;either when we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> or when we indirectly open the file when we initialize a stream from a file name. The modes that we can specify have the following restrictions:</p><div class="calibre22">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> may be set only for an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ofstream</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> object.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code> may be set only for an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> object.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">trunc</span></tt></code> may be set only when <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> is also specified.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">app</span></tt></code> mode may be specified so long as <code class="calibre23"><tt class="calibre23"><span class="calibre24">trunc</span></tt></code> is not. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">app</span></tt></code> is specified, the file is always opened in output mode, even if <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> was not explicitly specified.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; By default, a file opened in <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> mode is truncated even if we do not specify <code class="calibre23"><tt class="calibre23"><span class="calibre24">trunc</span></tt></code>. To preserve the contents of a file opened with <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code>, either we must also specify <code class="calibre23"><tt class="calibre23"><span class="calibre24">app</span></tt></code>, in which case we can write only at the end of the file, or we must also specify <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code>, in which case the file is open for both input and output (&#167; <a href="167-17.5._the_io_library_revisited.html#filepos4809250">17.5.3</a> (p. <a href="167-17.5._the_io_library_revisited.html#filepos4809250">763</a>) will cover using the same file for input and output).</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; The <code class="calibre23"><tt class="calibre23"><span class="calibre24">ate</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">binary</span></tt></code> modes may be specified on any file stream object type and in combination with any other file modes.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">Each file stream type defines a default file mode that is used whenever we do not otherwise specify a mode. Files associated with an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code> are opened in <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code> mode; files associated with an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ofstream</span></tt></code> are opened in <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> mode; and files associated with an <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> are opened with both <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> modes.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos2137060"/>Opening a File in <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">out</span></span></tt></span></span></tt></code> Mode Discards Existing Data</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">By default, when we open an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ofstream</span></tt></code>, the contents of the file are discarded. The only way to prevent an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> from emptying the given file is to specify <code class="calibre23"><tt class="calibre23"><span class="calibre24">app</span></tt></code>:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">file1</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is truncated in each of these cases</span></span></span><br class="calibre6"/>ofstream out("file1");&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">out</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">trunc</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">are implicit</span></span></span><br class="calibre6"/>ofstream out2("file1", ofstream::out);&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">trunc</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is implicit</span></span></span><br class="calibre6"/>ofstream out3("file1", ofstream::out | ofstream::trunc);<br class="calibre6"/><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">to preserve the file's contents, we must explicitly specify</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">app</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">mode</span></span></span><br class="calibre6"/>ofstream app("file2", ofstream::app);&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">out</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is implicit</span></span></span><br class="calibre6"/>ofstream app2("file2", ofstream::out | ofstream::app);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The only way to preserve the existing data in a file opened by an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ofstream</span></tt></code> is to specify <code class="calibre23"><tt class="calibre23"><span class="calibre24">app</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code> mode explicitly.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">File Mode Is Determined Each Time <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">open</span></span></tt></span></span></tt></code> Is Called</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The file mode of a given stream may change each time a file is opened.</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">ofstream out;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">no file mode is set</span></span></span><br class="calibre6"/>out.open("scratchpad"); // <span><span class="calibre45"><span class="calibre16">mode implicitly</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">out</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">trunc</span></span></tt></span><br class="calibre6"/>out.close();&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">close</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">out</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">so we can use it for a different file</span></span></span><br class="calibre6"/>out.open("precious", ofstream::app);&#160;&#160;// <span><span class="calibre45"><span class="calibre16">mode is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">out</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">app</span></span></tt></span><br class="calibre6"/>out.close();</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The first call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> does not specify an output mode explicitly; this file is implicitly opened in <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> mode. As usual, <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code> implies <code class="calibre23"><tt class="calibre23"><span class="calibre24">trunc</span></tt></code>. Therefore, the file named <code class="calibre23"><tt class="calibre23"><span class="calibre24">scratchpad</span></tt></code> in the current directory will be truncated. When we open the file named <code class="calibre23"><tt class="calibre23"><span class="calibre24">precious</span></tt></code>, we ask for append mode. Any data in the file remains, and all writes are done at the end of the file.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Any time <code class="calibre23"><tt class="calibre23"><span class="calibre24">open</span></tt></code> is called, the file mode is set, either explicitly or implicitly. Whenever a mode is not specified, the default value is used.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 8.2.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.7:</strong> Revise the bookstore program from the previous section to write its output to a file. Pass the name of that file as a second argument to <code class="calibre23"><tt class="calibre23"><span class="calibre24">main</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 8.8:</strong> Revise the program from the previous exercise to append its output to its given file. Run the program on the same output file at least twice to ensure that the data are preserved.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="083-8.1._the_io_classes.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="085-8.3._string_streams.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
