<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>12.3. Using the Library: A Text-Query Program</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="115-12.2._dynamic_arrays.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="117-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos3140586" class="calibre29"><span class="bold">12.3. Using the Library: A Text-Query Program</span></h3><div class="calibre12">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">To conclude our discussion of the library, we&#8217;ll implement a simple text-query program. Our program will let a user search a given file for words that might occur in it. The result of a query will be the number of times the word occurs and a list of lines on which that word appears. If a word occurs more than once on the same line, we&#8217;ll display that line only once. Lines will be displayed in ascending order&#8212;that is, line 7 should be displayed before line 9, and so on.</p><div class="calibre15">&#160;</div>
<p class="calibre25">For example, we might read the file that contains the input for this chapter and look for the word <code class="calibre23"><tt class="calibre23"><span class="calibre24">element</span></tt></code>. The first few lines of the output would be</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">element occurs 112 times</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;<span><tt class="calibre23"><span class="calibre32"><span class="calibre5">(line 36) A set element contains only a key;</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;<span><tt class="calibre23"><span class="calibre32"><span class="calibre5">(line 158) operator creates a new element</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;<span><tt class="calibre23"><span class="calibre32"><span class="calibre5">(line 160) Regardless of whether the element</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;<span><tt class="calibre23"><span class="calibre32"><span class="calibre5">(line 168) When we fetch an element from a map, we</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;<span><tt class="calibre23"><span class="calibre32"><span class="calibre5">(line 214) If the element is not found, find returns</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">followed by the remaining 100 or so lines in which the word <code class="calibre23"><tt class="calibre23"><span class="calibre24">element</span></tt></code> occurs.</p><div class="calibre15">&#160;</div>
<h4 id="filepos3142846" class="calibre37"><span class="calibre5"><a id="filepos3142879"/>12.3.1. Design of the Query Program</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">A good way to start the design of a program is to list the program&#8217;s operations. Knowing what operations we need can help us see what data structures we&#8217;ll need. Starting from requirements, the tasks our program must do include the following:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; When it reads the input, the program must remember the line(s) in which each word appears. Hence, the program will need to read the input a line at a time and break up the lines from the input file into its separate words</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; When it generates output,</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre58">&#8211; The program must be able to fetch the line numbers associated with a given word</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre58">&#8211; The line numbers must appear in ascending order with no duplicates</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre58">&#8211; The program must be able to print the text appearing in the input file at a given line number.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">These requirements can be met quite neatly by using various library facilities:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; We&#8217;ll use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector&lt;string&gt;</span></tt></code> to store a copy of the entire input file. Each line in the input file will be an element in this <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>. When we want to print a line, we can fetch the line using its line number as the index.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; We&#8217;ll use an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> (&#167; <a href="085-8.3._string_streams.html#filepos2143868">8.3</a>, p. <a href="085-8.3._string_streams.html#filepos2143868">321</a>) to break each line into words.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; We&#8217;ll use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> to hold the line numbers on which each word in the input appears. Using a <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> guarantees that each line will appear only once and that the line numbers will be stored in ascending order.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; We&#8217;ll use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> to associate each word with the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers on which the word appears. Using a <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> will let us fetch the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> for any given word.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">For reasons we&#8217;ll explain shortly, our solution will also use <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code>s.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Data Structures</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Although we could write our program using <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector, set</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> directly, it will be more useful if we define a more abstract solution. We&#8217;ll start by designing a class to hold the input file in a way that makes querying the file easy. This class, which we&#8217;ll name <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code>, will hold a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code>. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> will hold the text of the input file; the <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> will associate each word in that file to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers on which that word appears. This class will have a constructor that reads a given input file and an operation to perform the queries.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The work of the query operation is pretty simple: It will look inside its <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> to see whether the given word is present. The hard part in designing this function is deciding what the query function should return. Once we know that a word was found, we need to know how often it occurred, the line numbers on which it occurred, and the corresponding text for each of those line numbers.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The easiest way to return all those data is to define a second class, which we&#8217;ll name <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code>, to hold the results of a query. This class will have a <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> function to print the results in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code>.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos3148595"/>Sharing Data between Classes</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Our <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> class is intended to represent the results of a query. Those results include the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers associated with the given word and the corresponding lines of text from the input file. These data are stored in objects of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Because the data that a <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> needs are stored in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> object, we have to decide how to access them. We could copy the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers, but that might be an expensive operation. Moreover, we certainly wouldn&#8217;t want to copy the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>, because that would entail copying the entire file in order to print (what will usually be) a small subset of the file.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We could avoid making copies by returning iterators (or pointers) into the <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> object. However, this approach opens up a pitfall: What happens if the <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> object is destroyed before a corresponding <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code>? In that case, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> would refer to data in an object that no longer exists.</p><div class="calibre22">&#160;</div>
<p class="calibre25">This last observation about synchronizing the lifetime of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> with the <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> object whose results it represents suggests a solution to our design problem. Given that these two classes conceptually &#8220;share&#8221; data, we&#8217;ll use <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code>s (&#167; <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos2907541">12.1.1</a>, p. <a href="114-12.1._dynamic_memory_and_smart_pointers.html#filepos2907541">450</a>) to reflect that sharing in our data structures.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Using the <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">TextQuery</span></span></tt></span></span></tt></code> Class</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">When we design a class, it can be helpful to write programs using the class before actually implementing the members. That way, we can see whether the class has the operations we need. For example, the following program uses our proposed <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> classes. This function takes an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code> that points to the file we want to process, and interacts with a user, printing the results for the given words:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">void runQueries(ifstream &amp;infile)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">infile</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is an</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">ifstream</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">that is the file we want to query</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;TextQuery tq(infile);&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">store the file and build the query map</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">iterate with the user: prompt for a word to find and print results</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;while (true) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cout &lt;&lt; "enter word to look for, or q to quit: ";<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string s;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">stop if we hit end-of-file on the input or if a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">'q'</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is entered</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (!(cin &gt;&gt; s) || s == "q") break;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">run the query and print the results</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print(cout, tq.query(s)) &lt;&lt; endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">We start by initializing a <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> object named <code class="calibre23"><tt class="calibre23"><span class="calibre24">tq</span></tt></code> from a given <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code>. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> constructor reads that file into its <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> and builds the <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> that associates the words in the input with the line numbers on which they appear.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> loop iterates (indefinitely) with the user asking for a word to query and printing the related results. The loop condition tests the literal <code class="calibre23"><tt class="calibre23"><span class="calibre24">true</span></tt></code> (&#167; <a href="021-2.1._primitive_builtin_types.html#filepos326709">2.1.3</a>, p. <a href="021-2.1._primitive_builtin_types.html#filepos326709">41</a>), so it always succeeds. We exit the loop through the <code class="calibre23"><tt class="calibre23"><span class="calibre24">break</span></tt></code> (&#167; <a href="058-5.5._jump_statements.html#filepos1351310">5.5.1</a>, p. <a href="058-5.5._jump_statements.html#filepos1351310">190</a>) <a id="filepos3155219"/>after the first <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code>. That <code class="calibre23"><tt class="calibre23"><span class="calibre24">if</span></tt></code> checks that the read succeeded. If so, it also checks whether the user entered a <code class="calibre23"><tt class="calibre23"><span class="calibre24">q</span></tt></code> to quit. Once we have a word to look for, we ask <code class="calibre23"><tt class="calibre23"><span class="calibre24">tq</span></tt></code> to find that word and then call <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> to print the results of the search.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 12.3.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 12.27:</strong> The <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> classes use only capabilities that we have already covered. Without looking ahead, write your own versions of these classes.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 12.28:</strong> Write a program to implement text queries without defining classes to manage the data. Your program should take a file and interact with a user to query for words in that file. Use <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> containers to hold the data for the file and to generate the results for the queries.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 12.29:</strong> We could have written the loop to manage the interaction with the user as a <code class="calibre23"><tt class="calibre23"><span class="calibre24">do while</span></tt></code> (&#167; <a href="057-5.4._iterative_statements.html#filepos1343100">5.4.4</a>, p. <a href="057-5.4._iterative_statements.html#filepos1343100">189</a>) loop. Rewrite the loop to use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">do while</span></tt></code>. Explain which version you prefer and why.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos3157528" class="calibre37"><span class="calibre5">12.3.2. Defining the Query Program Classes</span></h4><div class="calibre38">&#160;</div>
<div class="calibre28"><img alt="Image" src="images/00009.jpg" class="calibre9"/></div>
<p class="calibre14">We&#8217;ll start by defining our <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> class. The user will create objects of this class by supplying an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> from which to read the input file. This class also provides the <code class="calibre23"><tt class="calibre23"><span class="calibre24">query</span></tt></code> operation that will take a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> and return a <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> representing the lines on which that <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> appears.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The data members of the class have to take into account the intended sharing with <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> objects. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> class will share the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> representing the input file and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code>s that hold the line numbers associated with each word in the input. Hence, our class has two data members: a <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code> to a dynamically allocated <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> that holds the input file, and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> from <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr&lt;set&gt;</span></tt></code>. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> associates each word in the file with a dynamically allocated <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> that holds the line numbers on which that word appears.</p><div class="calibre22">&#160;</div>
<p class="calibre25">To make our code a bit easier to read, we&#8217;ll also define a type member (&#167; <a href="075-7.3._additional_class_features.html#filepos1852806">7.3.1</a>, p. <a href="075-7.3._additional_class_features.html#filepos1852806">271</a>) to refer to line numbers, which are indices into a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> of <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>s:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class QueryResult; // <span><span class="calibre45"><span class="calibre16">declaration needed for return type in the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">query</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">function</span></span></span><br class="calibre6"/>class TextQuery {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;using line_no = std::vector&lt;std::string&gt;::size_type;<br class="calibre6"/>&#160;&#160;&#160;&#160;TextQuery(std::ifstream&amp;);<br class="calibre6"/>&#160;&#160;&#160;&#160;QueryResult query(const std::string&amp;) const;<br class="calibre6"/>private:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::shared_ptr&lt;std::vector&lt;std::string&gt;&gt; file;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">input file</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">map</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">of each word to the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">set</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">of the lines in which that word appears</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::map&lt;std::string,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::shared_ptr&lt;std::set&lt;line_no&gt;&gt;&gt; wm;<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14"><a id="filepos3161756"/>The hardest part about this class is untangling the class names. As usual, for code that will go in a header file, we use <code class="calibre23"><tt class="calibre23"><span class="calibre24">std::</span></tt></code> when we use a library name (&#167; <a href="030-3.1._namespace_using_declarations.html#filepos638596">3.1</a>, p. <a href="030-3.1._namespace_using_declarations.html#filepos638596">83</a>). In this case, the repeated use of <code class="calibre23"><tt class="calibre23"><span class="calibre24">std::</span></tt></code> makes the code a bit hard to read at first. For example,</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">std::map&lt;std::string, std::shared_ptr&lt;std::set&lt;line_no&gt;&gt;&gt; wm;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">is easier to understand when rewritten as</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">map&lt;string, shared_ptr&lt;set&lt;line_no&gt;&gt;&gt; wm;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">The <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">TextQuery</span></span></tt></span></span></tt></code> Constructor</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> constructor takes an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code>, which it reads a line at a time:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">read the input file and build the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">map</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">of lines to line numbers</span></span></span><br class="calibre6"/>TextQuery::TextQuery(ifstream &amp;is): file(new vector&lt;string&gt;)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;string text;<br class="calibre6"/>&#160;&#160;&#160;&#160;while (getline(is, text)) {&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">for each line in the file</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;file-&gt;push_back(text);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">remember this line of text</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int n = file-&gt;size() - 1;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">the current line number</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;istringstream line(text);&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">separate the line into words</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string word;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;while (line &gt;&gt; word) {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">for each word in that line</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">if</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">word</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">isn't already in wm, subscripting adds a new entry</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;auto &amp;lines = wm[word]; // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">lines</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">a shared_ptr</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (!lines) // <span><span class="calibre45"><span class="calibre16">that pointer is null the first time we see</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">word</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lines.reset(new set&lt;line_no&gt;); // <span><span class="calibre45"><span class="calibre16">allocate a new</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">set</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lines-&gt;insert(n);&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">insert this line number</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The constructor initializer allocates a new <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> to hold the text from the input file. We use <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> to read the file a line at a time and push each line onto the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>. Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">file</span></tt></code> is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code>, we use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">-&gt;</span></tt></code> operator to dereference <code class="calibre23"><tt class="calibre23"><span class="calibre24">file</span></tt></code> to fetch the <code class="calibre23"><tt class="calibre23"><span class="calibre24">push_back</span></tt></code> member of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">file</span></tt></code> points.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Next we use an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> (&#167; <a href="085-8.3._string_streams.html#filepos2143868">8.3</a>, p. <a href="085-8.3._string_streams.html#filepos2143868">321</a>) to process each word in the line we just read. The inner <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> uses the <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> input operator to read each word from the current line into <code class="calibre23"><tt class="calibre23"><span class="calibre24">word</span></tt></code>. Inside the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code>, we use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code> subscript operator to fetch the <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr&lt;set&gt;</span></tt></code> associated with <code class="calibre23"><tt class="calibre23"><span class="calibre24">word</span></tt></code> and bind <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> to that pointer. Note that <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> is a reference, so changes made to <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> will be made to the element in <code class="calibre23"><tt class="calibre23"><span class="calibre24">wm</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">If <code class="calibre23"><tt class="calibre23"><span class="calibre24">word</span></tt></code> wasn&#8217;t in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code>, the subscript operator adds <code class="calibre23"><tt class="calibre23"><span class="calibre24">word</span></tt></code> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">wm</span></tt></code> (&#167; <a href="109-11.3._operations_on_associative_containers.html#filepos2820595">11.3.4</a>, p. <a href="109-11.3._operations_on_associative_containers.html#filepos2820595">435</a>). The element associated with <code class="calibre23"><tt class="calibre23"><span class="calibre24">word</span></tt></code> is value initialized, which means that <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> will be a null pointer if the subscript operator added <code class="calibre23"><tt class="calibre23"><span class="calibre24">word</span></tt></code> to <code class="calibre23"><tt class="calibre23"><span class="calibre24">wm</span></tt></code>. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> is null, we allocate a <code class="calibre23"><tt class="calibre23"><span class="calibre24">new set</span></tt></code> and call <code class="calibre23"><tt class="calibre23"><span class="calibre24">reset</span></tt></code> to update the <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code> to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> refers to point to this newly allocated <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Regardless of whether we created a new <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code>, we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">insert</span></tt></code> to add the current line number. Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> is a reference, the call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">insert</span></tt></code> adds an element <a id="filepos3170995"/>to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> in <code class="calibre23"><tt class="calibre23"><span class="calibre24">wm</span></tt></code>. If a given word occurs more than once in the same line, the call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">insert</span></tt></code> does nothing.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">The <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">QueryResult</span></span></tt></span></span></tt></code> Class</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> class has three data members: a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> that is the word whose results it represents; a <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code> to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> containing the input file; and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code> to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers on which this word appears. Its only member function is a constructor that initializes these three members:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">class QueryResult {<br class="calibre6"/>friend std::ostream&amp; print(std::ostream&amp;, const QueryResult&amp;);<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;QueryResult(std::string s,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::shared_ptr&lt;std::set&lt;line_no&gt;&gt; p,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::shared_ptr&lt;std::vector&lt;std::string&gt;&gt; f):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sought(s), lines(p), file(f) { }<br class="calibre6"/>private:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::string sought;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">word this query represents</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::shared_ptr&lt;std::set&lt;line_no&gt;&gt; lines; // <span><span class="calibre45"><span class="calibre16">lines it's on</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;std::shared_ptr&lt;std::vector&lt;std::string&gt;&gt; file; // <span><span class="calibre45"><span class="calibre16">input file</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The constructor&#8217;s only job is to store its arguments in the corresponding data members, which it does in the constructor initializer list (&#167; <a href="073-7.1._defining_abstract_data_types.html#filepos1802479">7.1.4</a>, p. <a href="073-7.1._defining_abstract_data_types.html#filepos1802479">265</a>).</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">The <code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">query</span></span></tt></span></span></tt></code> Function</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">query</span></tt></code> function takes a <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>, which it uses to locate the corresponding <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">map</span></tt></code>. If the <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> is found, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">query</span></tt></code> function constructs a <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> from the given <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code>, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery file</span></tt></code> member, and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> that was fetched from <code class="calibre23"><tt class="calibre23"><span class="calibre24">wm</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The only question is: What should we return if the given <code class="calibre23"><tt class="calibre23"><span class="calibre24">string</span></tt></code> is not found? In this case, there is no <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> to return. We&#8217;ll solve this problem by defining a local <code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> object that is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code> to an empty <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers. When the word is not found, we&#8217;ll return a copy of this <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">QueryResult<br class="calibre6"/>TextQuery::query(const string &amp;sought) const<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">we'll return a pointer to this</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">set</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">if we don't find</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">sought</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;static shared_ptr&lt;set&lt;line_no&gt;&gt; nodata(new set&lt;line_no&gt;);<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">use</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">find</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and not a subscript to avoid adding words to</span></span></span> wm!<br class="calibre6"/>&#160;&#160;&#160;&#160;auto loc = wm.find(sought);<br class="calibre6"/>&#160;&#160;&#160;&#160;if (loc == wm.end())<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return QueryResult(sought, nodata, file); // <span><span class="calibre45"><span class="calibre16">not found</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;else<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return QueryResult(sought, loc-&gt;second, file);<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos3177453"/>Printing the Results</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">print</span></tt></code> function prints its given <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> object on its given stream:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">ostream &amp;print(ostream &amp; os, const QueryResult &amp;qr)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">if the word was found, print the count and all occurrences</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;os &lt;&lt; qr.sought &lt;&lt; " occurs " &lt;&lt; qr.lines-&gt;size() &lt;&lt; " "<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; make_plural(qr.lines-&gt;size(), "time", "s") &lt;&lt; endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print each line in which the word appeared</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;for (auto num : *qr.lines) // <span><span class="calibre45"><span class="calibre16">for every element in the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">set</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">don't confound the user with text lines starting at 0</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;os &lt;&lt; "\t(line " &lt;&lt; num + 1 &lt;&lt; ") "<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; *(qr.file-&gt;begin() + num) &lt;&lt; endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;return os;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">We use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">size</span></tt></code> of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> to which the <code class="calibre23"><tt class="calibre23"><span class="calibre24">qr.lines</span></tt></code> points to report how many matches were found. Because that <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> is in a <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code>, we have to remember to dereference <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code>. We call <code class="calibre23"><tt class="calibre23"><span class="calibre24">make_plural</span></tt></code> (&#167; <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">6.3.2</a>, p. <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">224</a>) to print <code class="calibre23"><tt class="calibre23"><span class="calibre24">time</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">times</span></tt></code>, depending on whether that size is equal to 1.</p><div class="calibre15">&#160;</div>
<p class="calibre25">In the <code class="calibre23"><tt class="calibre23"><span class="calibre24">for</span></tt></code> we iterate through the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">lines</span></tt></code> points. The body of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">for</span></tt></code> prints the line number, adjusted to use human-friendly counting. The numbers in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> are indices of elements in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code>, which are numbered from zero. However, most users think of the first line as line number 1, so we systematically add 1 to the line numbers to convert to this more common notation.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We use the line number to fetch a line from the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">file</span></tt></code> points. Recall that when we add a number to an iterator, we get the element that many elements further into the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> (&#167; <a href="033-3.4._introducing_iterators.html#filepos839265">3.4.2</a>, p. <a href="033-3.4._introducing_iterators.html#filepos839265">111</a>). Thus, <code class="calibre23"><tt class="calibre23"><span class="calibre24">file-&gt;begin() + num</span></tt></code> is the <code class="calibre23"><tt class="calibre23"><span class="calibre24">num</span></tt></code>th element after the start of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> to which <code class="calibre23"><tt class="calibre23"><span class="calibre24">file</span></tt></code> points.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Note that this function correctly handles the case that the word is not found. In this case, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> will be empty. The first output statement will note that the word occurred 0 times. Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">*res.lines</span></tt></code> is empty. the <code class="calibre23"><tt class="calibre23"><span class="calibre24">for</span></tt></code> loop won&#8217;t be executed.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 12.3.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 12.30:</strong> Define your own versions of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> classes and execute the <code class="calibre23"><tt class="calibre23"><span class="calibre24">runQueries</span></tt></code> function from &#167; <a href="116-12.3._using_the_library_a_textquery_program.html#filepos3142846">12.3.1</a> (p. <a href="116-12.3._using_the_library_a_textquery_program.html#filepos3142846">486</a>).</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 12.31:</strong> What difference(s) would it make if we used a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector</span></tt></code> instead of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> to hold the line numbers? Which approach is better? Why?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 12.32:</strong> Rewrite the <code class="calibre23"><tt class="calibre23"><span class="calibre24">TextQuery</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> classes to use a <code class="calibre23"><tt class="calibre23"><span class="calibre24">StrBlob</span></tt></code> instead of a <code class="calibre23"><tt class="calibre23"><span class="calibre24">vector&lt;string&gt;</span></tt></code> to hold the input file.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 12.33:</strong> In <a href="141-chapter_15._objectoriented_programming.html#filepos3778984">Chapter 15</a> we&#8217;ll extend our query system and will need some additional members in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> class. Add members named <code class="calibre23"><tt class="calibre23"><span class="calibre24">begin</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">end</span></tt></code> that return iterators into the <code class="calibre23"><tt class="calibre23"><span class="calibre24">set</span></tt></code> of line numbers returned by a given query, and a member named <code class="calibre23"><tt class="calibre23"><span class="calibre24">get_file</span></tt></code> that returns a <code class="calibre23"><tt class="calibre23"><span class="calibre24">shared_ptr</span></tt></code> to the file in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">QueryResult</span></tt></code> object.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="115-12.2._dynamic_arrays.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="117-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
