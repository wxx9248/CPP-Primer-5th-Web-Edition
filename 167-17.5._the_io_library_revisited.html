<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>17.5. The IO Library Revisited</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="166-17.4._random_numbers.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="168-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos4756189" class="calibre29"><span class="bold">17.5. The IO Library Revisited</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">In <a href="082-chapter_8._the_io_library.html#filepos2071768">Chapter 8</a> we introduced the basic architecture and most commonly used parts of the IO library. In this section we&#8217;ll look at three of the more specialized features that the IO library supports: format control, unformatted IO, and random access.</p><div class="calibre15">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><a id="filepos4756659"/><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 17.4.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.31:</strong> What would happen if we defined <code class="calibre23"><tt class="calibre23"><span class="calibre24">b</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">e</span></tt></code> inside the <code class="calibre23"><tt class="calibre23"><span class="calibre24">do</span></tt></code> loop of the game-playing program from this section?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.32:</strong> What would happen if we defined <code class="calibre23"><tt class="calibre23"><span class="calibre24">resp</span></tt></code> inside the loop?</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.33:</strong> Write a version of the word transformation program from &#167; <a href="109-11.3._operations_on_associative_containers.html#filepos2854545">11.3.6</a> (p. <a href="109-11.3._operations_on_associative_containers.html#filepos2854545">440</a>) that allows multiple transformations for a given word and randomly selects which transformation to apply.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos4757882" class="calibre37"><span class="calibre5">17.5.1. Formatted Input and Output</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">In addition to its condition state (&#167; <a href="083-8.1._the_io_classes.html#filepos2085669">8.1.2</a>, p. <a href="083-8.1._the_io_classes.html#filepos2085669">312</a>), each <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code> object also maintains a format state that controls the details of how IO is formatted. The format state controls aspects of formatting such as the notational base for integral values, the precision of floating-point values, the width of an output element, and so on.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The library defines a set of <strong class="calibre5"><a id="filepos4758578" href="169-defined_terms.html#filepos4845936">manipulators</a></strong> (&#167; <a href="012-1.2._a_first_look_at_inputoutput.html#filepos136281">1.2</a>, p. <a href="012-1.2._a_first_look_at_inputoutput.html#filepos136281">7</a>), listed in <a href="167-17.5._the_io_library_revisited.html#filepos4779193">Tables 17.17</a> (p. <a href="167-17.5._the_io_library_revisited.html#filepos4779193">757</a>) and <a href="167-17.5._the_io_library_revisited.html#filepos4792681">17.18</a> (p. <a href="167-17.5._the_io_library_revisited.html#filepos4792681">760</a>), that modify the format state of a stream. A manipulator is a function or object that affects the state of a stream and can be used as an operand to an input or output operator. Like the input and output operators, a manipulator returns the stream object to which it is applied, so we can combine manipulators and data in a single statement.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Our programs have already used one manipulator, <code class="calibre23"><tt class="calibre23"><span class="calibre24">endl</span></tt></code>, which we &#8220;write&#8221; to an output stream as if it were a value. But <code class="calibre23"><tt class="calibre23"><span class="calibre24">endl</span></tt></code> isn&#8217;t an ordinary value; instead, it performs an operation: It writes a newline and flushes the buffer.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Many Manipulators Change the Format State</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Manipulators are used for two broad categories of output control: controlling the presentation of numeric values and controlling the amount and placement of padding. Most of the manipulators that change the format state provide set/unset pairs; one manipulator sets the format state to a new value and the other unsets it, restoring the normal default formatting.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Manipulators that change the format state of the stream usually leave the format state changed for all subsequent IO.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25">The fact that a manipulator makes a persistent change to the format state can be useful when we have a set of IO operations that want to use the same formatting. Indeed, some programs take advantage of this aspect of manipulators to reset the behavior of one or more formatting rules for all its input or output. In such cases, the fact that a manipulator changes the stream is a desirable property.</p><div class="calibre22">&#160;</div>
<p class="calibre25">However, many programs (and, more importantly, programmers) expect the state of the stream to match the normal library defaults. In these cases, leaving the state of the stream in a nonstandard state can lead to errors. As a result, it is usually best to undo whatever state changes are made as soon as those changes are no longer needed.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos4761570"/>Controlling the Format of Boolean Values</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">One example of a manipulator that changes the formatting state of its object is the <code class="calibre23"><tt class="calibre23"><span class="calibre24">boolalpha</span></tt></code> manipulator. By default, <code class="calibre23"><tt class="calibre23"><span class="calibre24">bool</span></tt></code> values print as <code class="calibre23"><tt class="calibre23"><span class="calibre24">1</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">0</span></tt></code>. A <code class="calibre23"><tt class="calibre23"><span class="calibre24">true</span></tt></code> value is written as the integer <code class="calibre23"><tt class="calibre23"><span class="calibre24">1</span></tt></code> and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">false</span></tt></code> value as <code class="calibre23"><tt class="calibre23"><span class="calibre24">0</span></tt></code>. We can override this formatting by applying the <code class="calibre23"><tt class="calibre23"><span class="calibre24">boolalpha</span></tt></code> manipulator to the stream:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">cout &lt;&lt; "default bool values: " &lt;&lt; true &lt;&lt; " " &lt;&lt; false<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "\nalpha bool values: " &lt;&lt; boolalpha<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; true &lt;&lt; " " &lt;&lt; false &lt;&lt; endl;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">When executed, this program generates the following:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">default bool values: 1 0</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">alpha bool values: true false</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Once we &#8220;write&#8221; <code class="calibre23"><tt class="calibre23"><span class="calibre24">boolalpha</span></tt></code> on <code class="calibre23"><tt class="calibre23"><span class="calibre24">cout</span></tt></code>, we&#8217;ve changed how <code class="calibre23"><tt class="calibre23"><span class="calibre24">cout</span></tt></code> will print <code class="calibre23"><tt class="calibre23"><span class="calibre24">bool</span></tt></code> values from this point on. Subsequent operations that print <code class="calibre23"><tt class="calibre23"><span class="calibre24">bool</span></tt></code>s will print them as either <code class="calibre23"><tt class="calibre23"><span class="calibre24">true</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">false</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">To undo the format state change to <code class="calibre23"><tt class="calibre23"><span class="calibre24">cout</span></tt></code>, we apply <code class="calibre23"><tt class="calibre23"><span class="calibre24">noboolalpha</span></tt></code>:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">bool bool_val = get_status();<br class="calibre6"/>cout &lt;&lt; boolalpha&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">sets the internal state of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cout</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; bool_val<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; noboolalpha; // <span><span class="calibre45"><span class="calibre16">resets the internal state to default formatting</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Here we change the format of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bool</span></tt></code> values only to print the value of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bool_val</span></tt></code>. Once that value is printed, we immediately reset the stream back to its initial state.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Specifying the Base for Integral Values</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">By default, integral values are written and read in decimal notation. We can change the notational base to octal or hexadecimal or back to decimal by using the manipulators <code class="calibre23"><tt class="calibre23"><span class="calibre24">hex, oct</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">dec</span></tt></code>:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">cout &lt;&lt; "default: " &lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;<br class="calibre6"/>cout &lt;&lt; "octal: " &lt;&lt; oct &lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;<br class="calibre6"/>cout &lt;&lt; "hex: " &lt;&lt; hex &lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;<br class="calibre6"/>cout &lt;&lt; "decimal: " &lt;&lt; dec &lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">When compiled and executed, this program generates the following output:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">default: 20 1024</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">octal: 24 2000</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">hex: 14 400</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">decimal: 20 1024</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">Notice that like <code class="calibre23"><tt class="calibre23"><span class="calibre24">boolalpha</span></tt></code>, these manipulators change the format state. They affect the immediately following output and all subsequent integral output until the format is reset by invoking another manipulator.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">hex, oct</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">dec</span></tt></code> manipulators affect only integral operands; the representation of floating-point values is unaffected.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos4768479"/>Indicating Base on the Output</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">By default, when we print numbers, there is no visual cue as to what notational base was used. Is 20, for example, really 20, or an octal representation of 16? When we print numbers in decimal mode, the number is printed as we expect. If we need to print octal or hexadecimal values, it is likely that we should also use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">showbase</span></tt></code> manipulator. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">showbase</span></tt></code> manipulator causes the output stream to use the same conventions as used for specifying the base of an integral constant:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A leading 0x indicates hexadecimal.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; A leading 0 indicates octal.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; The absence of either indicates decimal.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">Here we&#8217;ve revised the previous program to use <code class="calibre23"><tt class="calibre23"><span class="calibre24">showbase</span></tt></code>:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">cout &lt;&lt; showbase;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">show the base when printing integral values</span></span></span><br class="calibre6"/>cout &lt;&lt; "default: " &lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;<br class="calibre6"/>cout &lt;&lt; "in octal: " &lt;&lt; oct &#160;&lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;<br class="calibre6"/>cout &lt;&lt; "in hex: " &lt;&lt; hex&#160;&#160;&lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;<br class="calibre6"/>cout &lt;&lt; "in decimal: " &lt;&lt; dec &lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024 &lt;&lt; endl;<br class="calibre6"/>cout &lt;&lt; noshowbase;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">reset the state of the stream</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The revised output makes it clear what the underlying value really is:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">default: 20 1024</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">in octal: 024 02000</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">in hex: 0x14 0x400</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">in decimal: 20 1024</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">noshowbase</span></tt></code> manipulator resets <code class="calibre23"><tt class="calibre23"><span class="calibre24">cout</span></tt></code> so that it no longer displays the notational base of integral values.</p><div class="calibre15">&#160;</div>
<p class="calibre25">By default, hexadecimal values are printed in lowercase with a lowercase x. We can display the <code class="calibre23"><tt class="calibre23"><span class="calibre24">X</span></tt></code> and the hex digits <code class="calibre23"><tt class="calibre23"><span class="calibre24">a</span></tt></code>&#8211;<code class="calibre23"><tt class="calibre23"><span class="calibre24">f</span></tt></code> as uppercase by applying the <code class="calibre23"><tt class="calibre23"><span class="calibre24">uppercase</span></tt></code> manipulator:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">cout &lt;&lt; uppercase &lt;&lt; showbase &lt;&lt; hex<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "printed in hexadecimal: " &lt;&lt; 20 &lt;&lt; " " &lt;&lt; 1024<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; nouppercase &lt;&lt; noshowbase &lt;&lt; dec &lt;&lt; endl;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This statement generates the following output:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">printed in hexadecimal: 0X14 0X400</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">We apply the <code class="calibre23"><tt class="calibre23"><span class="calibre24">nouppercase, noshowbase</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">dec</span></tt></code> manipulators to return the stream to its original state.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Controlling the Format of Floating-Point Values</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">We can control three aspects of floating-point output:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; How many digits of precision are printed</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27"><a id="filepos4773809"/>&#8226; Whether the number is printed in hexadecimal, fixed decimal, or scientific notation</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; Whether a decimal point is printed for floating-point values that are whole numbers</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">By default, floating-point values are printed using six digits of precision; the decimal point is omitted if the value has no fractional part; and they are printed in either fixed decimal or scientific notation depending on the value of the number. The library chooses a format that enhances readability of the number. Very large and very small values are printed using scientific notation. Other values are printed in fixed decimal.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Specifying How Much Precision to Print</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">By default, precision controls the total number of digits that are printed. When printed, floating-point values are rounded, not truncated, to the current precision. Thus, if the current precision is four, then <code class="calibre23"><tt class="calibre23"><span class="calibre24">3.14159</span></tt></code> becomes <code class="calibre23"><tt class="calibre23"><span class="calibre24">3.142</span></tt></code>; if the precision is three, then it is printed as <code class="calibre23"><tt class="calibre23"><span class="calibre24">3.14</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We can change the precision by calling the <code class="calibre23"><tt class="calibre23"><span class="calibre24">precision</span></tt></code> member of an IO object or by using the <code class="calibre23"><tt class="calibre23"><span class="calibre24">setprecision</span></tt></code> manipulator. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">precision</span></tt></code> member is overloaded (&#167; <a href="066-6.4._overloaded_functions.html#filepos1597234">6.4</a>, p. <a href="066-6.4._overloaded_functions.html#filepos1597234">230</a>). One version takes an <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> value and sets the precision to that new value. It returns the <em class="calibre16">previous</em> precision value. The other version takes no arguments and returns the current precision value. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">setprecision</span></tt></code> manipulator takes an argument, which it uses to set the precision.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">setprecision</span></tt></code> manipulators and other manipulators that take arguments are defined in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">iomanip</span></tt></code> header.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25">The following program illustrates the different ways we can control the precision used to print floating-point values:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cout.precision</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">reports the current precision value</span></span></span><br class="calibre6"/>cout&#160;&#160;&lt;&lt; "Precision: " &lt;&lt; cout.precision()<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&lt;&lt; ", Value: "&#160;&#160;&#160;&lt;&lt; sqrt(2.0) &lt;&lt; endl;<br class="calibre6"/>// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cout.precision(12</span></span></tt></span>) <span><span class="calibre45"><span class="calibre16">asks that 12 digits of precision be printed</span></span></span><br class="calibre6"/>cout.precision(12);<br class="calibre6"/>cout &lt;&lt; "Precision: " &lt;&lt; cout.precision()<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; ", Value: "&#160;&#160;&#160;&lt;&lt; sqrt(2.0) &lt;&lt; endl;<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">alternative way to set precision using the</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">setprecision</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">manipulator</span></span></span><br class="calibre6"/>cout &lt;&lt; setprecision(3);<br class="calibre6"/>cout &lt;&lt; "Precision: " &lt;&lt; cout.precision()<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; ", Value: "&#160;&#160;&#160;&lt;&lt; sqrt(2.0) &lt;&lt; endl;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">When compiled and executed, the program generates the following output:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Precision: 6, Value: 1.41421</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Precision: 12, Value: 1.41421356237</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">Precision: 3, Value: 1.41</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos4779185"/><a id="filepos4779193"/>Table 17.17. Manipulators Defined in <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">iostream</span></span></tt></span></span></tt></code></span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00127.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<p class="calibre14">This program calls the library <code class="calibre23"><tt class="calibre23"><span class="calibre24">sqrt</span></tt></code> function, which is found in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">cmath</span></tt></code> header. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">sqrt</span></tt></code> function is overloaded and can be called on either a <code class="calibre23"><tt class="calibre23"><span class="calibre24">float</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">double</span></tt></code>, or <code class="calibre23"><tt class="calibre23"><span class="calibre24">long double</span></tt></code> argument. It returns the square root of its argument.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Specifying the Notation of Floating-Point Numbers</span></h5><div class="calibre38">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00017.jpg" class="calibre9"/> Best Practices</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Unless you need to control the presentation of a floating-point number (e.g., to print data in columns or to print data that represents money or a percentage), it is usually best to let the library choose the notation.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre14">We can force a stream to use scientific, fixed, or hexadecimal notation by using the appropriate manipulator. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">scientific</span></tt></code> manipulator changes the stream to use scientific notation. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">fixed</span></tt></code> manipulator changes the stream to use fixed decimal.</p><div class="calibre15">&#160;</div>
<div class="calibre28"><a id="filepos4781287"/><img alt="Image" src="images/00008.jpg" class="calibre9"/></div>
<p class="calibre25">Under the new library, we can also force floating-point values to use hexadecimal format by using <code class="calibre23"><tt class="calibre23"><span class="calibre24">hexfloat</span></tt></code>. The new library provides another manipulator, named <code class="calibre23"><tt class="calibre23"><span class="calibre24">defaultfloat</span></tt></code>. This manipulator returns the stream to its default state in <a id="filepos4781735"/>which it chooses a notation based on the value being printed.</p><div class="calibre22">&#160;</div>
<p class="calibre25">These manipulators also change the default meaning of the precision for the stream. After executing <code class="calibre23"><tt class="calibre23"><span class="calibre24">scientific, fixed</span></tt></code>, or <code class="calibre23"><tt class="calibre23"><span class="calibre24">hexfloat</span></tt></code>, the precision value controls the number of digits after the decimal point. By default, precision specifies the total number of digits&#8212;both before and after the decimal point. Using <code class="calibre23"><tt class="calibre23"><span class="calibre24">fixed</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">scientific</span></tt></code> lets us print numbers lined up in columns, with the decimal point in a fixed position relative to the fractional part being printed:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">cout &lt;&lt; "default format: " &lt;&lt; 100 * sqrt(2.0) &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "scientific: " &lt;&lt; scientific &lt;&lt; 100 * sqrt(2.0) &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "fixed decimal: " &lt;&lt; fixed &lt;&lt; 100 * sqrt(2.0) &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "hexadecimal: " &lt;&lt; hexfloat &lt;&lt; 100 * sqrt(2.0) &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "use defaults: " &lt;&lt; defaultfloat &lt;&lt; 100 * sqrt(2.0)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "\n\n";</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">produces the following output:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">default format: 141.421</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">scientific: 1.414214e+002</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">fixed decimal: 141.421356</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">hexadecimal: 0x1.1ad7bcp+7</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">use defaults: 141.421</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">By default, the hexadecimal digits and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">e</span></tt></code> used in scientific notation are printed in lowercase. We can use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">uppercase</span></tt></code> manipulator to show those values in uppercase.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Printing the Decimal Point</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">By default, when the fractional part of a floating-point value is 0, the decimal point is not displayed. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">showpoint</span></tt></code> manipulator forces the decimal point to be printed:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">cout &lt;&lt; 10.0 &lt;&lt; endl;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">prints</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">10</span></span></tt></span><br class="calibre6"/>cout &lt;&lt; showpoint &lt;&lt; 10.0&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">prints</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">10.0000</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; noshowpoint &lt;&lt; endl;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">revert to default format for the decimal point</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">noshowpoint</span></tt></code> manipulator reinstates the default behavior. The next output expression will have the default behavior, which is to suppress the decimal point if the floating-point value has a 0 fractional part.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Padding the Output</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">When we print data in columns, we often need fairly fine control over how the data are formatted. The library provides several manipulators to help us accomplish the control we might need:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">setw</span></tt></code> to specify the minimum space for the <em class="calibre16">next</em> numeric or string value.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">left</span></tt></code> to left-justify the output.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">right</span></tt></code> to right-justify the output. Output is right-justified by default.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27"><a id="filepos4787258"/>&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">internal</span></tt></code> controls placement of the sign on negative values. <code class="calibre23"><tt class="calibre23"><span class="calibre24">internal</span></tt></code> left-justifies the sign and right-justifies the value, padding any intervening space with blanks.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">setfill</span></tt></code> lets us specify an alternative character to use to pad the output. By default, the value is a space.</p></blockquote><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14"><code class="calibre23"><tt class="calibre23"><span class="calibre24">setw</span></tt></code>, like <code class="calibre23"><tt class="calibre23"><span class="calibre24">endl</span></tt></code>, does not change the internal state of the output stream. It determines the size of only the <em class="calibre16">next</em> output.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre14">The following program illustrates these manipulators:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">int i = -16;<br class="calibre6"/>double d = 3.14159;<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">pad the first column to use a minimum of 12 positions in the output</span></span></span><br class="calibre6"/>cout &lt;&lt; "i: " &lt;&lt; setw(12) &lt;&lt; i &lt;&lt; "next col" &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "d: " &lt;&lt; setw(12) &lt;&lt; d &lt;&lt; "next col" &lt;&lt; '\n';<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">pad the first column and left-justify all columns</span></span></span><br class="calibre6"/>cout &lt;&lt; left<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "i: " &lt;&lt; setw(12) &lt;&lt; i &lt;&lt; "next col" &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "d: " &lt;&lt; setw(12) &lt;&lt; d &lt;&lt; "next col" &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; right;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">restore normal justification</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">pad the first column and right-justify all columns</span></span></span><br class="calibre6"/>cout &lt;&lt; right<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "i: " &lt;&lt; setw(12) &lt;&lt; i &lt;&lt; "next col" &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "d: " &lt;&lt; setw(12) &lt;&lt; d &lt;&lt; "next col" &lt;&lt; '\n';<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">pad the first column but put the padding internal to the field</span></span></span><br class="calibre6"/>cout &lt;&lt; internal<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "i: " &lt;&lt; setw(12) &lt;&lt; i &lt;&lt; "next col" &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "d: " &lt;&lt; setw(12) &lt;&lt; d &lt;&lt; "next col" &lt;&lt; '\n';<br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">pad the first column, using # as the pad character</span></span></span><br class="calibre6"/>cout &lt;&lt; setfill('#')<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "i: " &lt;&lt; setw(12) &lt;&lt; i &lt;&lt; "next col" &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; "d: " &lt;&lt; setw(12) &lt;&lt; d &lt;&lt; "next col" &lt;&lt; '\n'<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&lt;&lt; setfill(' ');&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">restore the normal pad character</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">When executed, this program generates</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">i:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-16next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">d:&#160;&#160;&#160;&#160;&#160;&#160;3.14159next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">i: -16&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">d: 3.14159&#160;&#160;&#160;&#160;&#160;next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">i:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-16next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">d:&#160;&#160;&#160;&#160;&#160;&#160;3.14159next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">i: -&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;16next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">d:&#160;&#160;&#160;&#160;&#160;&#160;3.14159next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">i: -#########16next col</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">d: #####3.14159next col</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos4792673"/><a id="filepos4792681"/>Table 17.18. Manipulators Defined in <code class="calibre23"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">iomanip</span></span></tt></span></span></tt></code></span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00128.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Controlling Input Formatting</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">By default, the input operators ignore whitespace (blank, tab, newline, formfeed, and carriage return). The following loop</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">char ch;<br class="calibre6"/>while (cin &gt;&gt; ch)<br class="calibre6"/>&#160;&#160;&#160;&#160;cout &lt;&lt; ch;</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">given the input sequence</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">a b&#160;&#160;&#160;&#160;c</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">d</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">executes four times to read the characters <code class="calibre23"><tt class="calibre23"><span class="calibre24">a</span></tt></code> through <code class="calibre23"><tt class="calibre23"><span class="calibre24">d</span></tt></code>, skipping the intervening blanks, possible tabs, and newline characters. The output from this program is</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">abcd</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">noskipws</span></tt></code> manipulator causes the input operator to read, rather than skip, whitespace. To return to the default behavior, we apply the <code class="calibre23"><tt class="calibre23"><span class="calibre24">skipws</span></tt></code> manipulator:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">cin &gt;&gt; noskipws;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">set</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cin</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">so that it reads whitespace</span></span></span><br class="calibre6"/>while (cin &gt;&gt; ch)<br class="calibre6"/>&#160;&#160;&#160;&#160;cout &lt;&lt; ch;<br class="calibre6"/>cin &gt;&gt; skipws;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">reset</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cin</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">to the default state so that it discards whitespace</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Given the same input as before, this loop makes seven iterations, reading whitespace as well as the characters in the input. This loop generates</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">a b&#160;&#160;&#160;&#160;c</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">d</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 17.5.1</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.34:</strong> Write a program that illustrates the use of each manipulator in <a href="167-17.5._the_io_library_revisited.html#filepos4779193">Tables 17.17</a> (p. <a href="167-17.5._the_io_library_revisited.html#filepos4779193">757</a>) and <a href="167-17.5._the_io_library_revisited.html#filepos4792681">17.18</a>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.35:</strong> Write a version of the program from page <a href="167-17.5._the_io_library_revisited.html#filepos4781735">758</a>, that printed the square root of 2 but this time print hexadecimal digits in uppercase.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.36:</strong> Modify the program from the previous exercise to print the various floating-point values so that they line up in a column.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 id="filepos4797269" class="calibre37"><span class="calibre5"><a id="filepos4797302"/>17.5.2. Unformatted Input/Output Operations</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">So far, our programs have used only <strong class="calibre5"><a id="filepos4797466" href="169-defined_terms.html#filepos4844292">formatted IO</a></strong> operations. The input and output operators <code class="calibre23"><tt class="calibre23"><span class="calibre24">(&lt;&lt;</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">&gt;&gt;)</span></tt></code> format the data they read or write according to the type being handled. The input operators ignore whitespace; the output operators apply padding, precision, and so on.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The library also provides a set of low-level operations that support <strong class="calibre5"><a id="filepos4798035" href="169-defined_terms.html#filepos4852263">unformatted IO</a></strong>. These operations let us deal with a stream as a sequence of uninterpreted bytes.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Single-Byte Operations</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Several of the unformatted operations deal with a stream one byte at a time. These operations, which are described in <a href="167-17.5._the_io_library_revisited.html#filepos4799358">Table 17.19</a>, read rather than ignore whitespace. For example, we can use the unformatted IO operations <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">put</span></tt></code> to read and write the characters one at a time:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">char ch;<br class="calibre6"/>while (cin.get(ch))<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cout.put(ch);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This program preserves the whitespace in the input. Its output is identical to the input. It executes the same way as the previous program that used <code class="calibre23"><tt class="calibre23"><span class="calibre24">noskipws</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos4799358"/>Table 17.19. Single-Byte Low-Level IO Operations</span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00129.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Putting Back onto an Input Stream</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Sometimes we need to read a character in order to know that we aren&#8217;t ready for it. In such cases, we&#8217;d like to put the character back onto the stream. The library gives us three ways to do so, each of which has subtle differences from the others:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">peek</span></tt></code> returns a copy of the next character on the input stream but does not change the stream. The value returned by <code class="calibre23"><tt class="calibre23"><span class="calibre24">peek</span></tt></code> stays on the stream.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">unget</span></tt></code> backs up the input stream so that whatever value was last returned is still on the stream. We can call <code class="calibre23"><tt class="calibre23"><span class="calibre24">unget</span></tt></code> even if we do not know what value was last taken from the stream.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">putback</span></tt></code> is a more specialized version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">unget:</span></tt></code> It returns the last value read from the stream but takes an argument that must be the same as the one that was last read.</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14"><a id="filepos4801153"/>In general, we are guaranteed to be able to put back at most one value before the next read. That is, we are not guaranteed to be able to call <code class="calibre23"><tt class="calibre23"><span class="calibre24">putback</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">unget</span></tt></code> successively without an intervening read operation.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><code class="calibre23"><tt class="calibre23"><span class="calibre49"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">int</span></span></tt></span></span></tt></code> Return Values from Input Operations</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">peek</span></tt></code> function and the version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> that takes no argument return a character from the input stream as an <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code>. This fact can be surprising; it might seem more natural to have these functions return a <code class="calibre23"><tt class="calibre23"><span class="calibre24">char</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">The reason that these functions return an <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> is to allow them to return an end-of-file marker. A given character set is allowed to use every value in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">char</span></tt></code> range to represent an actual character. Thus, there is no extra value in that range to use to represent end-of-file.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The functions that return <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> convert the character they return to <code class="calibre23"><tt class="calibre23"><span class="calibre24">unsigned char</span></tt></code> and then promote that value to <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code>. As a result, even if the character set has characters that map to negative values, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> returned from these operations will be a positive value (&#167; <a href="021-2.1._primitive_builtin_types.html#filepos304094">2.1.2</a>, p. <a href="021-2.1._primitive_builtin_types.html#filepos304094">35</a>). The library uses a negative value to represent end-of-file, which is thus guaranteed to be distinct from any legitimate character value. Rather than requiring us to know the actual value returned, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream</span></tt></code> header defines a <code class="calibre23"><tt class="calibre23"><span class="calibre24">const</span></tt></code> named <code class="calibre23"><tt class="calibre23"><span class="calibre24">EOF</span></tt></code> that we can use to test if the value returned from <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> is end-of-file. It is essential that we use an <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> to hold the return from these functions:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">int ch;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">use an</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">int</span></span></tt></span><span><span class="calibre45"><span class="calibre16">,</span></span></span>
<span><span class="calibre45"><span class="calibre16">not a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">char</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">to hold the return from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">get()</span></span></tt></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">loop to read and write all the data in the input</span></span></span><br class="calibre6"/>while ((ch = cin.get()) != EOF)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cout.put(ch);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This program operates identically to the one on page <a href="167-17.5._the_io_library_revisited.html#filepos4797302">761</a>, the only difference being the version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> that is used to read the input.</p><div class="calibre15">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Multi-Byte Operations</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Some unformatted IO operations deal with chunks of data at a time. These operations can be important if speed is an issue, but like other low-level operations, they are error-prone. In particular, these operations require us to allocate and manage the character arrays (&#167; <a href="115-12.2._dynamic_arrays.html#filepos3086710">12.2</a>, p. <a href="115-12.2._dynamic_arrays.html#filepos3086710">476</a>) used to store and retrieve data. The multi-byte operations are listed in <a href="167-17.5._the_io_library_revisited.html#filepos4806114">Table 17.20</a>.</p><div class="calibre15">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos4806114"/>Table 17.20. Multi-Byte Low-Level IO Operations</span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00130.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> functions take the same parameters, and their actions are similar but not identical. In each case, <code class="calibre23"><tt class="calibre23"><span class="calibre24">sink</span></tt></code> is a <code class="calibre23"><tt class="calibre23"><span class="calibre24">char</span></tt></code> array into which the data are placed. The functions read until one of the following conditions occurs:</p><div class="calibre22">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; <code class="calibre23"><tt class="calibre23"><span class="calibre24">size - 1</span></tt></code> characters are read</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; End-of-file is encountered</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre26"><p class="calibre27">&#8226; The delimiter character is encountered</p></blockquote><div class="calibre15">&#160;</div>
<p class="calibre14">The difference between these functions is the treatment of the delimiter: <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> leaves the delimiter as the next character of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code>, whereas <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> reads and discards the delimiter. In either case, the delimiter is <em class="calibre16">not</em> stored in <code class="calibre23"><tt class="calibre23"><span class="calibre24">sink</span></tt></code>.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><a id="filepos4807913"/><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">It is a common error to intend to remove the delimiter from the stream but to forget to do so.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Determining How Many Characters Were Read</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Several of the read operations read an unknown number of bytes from the input. We can call <code class="calibre23"><tt class="calibre23"><span class="calibre24">gcount</span></tt></code> to determine how many characters the last unformatted input operation read. It is essential to call <code class="calibre23"><tt class="calibre23"><span class="calibre24">gcount</span></tt></code> before any intervening unformatted input operation. In particular, the single-character operations that put characters back on the stream are also unformatted input operations. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">peek, unget</span></tt></code>, or <code class="calibre23"><tt class="calibre23"><span class="calibre24">putback</span></tt></code> are called before calling <code class="calibre23"><tt class="calibre23"><span class="calibre24">gcount</span></tt></code>, then the return value will be 0.</p><div class="calibre15">&#160;</div>
<h4 id="filepos4809250" class="calibre37"><span class="calibre5">17.5.3. Random Access to a Stream</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">The various stream types generally support random access to the data in their associated stream. We can reposition the stream so that it skips around, reading first the last line, then the first, and so on. The library provides a pair of functions to <em class="calibre16">seek</em> to a given location and to <em class="calibre16">tell</em> the current location in the associated stream.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Random IO is an inherently system-dependent. To understand how to use these features, you must consult your system&#8217;s documentation.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25">Although these seek and tell functions are defined for all the stream types, whether they do anything useful depends on the device to which the stream is bound. On most systems, the streams bound to <code class="calibre23"><tt class="calibre23"><span class="calibre24">cin</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">cout</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">cerr</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">clog</span></tt></code> do <a id="filepos4810750"/><em class="calibre16">not</em> support random access&#8212;after all, what would it mean to jump back ten places when we&#8217;re writing directly to <code class="calibre23"><tt class="calibre23"><span class="calibre24">cout</span></tt></code>? We can call the seek and tell functions, but these functions will fail at run time, leaving the stream in an invalid state.</p><div class="calibre22">&#160;</div>
<div class="calibre35"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre14"><span class="calibre5"><a/>Caution: Low-Level Routines Are Error-Prone</span></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">In general, we advocate using the higher-level abstractions provided by the library. The IO operations that return <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> are a good example of why.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">It is a common programming error to assign the return, from <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">peek</span></tt></code> to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">char</span></tt></code> rather than an <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code>. Doing so is an error, but an error the compiler will not detect. Instead, what happens depends on the machine and on the input data. For example, on a machine in which <code class="calibre23"><tt class="calibre23"><span class="calibre24">char</span></tt></code>s are implemented as <code class="calibre23"><tt class="calibre23"><span class="calibre24">unsigned char</span></tt></code>s, this loop will run forever:</p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">char ch;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">using a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">char</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">here invites disaster!</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">the return from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">cin.get</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is converted to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">char</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">and then compared to an</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">int</span></span></tt></span><br class="calibre6"/>while ((ch = cin.get()) != EOF)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cout.put(ch);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">The problem is that when <code class="calibre23"><tt class="calibre23"><span class="calibre24">get</span></tt></code> returns <code class="calibre23"><tt class="calibre23"><span class="calibre24">EOF</span></tt></code>, that value will be converted to an <code class="calibre23"><tt class="calibre23"><span class="calibre24">unsigned char</span></tt></code> value. That converted value is no longer equal to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">int</span></tt></code> value of <code class="calibre23"><tt class="calibre23"><span class="calibre24">EOF</span></tt></code>, and the loop will continue forever. Such errors are likely to be caught in testing.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">On machines for which <code class="calibre23"><tt class="calibre23"><span class="calibre24">char</span></tt></code>s are implemented as <code class="calibre23"><tt class="calibre23"><span class="calibre24">signed char</span></tt></code>s, we can&#8217;t say with confidence what the behavior of the loop might be. What happens when an out-of-bounds value is assigned to a <code class="calibre23"><tt class="calibre23"><span class="calibre24">signed</span></tt></code> value is up to the compiler. On many machines, this loop will appear to work, unless a character in the input matches the EOF value. Although such characters are unlikely in ordinary data, presumably low-level IO is necessary only when we read binary values that do not map directly to ordinary characters and numeric values. For example, on our machine, if the input contains a character whose value is <code class="calibre23"><tt class="calibre23"><span class="calibre24">'\377'</span></tt></code>, then the loop terminates prematurely. <code class="calibre23"><tt class="calibre23"><span class="calibre24">'\377'</span></tt></code> is the value on our machine to which &#8722;1 converts when used as a <code class="calibre23"><tt class="calibre23"><span class="calibre24">signed char</span></tt></code>. If the input has this value, then it will be treated as the (premature) end-of-file indicator.</p></blockquote><div class="calibre22">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">Such bugs do not happen when we read and write typed values. If you can use the more type-safe, higher-level operations supported by the library, do so.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 17.5.2</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.37:</strong> Use the unformatted version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> to read a file a line at a time. Test your program by giving it a file that contains empty lines as well as lines that are longer than the character array that you pass to <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.38:</strong> Extend your program from the previous exercise to print each word you read onto its own line.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00013.jpg" class="calibre9"/> Warning</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Because the <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> types usually do not support random access, the remainder of this section should be considered as applicable to only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">sstream</span></tt></code> types.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5"><a id="filepos4817560"/>Seek and Tell Functions</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">To support random access, the IO types maintain a marker that determines where the next read or write will happen. They also provide two functions: One repositions the marker by <em class="calibre16">seek</em>ing to a given position; the second <em class="calibre16">tell</em>s us the current position of the marker. The library actually defines two pairs of <em class="calibre16">seek</em> and <em class="calibre16">tell</em> functions, which are described in <a href="167-17.5._the_io_library_revisited.html#filepos4818715">Table 17.21</a>. One pair is used by input streams, the other by output streams. The input and output versions are distinguished by a suffix that is either a <code class="calibre23"><tt class="calibre23"><span class="calibre24">g</span></tt></code> or a <code class="calibre23"><tt class="calibre23"><span class="calibre24">p</span></tt></code>. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">g</span></tt></code> versions indicate that we are &#8220;getting&#8221; (reading) data, and the <code class="calibre23"><tt class="calibre23"><span class="calibre24">p</span></tt></code> functions indicate that we are &#8220;putting&#8221; (writing) data.</p><div class="calibre15">&#160;</div>
<p class="calibre51"><span class="calibre5"><a id="filepos4818715"/>Table 17.21. Seek and Tell Functions</span></p><div class="calibre12">&#160;</div>
<div class="calibre52"><img alt="Image" src="images/00131.jpg" class="calibre9"/></div><div class="calibre22">&#160;</div>
<p class="calibre25">Logically enough, we can use only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">g</span></tt></code> versions on an <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> and on the types <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">istringstream</span></tt></code> that inherit from <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> (&#167; <a href="083-8.1._the_io_classes.html#filepos2076693">8.1</a>, p. <a href="083-8.1._the_io_classes.html#filepos2076693">311</a>). We can use only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">p</span></tt></code> versions on an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code> and on the types that inherit from it, <code class="calibre23"><tt class="calibre23"><span class="calibre24">ofstream</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostringstream</span></tt></code>. An <code class="calibre23"><tt class="calibre23"><span class="calibre24">iostream, fstream</span></tt></code>, or <code class="calibre23"><tt class="calibre23"><span class="calibre24">stringstream</span></tt></code> can both read and write the associated stream; we can use either the <code class="calibre23"><tt class="calibre23"><span class="calibre24">g</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">p</span></tt></code> versions on objects of these types.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">There Is Only One Marker</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The fact that the library distinguishes between the &#8220;putting&#8221; and &#8220;getting&#8221; versions of the seek and tell functions can be misleading. Even though the library makes this distinction, it maintains only a single marker in a stream&#8212;there is <em class="calibre16">not</em> a distinct read marker and write marker.</p><div class="calibre15">&#160;</div>
<p class="calibre25">When we&#8217;re dealing with an input-only or output-only stream, the distinction isn&#8217;t even apparent. We can use only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">g</span></tt></code> or only the <code class="calibre23"><tt class="calibre23"><span class="calibre24">p</span></tt></code> versions on such streams. If we attempt to call <code class="calibre23"><tt class="calibre23"><span class="calibre24">tellp</span></tt></code> on an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ifstream</span></tt></code>, the compiler will complain. Similarly, it will not let us call <code class="calibre23"><tt class="calibre23"><span class="calibre24">seekg</span></tt></code> on an <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostringstream</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">stringstream</span></tt></code> types can read and write the same stream. In these types there is a single buffer that holds data to be read and written and a single marker denoting the current position in the buffer. The library maps both the <code class="calibre23"><tt class="calibre23"><span class="calibre24">g</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">p</span></tt></code> positions to this single marker.</p><div class="calibre22">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><a id="filepos4822110"/><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Because there is only a single marker, we <em class="calibre16">must</em> do a <code class="calibre23"><tt class="calibre23"><span class="calibre24">seek</span></tt></code> to reposition the marker whenever we switch between reading and writing.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Repositioning the Marker</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">There are two versions of the seek functions: One moves to an &#8220;absolute&#8221; address within the file; the other moves to a byte offset from a given position:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">set the marker to a fixed position</span></span></span><br class="calibre6"/>seekg(new_position);&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">set the read marker to the given</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">pos_type</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">location</span></span></span><br class="calibre6"/>seekp(new_position);&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">set the write marker to the given</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">pos_type</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">location</span></span></span><br class="calibre6"/><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">offset some distance ahead of or behind the given starting point</span></span></span><br class="calibre6"/>seekg(offset, from);&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">set the read marker</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">offset</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">distance from</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">from</span></span></tt></span><br class="calibre6"/>seekp(offset, from);&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">offset</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has type</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">off_type</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">The possible values for <code class="calibre23"><tt class="calibre23"><span class="calibre24">from</span></tt></code> are listed in <a href="167-17.5._the_io_library_revisited.html#filepos4818715">Table 17.21</a> (on the previous page).</p><div class="calibre15">&#160;</div>
<p class="calibre25">The arguments, <code class="calibre23"><tt class="calibre23"><span class="calibre24">new_position</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">offset</span></tt></code>, have machine-dependent types named <code class="calibre23"><tt class="calibre23"><span class="calibre24">pos_type</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">off_type</span></tt></code>, respectively. These types are defined in both <code class="calibre23"><tt class="calibre23"><span class="calibre24">istream</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">ostream</span></tt></code>. <code class="calibre23"><tt class="calibre23"><span class="calibre24">pos_type</span></tt></code> represents a file position and <code class="calibre23"><tt class="calibre23"><span class="calibre24">off_type</span></tt></code> represents an offset from that position. A value of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">off_type</span></tt></code> can be positive or negative; we can <code class="calibre23"><tt class="calibre23"><span class="calibre24">seek</span></tt></code> forward or backward in the file.</p><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Accessing the Marker</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">tellg</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">tellp</span></tt></code> functions return a <code class="calibre23"><tt class="calibre23"><span class="calibre24">pos_type</span></tt></code> value denoting the current position of the stream. The tell functions are usually used to remember a location so that we can subsequently seek back to it:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">remember the current write position in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">mark</span></span></tt></span><br class="calibre6"/>ostringstream writeStr;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">output</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">stringstream</span></span></tt></span><br class="calibre6"/>ostringstream::pos_type mark = writeStr.tellp();<br class="calibre6"/>// ...<br class="calibre6"/>if (cancelEntry)<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">return to the remembered position</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;writeStr.seekp(mark);</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<h5 class="calibre39"><span class="calibre5">Reading and Writing to the Same File</span></h5><div class="calibre38">&#160;</div>
<p class="calibre14">Let&#8217;s look at a programming example. Assume we are given a file to read. We are to write a newline at the end of the file that contains the relative position at which each line begins. For example, given the following file,</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">abcd</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">efg</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">hi</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">j</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">the program should produce the following modified file:</p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24"><a/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">abcd</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">efg</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">hi</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">j</span></span></tt></span><br class="calibre6"/><span><tt class="calibre23"><span class="calibre32"><span class="calibre5">5 9 12 14</span></span></tt></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Note that our program need not write the offset for the first line&#8212;it always occurs at position 0. Also note that the offset counts must include the invisible newline character that ends each line. Finally, note that the last number in the output is the offset for the line on which our output begins. By including this offset in our output, we can distinguish our output from the file&#8217;s original contents. We can read the last number in the resulting file and seek to the corresponding offset to get to the beginning of our output.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Our program will read the file a line at a time. For each line, we&#8217;ll increment a counter, adding the size of the line we just read. That counter is the offset at which the next line starts:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">int main()<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">open for input and output and preposition file pointers to end-of-file</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">file mode argument see &#167; 8.4 (p. 319)</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;fstream inOut("copyOut",<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fstream::ate | fstream::in | fstream::out);<br class="calibre6"/>&#160;&#160;&#160;&#160;if (!inOut) {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cerr &lt;&lt; "Unable to open file!" &lt;&lt; endl;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return EXIT_FAILURE; // <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">EXIT_FAILURE</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">see &#167; 6.3.2 (p. 227)</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">inOut</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is opened in</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">ate</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">mode, so it starts out positioned at the end</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;auto end_mark = inOut.tellg();// <span><span class="calibre45"><span class="calibre16">remember original end-of-file position</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;inOut.seekg(0, fstream::beg); // <span><span class="calibre45"><span class="calibre16">reposition to the start of the file</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;size_t cnt = 0;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">accumulator for the byte count</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;string line;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">hold each line of input</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">while we haven't hit an error and are still reading the original data</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;while (inOut &amp;&amp; inOut.tellg() != end_mark<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&amp;&amp; getline(inOut, line)) { // <span><span class="calibre45"><span class="calibre16">and can get another line of input</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cnt += line.size() + 1;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">add</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">1</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">to account for the newline</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;auto mark = inOut.tellg();&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">remember the read position</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;inOut.seekp(0, fstream::end); // <span><span class="calibre45"><span class="calibre16">set the write marker to the end</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;inOut &lt;&lt; cnt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">write the accumulated length</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">print a separator if this is not the last line</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (mark != end_mark) inOut &lt;&lt; " ";<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;inOut.seekg(mark);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">restore the read position</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;inOut.seekp(0, fstream::end);&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">seek to the end</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;inOut &lt;&lt; "\n";&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">write a newline at end-of-file</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;return 0;<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Our program opens its <code class="calibre23"><tt class="calibre23"><span class="calibre24">fstream</span></tt></code> using the <code class="calibre23"><tt class="calibre23"><span class="calibre24">in</span></tt></code>, <code class="calibre23"><tt class="calibre23"><span class="calibre24">out</span></tt></code>, and <code class="calibre23"><tt class="calibre23"><span class="calibre24">ate</span></tt></code> modes (&#167; 8.4, p. <a href="084-8.2._file_input_and_output.html#filepos2131282">319</a>). The first two modes indicate that we intend to read and write the same file. Specifying <a id="filepos4835048"/><code class="calibre23"><tt class="calibre23"><span class="calibre24">ate</span></tt></code> positions the read and write markers at the end of the file. As usual, we check that the open succeeded, and exit if it did not (&#167; <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">6.3.2</a>, p. <a href="065-6.3._return_types_and_the_return_statement.html#filepos1552941">227</a>).</p><div class="calibre15">&#160;</div>
<p class="calibre25">Because our program writes to its input file, we can&#8217;t use end-of-file to signal when it&#8217;s time to stop reading. Instead, our loop must end when it reaches the point at which the original input ended. As a result, we must first remember the original end-of-file position. Because we opened the file in <code class="calibre23"><tt class="calibre23"><span class="calibre24">ate</span></tt></code> mode, <code class="calibre23"><tt class="calibre23"><span class="calibre24">inOut</span></tt></code> is already positioned at the end. We store the current (i.e., the original end) position in <code class="calibre23"><tt class="calibre23"><span class="calibre24">end_mark</span></tt></code>. Having remembered the end position, we reposition the read marker at the beginning of the file by seeking to the position 0 bytes from the beginning of the file.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code> loop has a three-part condition: We first check that the stream is valid; if so, we check whether we&#8217;ve exhausted our original input by comparing the current read position (returned by <code class="calibre23"><tt class="calibre23"><span class="calibre24">tellg</span></tt></code>) with the position we remembered in <code class="calibre23"><tt class="calibre23"><span class="calibre24">end_mark</span></tt></code>. Finally, assuming that both tests succeeded, we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> to read the next line of input. If <code class="calibre23"><tt class="calibre23"><span class="calibre24">getline</span></tt></code> succeeds, we perform the body of the loop.</p><div class="calibre22">&#160;</div>
<p class="calibre25">The loop body starts by remembering the current position in <code class="calibre23"><tt class="calibre23"><span class="calibre24">mark</span></tt></code>. We save that position in order to return to it after writing the next relative offset. The call to <code class="calibre23"><tt class="calibre23"><span class="calibre24">seekp</span></tt></code> repositions the write marker to the end of the file. We write the counter value and then <code class="calibre23"><tt class="calibre23"><span class="calibre24">seekg</span></tt></code> back to the position we remembered in <code class="calibre23"><tt class="calibre23"><span class="calibre24">mark</span></tt></code>. Having restored the marker, we&#8217;re ready to repeat the condition in the <code class="calibre23"><tt class="calibre23"><span class="calibre24">while</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Each iteration of the loop writes the offset of the next line. Therefore, the last iteration of the loop takes care of writing the offset of the last line. However, we still need to write a newline at the end of the file. As with the other writes, we call <code class="calibre23"><tt class="calibre23"><span class="calibre24">seekp</span></tt></code> to position the file at the end before writing the newline.</p><div class="calibre22">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 17.5.3</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 17.39:</strong> Write your own version of the <code class="calibre23"><tt class="calibre23"><span class="calibre24">seek</span></tt></code> program presented in this section.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="166-17.4._random_numbers.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="168-chapter_summary.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
