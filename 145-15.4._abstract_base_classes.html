<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>15.4. Abstract Base Classes</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="144-15.3._virtual_functions.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="146-15.5._access_control_and_inheritance.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos3884701" class="calibre29"><span class="bold">15.4. Abstract Base Classes</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">Imagine that we want to extend our bookstore classes to support several discount strategies. In addition to a bulk discount, we might offer a discount for purchases up to a certain quantity and then charge the full price thereafter. Or we might offer a discount for purchases above a certain limit but not for purchases up to that limit.</p><div class="calibre15">&#160;</div>
<p class="calibre25">Each of these discount strategies is the same in that it requires a quantity and a discount amount. We might support these differing strategies by defining a new class named <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> to store the quantity and the discount amount. Classes, such as <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_item</span></tt></code>, that represent a specific discount strategy will inherit from <a id="filepos3885681"/><code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code>. Each of the derived classes will implement its discount strategy by defining its own version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Before we can define our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_Quote</span></tt></code> class, we have to decide what to do about <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>. Our <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> class doesn&#8217;t correspond to any particular discount strategy; there is no meaning to ascribe to <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> for this class.</p><div class="calibre22">&#160;</div>
<p class="calibre25">We could define <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> without its own version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>. In this case, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> would inherit <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code>.</p><div class="calibre22">&#160;</div>
<p class="calibre25">However, this design would make it possible for our users to write nonsensical code. A user could create an object of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> by supplying a quantity and a discount rate. Passing that <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> object to a function such as <code class="calibre23"><tt class="calibre23"><span class="calibre24">print_total</span></tt></code> would use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>. The calculated price would not include the discount that was supplied when the object was created. That state of affairs makes no sense.</p><div class="calibre22">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Pure Virtual Functions</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">Thinking about the question in this detail reveals that our problem is not just that we don&#8217;t know how to define <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>. In practice, we&#8217;d like to prevent users from creating <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> objects at all. This class represents the general concept of a discounted book, not a concrete discount strategy.</p><div class="calibre15">&#160;</div>
<p class="calibre25">We can enforce this design intent&#8212;and make it clear that there is no meaning for <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>&#8212;by defining <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> as a <strong class="calibre5"><a id="filepos3888708" href="152-defined_terms.html#filepos4147890">pure virtual</a></strong> function. Unlike ordinary virtuals, a pure virtual function does not have to be defined. We specify that a virtual function is a pure virtual by writing <code class="calibre23"><tt class="calibre23"><span class="calibre24">= 0</span></tt></code> in place of a function body (i.e., just before the semicolon that ends the declaration). The <code class="calibre23"><tt class="calibre23"><span class="calibre24">= 0</span></tt></code> may appear only on the declaration of a virtual function in the class body:</p><div class="calibre22">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">class to hold the discount rate and quantity</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">derived classes will implement pricing strategies using these data</span></span></span><br class="calibre6"/>class Disc_quote : public Quote {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;Disc_quote() = default;<br class="calibre6"/>&#160;&#160;&#160;&#160;Disc_quote(const std::string&amp; book, double price,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::size_t qty, double disc):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Quote(book, price),<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;quantity(qty), discount(disc) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;double net_price(std::size_t) const = 0;<br class="calibre6"/>protected:<br class="calibre6"/>&#160;&#160;&#160;&#160;std::size_t quantity = 0; //&#160;&#160;<span><span class="calibre45"><span class="calibre16">purchase size for the discount to apply</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;double discount = 0.0;&#160;&#160;&#160;&#160;//&#160;&#160;<span><span class="calibre45"><span class="calibre16">fractional discount to apply</span></span></span><br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Like our earlier <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_item</span></tt></code> class, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> defines a default constructor and a constructor that takes four parameters. Although we cannot define objects of this type directly, constructors in classes derived from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> will use the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> constructors to construct the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> part of their objects. The constructor that has four parameters passes its first two to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> constructor and directly initializes its own members, <code class="calibre23"><tt class="calibre23"><span class="calibre24">discount</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">quantity</span></tt></code>. The default constructor default initializes those members.</p><div class="calibre15">&#160;</div>
<p class="calibre25"><a id="filepos3891932"/>It is worth noting that we can provide a definition for a pure virtual. However, the function body must be defined outside the class. That is, we cannot provide a function body inside the class for a function that is <code class="calibre23"><tt class="calibre23"><span class="calibre24">= 0</span></tt></code>.</p><div class="calibre22">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Classes with Pure Virtuals Are Abstract Base Classes</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">A class containing (or inheriting without overridding) a pure virtual function is an <strong class="calibre5"><a id="filepos3892498" href="152-defined_terms.html#filepos4140092">abstract base class</a></strong>. An abstract base class defines an interface for subsequent classes to override. We cannot (directly) create objects of a type that is an abstract base class. Because <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> defines <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> as a pure virtual, we cannot define objects of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code>. We can define objects of classes that inherit from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code>, so long as those classes override <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code>:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Disc_quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">declares pure virtual functions, which</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Bulk_quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">will override</span></span></span><br class="calibre6"/>Disc_quote discounted; // <span><span class="calibre45"><span class="calibre16">error: can't define a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Disc_quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">object</span></span></span><br class="calibre6"/>Bulk_quote bulk;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Bulk_quote</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">has no pure virtual functions</span></span></span></span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">Classes that inherit from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> must define <code class="calibre23"><tt class="calibre23"><span class="calibre24">net_price</span></tt></code> or those classes will be abstract as well.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">We may not create objects of a type that is an abstract base class.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<h4 class="calibre37"><span class="calibre5">A Derived Class Constructor Initializes Its Direct Base Class Only</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">Now we can reimplement <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> to inherit from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> rather than inheriting directly from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code>:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">// <span><span class="calibre45"><span class="calibre16">the discount kicks in when a specified number of copies of the same book are sold</span></span></span><br class="calibre6"/>// <span><span class="calibre45"><span class="calibre16">the discount is expressed as a fraction to use to reduce the normal price</span></span></span><br class="calibre6"/>class Bulk_quote : public Disc_quote {<br class="calibre6"/>public:<br class="calibre6"/>&#160;&#160;&#160;&#160;Bulk_quote() = default;<br class="calibre6"/>&#160;&#160;&#160;&#160;Bulk_quote(const std::string&amp; book, double price,<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;std::size_t qty, double disc):<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Disc_quote(book, price, qty, disc) { }<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">overrides the base version to implement the bulk purchase discount policy</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;double net_price(std::size_t) const override;<br class="calibre6"/>};</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">This version of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> has a direct base class, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code>, and an indirect base class, <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code>. Each <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> object has three subobjects: an (empty) <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> part, a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> subobject, and a <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> subobject.</p><div class="calibre15">&#160;</div>
<p class="calibre25">As we&#8217;ve seen, each class controls the initialization of objects of its type. Therefore, even though <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> has no data members of its own, it provides the same four-argument constructor as in our original class. Our new constructor passes its arguments to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> constructor. That constructor in turn runs the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> constructor. The <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> constructor initializes the <code class="calibre23"><tt class="calibre23"><span class="calibre24">bookNo</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">price</span></tt></code> members of <code class="calibre23"><tt class="calibre23"><span class="calibre24">bulk</span></tt></code>. When the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> constructor ends, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> constructor runs and initializes the <code class="calibre23"><tt class="calibre23"><span class="calibre24">quantity</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">discount</span></tt></code> members. At this <a id="filepos3898889"/>point, the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> constructor resumes. That constructor has no further initializations or any other work to do.</p><div class="calibre22">&#160;</div>
<div class="calibre35"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre14"><span class="calibre5"><a/>Key Concept: Refactoring</span></p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">Adding <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> hierarchy is an example of <em class="calibre16"><a id="filepos3899552" href="152-defined_terms.html#filepos4148442">refactoring.</a></em> Refactoring involves redesigning a class hierarchy to move operations and/or data from one class to another. Refactoring is common in object-oriented applications.</p></blockquote><div class="calibre15">&#160;</div>
<blockquote class="calibre36"><p class="calibre25">It is noteworthy that even though we changed the inheritance hierarchy, code that uses <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code> or <code class="calibre23"><tt class="calibre23"><span class="calibre24">Quote</span></tt></code> would not need to change. However, when classes are refactored (or changed in any other way) we must recompile any code that uses those classes.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<div class="calibre42"><blockquote class="calibre26"><hr class="calibre34"/><blockquote class="calibre13"><p class="calibre43"><span class="calibre5">Exercises Section 15.4</span></p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.15:</strong> Define your own versions of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> and <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bulk_quote</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.16:</strong> Rewrite the class representing a limited discount strategy, which you wrote for the exercises in &#167; <a href="143-15.2._defining_base_and_derived_classes.html#filepos3806030">15.2.2</a> (p. <a href="143-15.2._defining_base_and_derived_classes.html#filepos3806030">601</a>), to inherit from <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code>.</p></blockquote><div class="calibre10">&#160;</div>
<blockquote class="calibre13"><p class="calibre44"><a/><strong class="calibre5">Exercise 15.17:</strong> Try to define an object of type <code class="calibre23"><tt class="calibre23"><span class="calibre24">Disc_quote</span></tt></code> and see what errors you get from the compiler.</p></blockquote><div class="calibre10">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="144-15.3._virtual_functions.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="146-15.5._access_control_and_inheritance.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
