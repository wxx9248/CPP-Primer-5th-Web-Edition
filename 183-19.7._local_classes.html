<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>19.7. Local Classes</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" type="text/css" rel="stylesheet"/>
<link href="page_styles.css" type="text/css" rel="stylesheet"/>
</head>
  <body class="calibre">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="182-19.6._union_a_spacesaving_class.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="184-19.8._inherently_nonportable_features.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table><h3 id="filepos5346574" class="calibre29"><span class="bold">19.7. Local Classes</span></h3><div class="calibre12">&#160;</div>
<p class="calibre14">A class can be defined inside a function body. Such a class is called a <strong class="calibre5"><a id="filepos5346776" href="186-defined_terms.html#filepos5401930">local class</a></strong>. A local class defines a type that is visible only in the scope in which it is defined. Unlike nested classes, the members of a local class are severely restricted.</p><div class="calibre15">&#160;</div>
<div class="calibre33"><blockquote class="calibre26"><hr class="calibre34"/><p class="calibre14"><span class="calibre5"><a/><img alt="Image" src="images/00012.jpg" class="calibre9"/> Note</span></p><div class="calibre15">&#160;</div>
<blockquote class="calibre13"><p class="calibre14">All members, including functions, of a local class must be completely defined inside the class body. As a result, local classes are much less useful than nested classes.</p></blockquote><div class="calibre22">&#160;</div>
<hr class="calibre34"/></blockquote></div><div class="calibre3">&#160;</div>
<p class="calibre25"><a id="filepos5347570"/>In practice, the requirement that members be fully defined within the class limits the complexity of the member functions of a local class. Functions in local classes are rarely more than a few lines of code. Beyond that, the code becomes difficult for the reader to understand.</p><div class="calibre22">&#160;</div>
<p class="calibre25">Similarly, a local class is not permitted to declare <code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> data members, there being no way to define them.</p><div class="calibre22">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Local Classes May Not Use Variables from the Function&#8217;s Scope</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">The names from the enclosing scope that a local class can access are limited. A local class can access only type names, <code class="calibre23"><tt class="calibre23"><span class="calibre24">static</span></tt></code> variables (&#167; <a href="063-6.1._function_basics.html#filepos1431793">6.1.1</a>, p. <a href="063-6.1._function_basics.html#filepos1431793">205</a>), and enumerators defined within the enclosing local scopes. A local class may not use the ordinary local variables of the function in which the class is defined:</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">int a, val;<br class="calibre6"/>void foo(int val)<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;static int si;<br class="calibre6"/>&#160;&#160;&#160;&#160;enum Loc { a = 1024, b };<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Bar</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is local to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">foo</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;struct Bar {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Loc locVal; // <span><span class="calibre45"><span class="calibre16">ok: uses a local type name</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int barVal;<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;void fooBar(Loc l = a)&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: default argument is</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Loc::a</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;barVal = val;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">error:</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">val</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">is local to</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">foo</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;barVal = ::val;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: uses a global object</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;barVal = si;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: uses a</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">static</span></span></tt></span>
<span><span class="calibre45"><span class="calibre16">local object</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;locVal = b;&#160;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">ok: uses an enumerator</span></span></span><br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br class="calibre6"/>&#160;&#160;&#160;&#160;};<br class="calibre6"/>&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">. . .</span></span></span><br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Normal Protection Rules Apply to Local Classes</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">The enclosing function has no special access privileges to the <code class="calibre23"><tt class="calibre23"><span class="calibre24">private</span></tt></code> members of the local class. Of course, the local class could make the enclosing function a friend. More typically, a local class defines its members as <code class="calibre23"><tt class="calibre23"><span class="calibre24">public</span></tt></code>. The portion of a program that can access a local class is very limited. A local class is already encapsulated within the scope of the function. Further encapsulation through information hiding is often overkill.</p><div class="calibre15">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Name Lookup within a Local Class</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">Name lookup within the body of a local class happens in the same manner as for other classes. Names used in the declarations of the members of the class must be in scope before the use of the name. Names used in the definition of a member can appear anywhere in the class. If a name is not found as a class member, then <a id="filepos5352547"/>the search continues in the enclosing scope and then out to the scope enclosing the function itself.</p><div class="calibre15">&#160;</div>
<h4 class="calibre37"><span class="calibre5">Nested Local Classes</span></h4><div class="calibre38">&#160;</div>
<p class="calibre14">It is possible to nest a class inside a local class. In this case, the nested class definition can appear outside the local-class body. However, the nested class must be defined in the same scope as that in which the local class is defined.</p><div class="calibre15">&#160;</div>
<p class="calibre40"><span class="calibre41"><span class="calibre5"/></span></p><div class="calibre38">&#160;</div>
<blockquote class="calibre13"><p class="calibre31"><tt class="calibre23"><span class="calibre24">void foo()<br class="calibre6"/>{<br class="calibre6"/>&#160;&#160;&#160;&#160;class Bar {<br class="calibre6"/>&#160;&#160;&#160;&#160;public:<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// ...<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;class Nested;&#160;&#160;&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">declares class</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Nested</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;};<br class="calibre6"/>&#160;&#160;&#160;// <span><span class="calibre45"><span class="calibre16">definition of</span></span></span>
<span><tt class="calibre23"><span class="calibre46"><span class="calibre16">Nested</span></span></tt></span><br class="calibre6"/>&#160;&#160;&#160;class Bar::Nested {<br class="calibre6"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;// ...<br class="calibre6"/>&#160;&#160;&#160;};<br class="calibre6"/>}</span></tt></p></blockquote><div class="calibre22">&#160;</div>
<p class="calibre14">As usual, when we define a member outside a class, we must indicate the scope of the name. Hence, we defined <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bar::Nested</span></tt></code>, which says that <code class="calibre23"><tt class="calibre23"><span class="calibre24">Nested</span></tt></code> is a class defined in the scope of <code class="calibre23"><tt class="calibre23"><span class="calibre24">Bar</span></tt></code>.</p><div class="calibre15">&#160;</div>
<p class="calibre25">A class nested in a local class is itself a local class, with all the attendant restrictions. All members of the nested class must be defined inside the body of the nested class itself.</p><div class="calibre22">&#160;</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="001-contents.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href="182-19.6._union_a_spacesaving_class.html"><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href="184-19.8._inherently_nonportable_features.html"><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></div></td></tr></table></body></html>
